<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript">
    var GLOBAL             = {},
        EXX = {},
        ENV               = GLOBAL['ENV']       = 'z',
        LAN               = GLOBAL['LAN']       = 'cn',
        MONEY               = GLOBAL['MONEY']       = 'usd',
        ISLOGIN               = GLOBAL['ISLOGIN']       = false,
        VERSION            = GLOBAL['VERSION']           = '1625832957646',
        DOMAIN_BASE        = GLOBAL['DOMAIN_BASE']       = 'zbg.io',
        DOMAIN_DEV        = GLOBAL['DOMAIN_DEV']       = '',
        WEBSOCKET        = GLOBAL['WEBSOCKET']       = 'wss://kline.zbg.io';
        DISH_API        = GLOBAL['DISH_API']       = 'https://kline.zbg.io';

    document.domain = DOMAIN_BASE;
</script>

    <meta charset="utf-8" />
<meta name="renderer" content="webkit" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="yes" name="apple-touch-fullscreen" />
<meta content="telephone=no" name="format-detection" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="author" content="support@exx.com" />
<meta name="copyright" content="Copyright &copy;ZBG.COM 版权所有" />
<meta name="revisit-after" content="1 days" />
<meta name="keywords" content="比特币交易平台,数字货币交易平台,区块链资产交易平台,数字货币交易网,比特币交易系统,以太坊行情,BTC价格,LTC市价,ZB,ZBG,ZBG.com,bitcoin,btc,itecoin,ltc,ethereum,eth,etc" />
<meta
  name="google-site-verification"
  content="oGjfoHrm5SCBnmGDdppVQnmrAOeTs4trUvqLXwG6BZE"
/>
<meta name="msvalidate.01" content="E689B8CDC9176DD9ED05763B18EDE407" />
<meta name="baidu-site-verification" content="rAtWqHL3Gm" />
<meta name="baidu-site-verification" content="5Cxaxq9Dwo" />

<meta name="description" content="ZBG is the innovation sub-brand website of ZB.COM,now list on CoinMarketcap and CMC，It is one of the top ten professional and reliable digital asset trading platforms in the world as well as Huobi, Binance, Okex, bitMex,Bithumb.Provide BTC,LTC,EOS, ETH,ETC,XRP,ZT,ZB trading for millions of users around the world.Transaction information,multiple technical security protection to create a financial bitcoin trading network .7* 24-hour customer service support, dedicated to serving every moment." />

<meta
  name="viewport"
  content="width=device-width,height=device-height, user-scalable=no,initial-scale=1, minimum-scale=1, maximum-scale=1,viewport-fit=cover"
/>

<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-130174577-1"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "UA-130174577-1");
</script>

<title>
  SAFEMOON/USDT - safemoon
</title>

<!--<script src="//cdn.bootcss.com/eruda/1.2.6/eruda.min.js"></script>
<script>eruda.init();</script>-->
<link rel="shortcut icon" href="/src/images/favicon/favicon.ico" />
<script
  type="text/javascript"
  src="/src/scripts/pako_inflate.min.js"
></script>

<script
  type="text/javascript"
  src="/src/scripts/common/web.lang.js?1625832957646"
></script>
<script
  charset="UTF-8"
  type="text/javascript"
  src="/lib/netEaseSafety/load.min.js?1625832957646"
></script>
<script src="/lib/jquery/dist/jquery.min.js" charset="utf-8"></script>
<!-- iView 国际化 -->
<script src="/lib/vue/vue.js"></script>
<link rel="stylesheet" type="text/css" href="/src/styles/iview.css" />
<script src="/lib/iview.js"></script>
<script src="/lib/iview-en-lang.js"></script>
<style>
  a {
    color: inherit;
  }
</style>
<script
  type="text/javascript"
  src="/lib/jqueryToast/jquery.toast.min.js"
></script>
<script type="text/javascript" src="/lib/others/sweetalert.min.js"></script>
<script
  src="/lib/others/jquery.nicescroll.min.js"
  type="text/javascript"
></script>
<script src="/lib/iscroll/iscroll.min.js" type="text/javascript"></script>
<link
  href="/lib/jqueryToast/jquery.toast.min.css"
  rel="stylesheet"
  type="text/css"
/>
<script src="/lib/bootstrap/dist/js/bootstrap.min.js" charset="utf-8"></script>

<!--<script src="/src/scripts/jquery-ui.min.js"></script>-->
<script src="/src/scripts/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="/src/scripts/login/jquery.drawsvg.min.js"></script>
<!--客服窗口-->

<link
  href="/lib/jqueryPicker/jquery.datetimepicker.min.css"
  rel="stylesheet"
  type="text/css"
/>
<script
  src="/lib/jqueryPicker/jquery.datetimepicker.full.min.js"
  charset="utf-8"
></script>
<script src="/lib/requirejs/require.js" charset="utf-8"></script>
<script
  type="text/javascript"
  src="/src/scripts/main.js?1625832957646"
></script>

<link
  href="/src/styles/xulei-v1.css?1625832957646"
  rel="stylesheet"
  type="text/css"
/>

<link
  href="/src/styles/xuleipro.css?1625832957646"
  rel="stylesheet"
  type="text/css"
/>

<link
  href="/src/styles/cssdna.css?1625832957646"
  rel="stylesheet"
  type="text/css"
/>

<link
  href="/src/styles/helpCenter.css"
  rel="stylesheet"
  type="text/css"
/>
<link rel="stylesheet" href="/src/styles/jquery.mCustomScrollbar.css" />
<link rel="stylesheet" href="/lib/others/hint.min.css" />
<script src="/src/scripts/xulei-v1.js" type="text/javascript"></script>
<link
  rel="stylesheet"
  href="//at.alicdn.com/t/font_503607_cwc4o7ehuqt49529.css"
/>
<!--<script type="text/javascript" src="/src/scripts/commom/.min.js"></script>-->

<!--全站用到的公共文件和头部信息 正在使用的
-->

</head>
<body class="trading-dark">
    
    <link rel="stylesheet" href="/src/styles/tradePro.css?1625832957646">
<link rel="stylesheet" href="/src/styles/temporary.css?1625832957646">
<script src="/lib/others/jquery.range.js" type="application/javascript"></script>


<script>
    var _hmt = _hmt || [];
    (function() {
        const href = window.location.href
        let num = '79edb54a971d93564139761c32333005'
        if (href.indexOf('zbg.kim') > 1 ){
            num = '90b7c7e5acb5c07ef3a98d6b008d8f77'
        }else if (href.indexOf('zbg.fun') > 1){
            num = 'd41443b2a192894df57e302c06db3f54'
        }else{
            num = '79edb54a971d93564139761c32333005'
        }
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?" + num;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<link href="/src/styles/scss/new_header.css?1625832957646" rel="stylesheet" type="text/css">
<header id="zbg_header" :class="iShowNav ? 'show' :'' " v-cloak>
    <div v-if="!isH5" class="header_left">
        <a href="/" class="logo">
            <h1>
                <img src="/src/images/logo.png"/>
            </h1>
        </a>
        <div class="nav">
            <a href="/trade/zt_usdt">
                币币交易
            </a>
            <a class="contract" @click.self="goContract(1)">
                合约交易
                <span class="drop-down"></span>
                <div class="menu">
                    <div class="item" @click="go('/welfareCenter?id=87Zx4EDo2Oe')">
                        <img class="head-font-icon" src="/src/images/new_home/welfare.svg" alt="">
                        <p class="link">福利中心</p>
                    </div>
<!--                    <div class="item" @click="go('/contractActivity')">-->
<!--                        <img class="head-font-icon" src="/src/images/new_home/live.svg" alt="">-->
<!--                        <p class="link">合约交易大赛</p>-->
<!--                    </div>-->
<!--                    <div class="item" @click="go('/ContractSimulationCompetition')">-->
<!--                        <img class="head-font-icon" src="/src/images/new_home/test.svg" alt="">-->
<!--                        <p class="link">合约模拟大赛</p>-->
<!--                    </div>-->
<!--                    <div class="item">-->
<!--                        <img class="head-font-icon" src="/src/images/new_home/classroom.svg" alt="">-->
<!--                        <p class="link">合约课堂</p>-->
<!--                    </div>-->
                </div>
            </a>
            <a href="/exOtc">
                法币交易
            </a>
            <a href="/finance">
                理财宝
            </a>

            <!-- <div class="item" @click="go('/cloudComputing')">
              <img class="head-font-icon" src="/src/images/new_home/cloud.svg" alt="">
              <p class="link">云算力挖矿</p>
          </div> -->

            <a href="/cloudComputing">
              <img class="icon-hot" style="width: 12px; height: 14px; margin-right: 4px;" src="/src/images/zbg/hot.png" alt="">
              云算力挖矿
            </a>
            <a href="/launchpadList">
                Super Launchpad
            </a>
            <a href="/otherOtc">
                <img src="/src/images/zbg/发芽图标.png" alt="">
                Seed 专区
            </a>
            <a class="head-more" href="javascript:void(0)">
                更多
                <span class="drop-down"></span>
                <div class="more-comtainer">
                    <div class="header-more">
                        <div class="ecological">
                            <h6 class="title">生态</h6>
                            <div class="item" @click="go('/rebate')">
                                <img class="head-font-icon" src="/src/images/new_home/rebate.svg" alt="">
                                <p class="link">邀请返佣</p>
                            </div>
                            <div class="item" @click="go('/hosting')">
                                <img class="head-font-icon" src="/src/images/new_home/newGuidance.svg" alt="">
                                <p class="link">策略广场</p>
                            </div>
                            <div class="item" @click="go('/coupon')">
                                <img class="head-font-icon" src="/src/images/new_home/shopping.svg" alt="">
                                <p class="link">ZBG商城</p>
                            </div>
                            <div class="item" @click="go('/videoGuide')">
                                <img class="head-font-icon" src="/src/images/new_home/newGuidance.svg" alt="">
                                <p class="link">新手指导</p>
                            </div>

                        </div>
                        <div class="support">
                            <h6 class="title">支持 </h6>
                            <div class="item" @click="go('/about')">
                              <img class="head-font-icon" src="/src/images/new_home/about.svg" alt="">
                              <p class="link">关于我们</p>
                          </div>
                            <div class="item" @click="go('http://zbglobal2018.mikecrm.com/mmyA604')">
                                <img class="head-font-icon" src="/src/images/new_home/application.svg" alt="">
                                <p class="link">上币申请</p>
                            </div>
                            <div class="item" @click="go('/newmarket')">
                                <img class="head-font-icon" src="/src/images/new_home/ranking.svg" alt="">
                                <p class="link">上币排行</p>
                            </div>
                            <div class="item" @click="go('/u/vip')">
                                <img class="head-font-icon" src="/src/images/new_home/vip.svg" alt="">
                                <p class="link">VIP等级</p>
                            </div>
                            <div class="item" @click="go('api','blank')">
                                <img class="head-font-icon" src="/src/images/new_home/api.svg" alt="">
                                <p class="link">API 文档</p>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
        </div>
    </div>
    <div v-if="!isH5" class="header_right">
        <a v-if="!isLogin" class="head-login" href="javascript:void(0)" role="button" @click="goLogin">
            登录
        </a>
        <a v-if="!isLogin" href="/register">
            <span class="register">注册</span>
        </a>
        <a v-if="isLogin" @click.self="go('/u/asset','self')" class="lanuger">
            资产
            <div class="menu asset">
                <div class="menu-container">
                    <div class="total-asset">
                        <p class="total-title">
                            <span>总资产 ({{money.toUpperCase()}})</span>
                            <img @click="showTotalAsset = false" v-if="showTotalAsset" src="/src/images/new_home/eyes-open.svg" alt="">
                            <img @click="showTotalAsset = true" v-else src="/src/images/new_home/eyes.svg" alt="">
                        </p>
                        <p class="totalNum" v-if="showTotalAsset">
                            {{totalAsset}}
                        </p>
                        <p class="totalNum" v-else>
                            ****
                        </p>
                        <div class="exchangeOrContract">
                            <span @click.self="go('/u/asset','self')">
                                币币账户
                                <i></i>
                            </span>
                            <span @click.self="go('/u/asset?type=contract','self')">
                                合约账户
                                <i></i>
                            </span>
                            <span @click.self="go('/u/asset?type=finance','self')">
                                理财账户
                                <i></i>
                            </span>
                        </div>
                        <div class="exchangeOrContract">
                            <span v-if="showTotalAsset">
                                {{exchangeAsset}}
                            </span>
                            <span v-else>**** </span>
                            <span v-if="showTotalAsset">
                                {{contractAsset}}
                            </span>
                            <span v-else>**** </span>
                            <span v-if="showTotalAsset">
                                {{financeTotalAsset}}
                            </span>
                            <span v-else>****</span>
                        </div>
                        <div class="deOrWi">
                            <span @click="go('/u/payin/btc')">
                                <i>充币</i>
                            </span>
                            <span @click="go('/u/payout/btc')">
                                <i>提币</i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </a>
        <a v-if="isLogin" href="javascript:;" @click.self="go('/u/account')" class="lanuger">
            <img src="/src/images/icon/user-icon.svg"/>
            {{loginUser.loginName}}
            <div class="menu">
                <div class="item"  @click="go('/u/account')">
                    <p class="user-item">账户和安全</p>
                </div>
                <div class="item" @click="go('/u/subaccount')" v-if="loginUser.userType == 1">
                    <p class="user-item">子账户</p>
                </div>
                <div class="item"  @click="go('/u/api')" v-if="loginUser.userType == 1">
                    <p class="user-item">API 设置</p>
                </div>
                <div class="item"  @click="go('/u/vip')">
                    <p class="user-item">VIP等级</p>
                </div>
                <div v-if="marketList && marketList.length > 0 " class="item" @click="go('/limitPrice')">
                    <p class="user-item"> 限价下单</p>
                </div>
<!--                <div class="item"  @click="go('/u/infoOtc')">-->
<!--                    <p class="user-item">成为商家</p>-->
<!--                </div>-->
                <div class="item" @click="logout">
                    <p class="user-item" > 退出登录</p>
                </div>
            </div>
        </a>
        <a class="download-icon" href="/appstore">
            <div class="download">
                <span class="line"></span>
                <span class="triangle"></span>
                <span class="bm_line"></span>
            </div>
        </a>

        <a href="javascript:void(0)" class="lanuger">
            <img :src="'/src/images/new_home/' + showapply + '.svg'" alt="">
            {{showLang}}
            <div class="menu">
                <div class="item" v-for="(el,index) in lanugerList" @click="selectLan(el)">
                    <img class="head-font-icon" :src="'/src/images/new_home/' + el.lan + '.svg'" alt="">
                    <p class="link">{{el.name}}</p>
                </div>
            </div>
        </a>
    </div>
<!--    h5头部-->
    <div v-if="isH5" class="header-h5">
        <div class="header-nav">
            <img @click="go('/')" src="/src/images/logo.png"/>
            <div :class="iShowNav ? 'header-swich show' :'header-swich' " @click="showNav">
                <span class="swich-one"></span>
                <span class="swich-two"></span>
                <span class="swich-three"></span>
            </div>
        </div>
        <div class="header-tab" v-show="iShowNav">
            <ul>
                <li @click="go('/trade/zt_usdt')">
                    <span>币币交易</span>
                </li>
                <li @click="goContract(2)">
                    <span>合约交易</span>
                </li>
                <li @click="go('/exOtc')">
                    <span>法币交易</span>
                </li>
<!--                <li @click="go('/ContractSimulationCompetition')">-->
<!--                    <span>合约模拟大赛</span>-->
<!--                </li>-->
                <li @click="go('/mFinance')">
                    <span>理财宝</span>
                </li>
                <li @click="go('/welfareCenter?id=87Zx4EDo2Oe')">
                    <span>福利中心</span>
                </li>
                <li @click="go('/rebate')">
                    <span>邀请返佣</span>
                </li>
                <li @click="go('/otherOtc')">
                    <span>Seed 专区</span>
                </li>
                <li @click="go('/newmarket')">
                    <span>上币排行</span>
                </li>
                <li @click="go('http://zbglobal2018.mikecrm.com/mmyA604')">
                    <span>上币申请</span>
                </li>
<!--                <li @click="go('/hosting')">-->
<!--                    <span>策略广场</span>-->
<!--                </li>-->
                <li @click="iShowLangMenu = !iShowLangMenu, iShowUserMenu = false">
                    <img class="h5-lanImg" :src="'/src/images/new_home/' + showapply + '.svg'" alt="">
                    {{showLang}}
                    <div  v-show="iShowLangMenu" class="menu">
                        <div class="item" v-for="(el,index) in lanugerList" @click="selectLan(el)">
                            <img class="head-font-icon" :src="'/src/images/new_home/' + el.lan + '.svg'" alt="">
                            <p class="link">{{el.name}}</p>
                        </div>
                    </div>
                </li>
                <li v-if="isLogin" @click="iShowUserMenu = !iShowUserMenu,iShowLangMenu = false ">
                    <img src="/src/images/icon/user-icon.svg"/>
                    {{loginUser.loginName}}
                    <div  v-show="iShowUserMenu" class="menu">
                        <div class="item" @click="go('/u')">
                            <p class="link"> 用户中心</p>
                        </div>
                        <div class="item" @click="go('/u/asset')">
                            <p class="link"> 资产管理</p>
                        </div>
                        <div class="item" @click="go('/u/api')">
                            <p class="link"> API设置</p>
                        </div>
                        <div v-if="marketList && marketList.length > 0 " class="item" @click="go('/limitPrice')">
                            <p class="link"> 限价下单</p>
                        </div>
                        <div class="item" @click="logout">
                            <p class="link"> 退出登录</p>
                        </div>
                    </div>
                </li>
                <li  @click="goLogin" v-if="!isLogin">
                    <span>登录</span>
                </li>
                <li v-if="!isLogin" @click="go('/register')">
                    <span>注册</span>
                </li>
            </ul>
        </div>
    </div>
<!--    授权合约弹框-->
    <div v-show="openContract" class="autoContract">
        <div class="autoContract-container">
            <div class="autoContract-title">
                尊敬的ZBG用户，您尚未开通合约交易，请前往开通
            </div>
            <div class="autoContract-btn">
                <span class="nOpen" @click="goContractDirect">暂不开通 </span>
                <span @click="goOpen">开通交易 </span>
            </div>
        </div>
    </div>
</header>
<script>
    $(document).ready(function () {
        require(['vue', 'common/methods', 'common/juabox'], function (Vue, Methods, JuaBox) {
            EXX.headermenuhe = new Vue({
                el: '#zbg_header',
                data: function () {
                    return {
                        isLogin: ISLOGIN,
                        // isLogin: true,
                        showapply: 'cn', //获取语言
                        loginUser: Methods.getLocalUserInfo(ENV + 'userInfo'),
                        lanugerList: [
                            {
                                lan: 'cn',
                                name: '简体中文',
                            },
                            {
                                lan: 'hk',
                                name: '繁体中文',
                            },
                            {
                                lan: 'en',
                                name: 'English',
                            },
                            {
                                lan: 'jp',
                                name: '日本語',
                            },
                            {
                                lan: 'kr',
                                name: '한국어',
                            },
                            {
                                lan: 'vn',
                                name: 'Tiếng việt',
                            },
                            {
                                lan: 'ru',
                                name: 'русский',
                            },
                            {
                                lan: 'tr',
                                name: 'Türkçe',
                            },
                        ],
                        showLang: '',
                        assistPrice: {}, //汇率
                        userAsset: [], //用户资金
                        money: 'usd',
                        contractList: [],
                        contractAsset: 0, //用户合约资产
                        exchangeAsset: '--', //用户币币资产
                        CONTRACT: 'https://futures.zbg.io/',
                        CONTRACT_H5: 'https://wfutures.zbg.io/',
                        contractUrl:'',
                        openContract:false,//授权登录合约弹框
                        lans: {
                            cn: 'zh_CN',
                            en: 'en_US',
                            hk: 'zh_TW',
                            jp: 'en_US',
                            kr: 'ko_KO',
                            ru: 'en_US',
                            vn: 'en_US',
                            tr: 'en_US',
                        },
                        showTotalAsset:false,
                        isH5:false,
                        iShowNav:false,
                        iShowLangMenu:false,
                        iShowUserMenu:false,
                        marketList:[],
                        contractCoinList:{},
                        financeTotalAsset:'',
                        contractAuthInfo:{}
                    }
                },
                methods: {
                    // 选择语言
                    
                    selectLan(el) {
                        
                        Methods.setCookie(ENV + 'lan', el.lan);
                        window.location.reload()
                    },
                    // 判断语言显示
                    langText(lan) {
                        const _this = this
                        switch (lan) {
                            case 'cn':
                                _this.showLang = '简体中文';
                                break;
                            case 'hk':
                                _this.showLang = '繁体中文';
                                break;
                            case 'en':
                                _this.showLang = 'English';
                                break;
                            case 'jp':
                                _this.showLang = '日本語';
                                break;
                            case 'kr':
                                _this.showLang = '한국어';
                                break;
                            case 'vn':
                                _this.showLang = 'Tiếng việt';
                                break;
                            case 'ru':
                                _this.showLang = 'русский';
                                break;
                            case 'tr':
                                _this.showLang = 'Türkçe';
                                break;
                        }
                    },
                    // 跳转路径
                    go(url,type) {
                        if (url == 'api') {
                            if (this.showapply == 'cn') {
                                url = '/docs/spot/v1/cn/'
                            } else {
                                url = '/docs/spot/v1/en/'
                            }
                        }
                       this.open(url,type)
                    },
                    //解决window.open 弹框被拦截的问题
                    open(url,type){
                        if (type == 'blank'){
                            const a = document.createElement("a");
                            a.setAttribute("href", url);
                            a.setAttribute("target", "_blank");
                            a.setAttribute("id", "openwin");
                            document.body.appendChild(a);
                            a.click();
                        }else{
                            window.location.href = url
                        }

                    },
                    //跳转合约
                    goContract(type){
                        this.contractUrl = type == 1 ? this.CONTRACT : this.CONTRACT_H5

                        if (this.loginUser) {
                            // 登录并已经授权
                            if (this.loginUser.contractAuth > 0) {
                               this.open(this.contractUrl,'blank')
                            } else { //未授权
                                this.openContract = true
                            }

                        } else { //未登录
                            Methods.setCookie('_lang', this.lans[this.showapply])
                            this.open(this.contractUrl,'blank')
                        }
                    },
                    //登录逻辑
                    goLogin() {
                        var mylocation = window.location
                        window.location.href =
                            `/login?redirect=${mylocation.origin}${mylocation.pathname}${mylocation.search}`
                    },
                    //    获取币币账户资产
                    findByPage() {
                        const _this = this
                        var data = {
                            userId: Methods.getLocalUserInfo(ENV + 'userInfo').userId,
                            pageSize: 9999,
                            pageNum: 1
                        };
                        Methods.ajax({
                            url: DOMAIN_DEV +
                                "/exchange/fund/controller/website/fundcontroller/" +
                                'findbypage',
                            data: JSON.stringify(data),
                            success: function (res) {
                                _this.userAsset = res.datas.list;
                                _this.geToalAsset()
                            }.bind(this)
                        });
                    },
                    // 获取币价汇率
                    getAssistPrice: function () {
                        Methods.ajax({
                            // url: DOMAIN_MAIN + API_PREFIX + 'getAssistPrice',
                            url: DOMAIN_DEV +
                                "/exchange/config/controller/website/pricecontroller/" +
                                'getassistprice',
                            success: function (res) {
                                this.assistPrice = res.datas;
                                this.findByPage()
                                // 先检查用户有没有开通合约
                                if (this.loginUser && this.loginUser.contractAuth > 0) {
                                    this.getContractCurrencyList()
                                    this.auth()
                                }
                            }.bind(this)
                        });
                    },
                    //合约授权
                    auth() {
                        const _this = this
                        Methods.ajax({
                            type: 'GET',
                            url: DOMAIN_DEV + '/exchange/contract/controller/ContractController/auth',
                            success: function (res) {
                                _this.getAssets(res.datas.access_token)
                                Methods.setCookie('_authorization', res.datas.access_token, 6)
                                Methods.setCookie('_lang', _this.lans[_this.showapply])
                                Methods.setCookie('contractAuthInfo', JSON.stringify(res.datas))
                            }.bind(this),
                            error: function (res) {

                            }
                        });
                    },
                    //    获取合约账户资产详情
                    getContractAssets() {
                        Methods.ajax({
                            type: 'GET',
                            url: DOMAIN_DEV +
                                '/exchange/contract/controller/ContractController/getAssets',
                            success: function (res) {
                                this.contractList = res.datas
                                this.calculateContractAsset()
                            }.bind(this)
                        });
                    },
                    //    获取合约账户资产详情 替换接口
                    getAssets(authorization){
                        const _this = this
                        // const num = this.CONTRACT.indexOf('BTC_USDT')
                        // const url  = this.CONTRACT.substring(0,num)
                        $.ajax({
                            headers:{
                                authorization:' Bearer ' + authorization
                            },
                            type:'GET',
                            url: this.CONTRACT + 'api/future/queryAvail',
                            dataType:'json',
                            success(res){
                                _this.contractList = res.data
                                _this.calculateContractAsset()
                            }
                        })
                    },
                    // 计算币币总资产
                    geToalAsset() {
                        const _this = this
                        let totalAsset = 0
                        let decimal = this.money === 'cny' ? 2 : 3
                        for (let index = 0; index < _this.userAsset.length; index++) {
                            const element = _this.userAsset[index];
                            const num = (Number(element.amount) + Number(element.freeze)) || 0
                            if (num !== 0) {
                                const price = this.assistPrice[this.money][element
                                    .currencyName] || 0
                                const total = price * num
                                if (total > 0.001) {
                                    totalAsset += total
                                }
                            }
                        }
                        this.exchangeAsset = Methods.fixNumber(totalAsset, decimal)
                    },
                    // 计算合约资产
                    calculateContractAsset() {
                        const _this = this
                        let totalAsset = 0
                        let decimal = this.money === 'cny' ? 2 : 3
                        for (let index = 0; index < _this.contractList.length; index++) {
                            const element = _this.contractList[index];
                            const num = Number(element.totalBalance) || 0
                            if (num !== 0) {
                                const price = _this.assistPrice[_this.money][(_this.contractCoinList[element.currencyId].currencyName).toLowerCase()] || 0
                                const total = price * num
                                if (total > 0.001) {
                                    totalAsset += total
                                }
                            }
                        }
                        _this.contractAsset = Methods.fixNumber(totalAsset, decimal) || 0
                    },
                    //  退出登录
                    logout() {
                        Methods.logout();
                    },
                    // 不开通合约账户
                    goContractDirect(){
                        this.open(this.contractUrl,'blank')
                        this.openContract = false
                    },
                    //开通合约账户
                    goOpen(){
                        this.open('/u/openContract','blank')
                        this.openContract = false
                    },
                    showNav(){
                        this.iShowNav = !this.iShowNav
                    },
                    getmarketcfg() {
                        Methods.ajax({
                            type: 'GET',
                            url: DOMAIN_DEV + '/exchange/entrust/controller/website/entrustcontroller/getmarketcfg',
                            success: function(res) {
                                this.marketList = res.datas
                            }.bind(this)
                        });
                    },
                    //获取合约币种
                    getContractCurrencyList(){
                        this.contractCoinList = {}
                        Methods.ajax({
                            type: 'GET',
                            url: DOMAIN_DEV + '/exchange/contract/controller/ContractController/getContractCurrencyList',
                            success: function (res) {
                                for (let i = 0; i <res.datas.length ; i++) {
                                    const el = res.datas[i]
                                    this.contractCoinList[el.id] = el
                                }
                            }.bind(this)
                        });
                    },
                //    获取来源
                   getLink(){
                        const from = Methods.parseQueryString().from
                        if (from){
                            Methods.ajax({
                                url: DOMAIN_DEV +
                                    "/exchange/activity/controller/ZbgNewsController/fromAnalytics?from=" + from,
                                success: function(res) {}
                            });
                        }
                   },
                    //获取理财资产
                    getTotalAsset(){
                        const _this = this
                        Methods.ajax({
                            url:DOMAIN_DEV + '/exchange/fund/controller/website/FinanceController/getTotalAsset',
                            type:'post',
                            data:{
                                fullCurrency:true,
                                assistCurrencyName:this.money,
                                assetType: 7 ,// 1是查询活期理财资产，2是查询定期理财资产，4是查询挖矿资产，其余的取值，是这三个的叠加
                            },
                            success:function(res){
                                let decimal = _this.money === 'cny' ? 2 : 3 //显示小数位
                                _this.financeTotalAsset =Methods.fixNumber(res.datas.amount,decimal)
                            }
                        })
                    },
                },
                computed: {
                    // 总资产显示
                    totalAsset() {
                        let decimal = this.money === 'cny' ? 2 : 3 //显示小数位
                        return Methods.fixNumber(Number(this.contractAsset) + Number(
                            this.exchangeAsset) + Number(this.financeTotalAsset), decimal)
                    }
                },
                created() {
                    const _this = this
                    _this.getLink()
                    if(this.loginUser){
                        this.getAssistPrice()
                        this.getmarketcfg()
                        this.getTotalAsset()
                    }
                //    判断 路径是否带有 注册邀请码 存入cookie

                },
                mounted: function () {
                    const _this = this
                    const params = Methods.parseQueryString();
                    if (params.recommendCode){
                        sessionStorage.setItem(ENV + "recommendCode",params.recommendCode)
                    }
                    this.langText(this.showapply)
                    const w = $(window).width()
                    if (w > 1096){
                        _this.isH5 = false
                    }else{
                        _this.isH5 = true
                    }
                    window.addEventListener('resize',function(){
                        const w = $(window).width()
                        if (w > 1096){
                            _this.isH5 = false
                        }else{
                            _this.isH5 = true
                        }
                    })
                },
            })
        })
    })
</script>

<section class="tradeNew" id="app-trade-pro">
    <div class="tradeNew-container">
        <div class="chartEntrust-area">
            <div class="chart-area">
                <div class="trade-navbar" v-cloak="">
                    <div class="market-menu">
                        <div class="current-market">
                            <div class="current" data-toggle="dropdown">
                                <p>{{coinName=='BCHABC'?'BCH':coinName}}/ <span class="denominator">{{moneyName}}</span></p>
                            </div>
                            <div class="market-box">
                                <div class="mark-list">
                                    <ul class="title">
                                        <li>
                                            <p>
                                                交易对
                                            </p>
                                            <p>
                                                最新价
                                            </p>
                                            <p>
                                                涨跌幅
                                            </p>
                                        </li>
                                    </ul>
                                    <div class="chuangxinqu">
                                        <h3>
                                            推荐区
                                        </h3>
                                        <div>
                                            <input v-model="searchMainMarket" @input="getSearchList" type="text">
                                            <svg class="icon" style="width: 1.5em; height: 1.5em;vertical-align: middle;fill: currentColor;overflow: hidden;"
                                                 viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                                                 p-id="1337">
                                                <path d="M830.486464 796.124515 672.790943 638.42797c44.959904-52.799318 72.109099-121.232412 72.109099-196.016087 0-167.084182-135.448007-302.533214-302.53219-302.533214s-302.533214 135.449031-302.533214 302.533214 135.449031 302.53219 302.533214 302.53219c74.782651 0 143.215745-27.149196 196.017111-72.109099L796.101988 830.531518c9.499249 9.499249 24.885227 9.499249 34.384476 0S839.986737 805.623764 830.486464 796.124515zM442.366829 698.401131c-141.380814 0-255.989248-114.631985-255.989248-255.989248 0-141.403341 114.608434-255.989248 255.989248-255.989248 141.37979 0 255.989248 114.585907 255.989248 255.989248C698.356077 583.769146 583.747643 698.401131 442.366829 698.401131z"
                                                      p-id="1338"></path>
                                            </svg>
                                        </div>
                                    </div>

                                    <ul class="list">
                                        <template>
                                            <li v-for="data in MainMarket" @click="gotoTrade(data.market)" v-if="data.type">
                                                <p>
                                                    <!--.split('_')[0-->
                                                    <!-- <img :src="'https://oss.zbg.com/images/market-' + data.market.split('_')[0] + '.png'" /> -->
                                                    <b>{{showCoinNew(data.market)}}</b><span><i>/</i>{{showMoneyNew(data.market)}}</span>
                                                </p>
                                                <p>{{data.lastPrice}}</p>
                                                <p :class="data.rate >= 0 ? 'buyColor' : 'sellColor'">{{ data.rate >= 0
                                                ? '' +
                                                showRate(data.rate) : '' + showRate(data.rate) }}%</p>
                                            </li>
                                        </template>

                                        <!--<template v-if="!allMarketLoading">-->
                                            <!--<li v-for="(data,index) in recommendMarket" @click="gotoTrade(data.market)" v-if="data.market!=undefined && data.type == '2'  ">-->
                                                <!--&lt;!&ndash;&& data.market.indexOf(selectIcon) != -1&ndash;&gt;-->
                                                <!--<p>-->
                                                    <!--<img :src="'/src/images/icon/coin/' + data.market.split('_')[0] + '.svg?1625832957646'" /><b>{{showCoinNew(data.market)}}</b><span><i>/</i>{{showMoneyNew(data.market)}}</span>-->
                                                <!--</p>-->
                                                <!--<p>{{showPrice(data.lastPrice,data.market)}}</p>-->
                                                <!--<p :class="data.rate >= 0 ? 'buyColor' : 'sellColor'">{{ data.rate >= 0-->
                                                    <!--? '' +-->
                                                    <!--showRate(data.rate) : '' + showRate(data.rate) }}%</p>-->
                                            <!--</li>-->
                                        <!--</template>-->
                                        <!--<template v-if="allMarketLoading">-->
                                            <!--<li v-for= " item in marketConfig " @click="gotoTrade(item.name)">-->
                                                <!--<p>{{item.name.replace('_', '/').toUpperCase()}}</p>-->
                                                <!--<p>&#45;&#45;</p>-->
                                                <!--<p>&#45;&#45;</p>-->
                                            <!--</li>-->

                                        <!--</template>-->
                                    </ul>
                                    <div class="chuangxinqu">
                                        <h3>
                                            创新区
                                        </h3>
                                        <div>
                                            <input v-model="searchMainMarket" @input="getSearchList" type="text" v-if="false">
                                            <!--<svg class="icon" style="width: 1.5em; height: 1.5em;vertical-align: middle;fill: currentColor;overflow: hidden;"-->
                                                <!--viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"-->
                                                <!--p-id="1337">-->
                                                <!--<path d="M830.486464 796.124515 672.790943 638.42797c44.959904-52.799318 72.109099-121.232412 72.109099-196.016087 0-167.084182-135.448007-302.533214-302.53219-302.533214s-302.533214 135.449031-302.533214 302.533214 135.449031 302.53219 302.533214 302.53219c74.782651 0 143.215745-27.149196 196.017111-72.109099L796.101988 830.531518c9.499249 9.499249 24.885227 9.499249 34.384476 0S839.986737 805.623764 830.486464 796.124515zM442.366829 698.401131c-141.380814 0-255.989248-114.631985-255.989248-255.989248 0-141.403341 114.608434-255.989248 255.989248-255.989248 141.37979 0 255.989248 114.585907 255.989248 255.989248C698.356077 583.769146 583.747643 698.401131 442.366829 698.401131z"-->
                                                    <!--p-id="1338"></path>-->
                                            <!--</svg>-->
                                        </div>
                                    </div>

                                    <ul class="list">
                                        <!--<template v-if="!allMarketLoading">-->
                                            <!--<li v-for="(data,index) in searchMarket" @click="gotoTrade(data.market)"-->
                                                <!--v-if="data.market!=undefined && data.type == '1'  ">-->
                                                <!--<p>-->
                                                    <!--<img :src="'/src/images/icon/coin/' + data.market.split('_')[0] + '.svg?1625832957646'" /><b>{{showCoinNew(data.market)}}</b><span><i>/</i>{{showMoneyNew(data.market)}}</span>-->
                                                <!--</p>-->
                                                <!--<p>{{showPrice(data.lastPrice,data.market)}}</p>-->
                                                <!--<p :class="data.rate >= 0 ? 'buyColor' : 'sellColor'">{{ data.rate >= 0-->
                                                    <!--? '' +-->
                                                    <!--showRate(data.rate) : '' + showRate(data.rate) }}%</p>-->
                                            <!--</li>-->
                                        <!--</template>-->

                                        <template>
                                            <li v-for="data in searchList" @click="gotoTrade(data.market)" v-if="!data.type ">
                                                <p>
                                                    <!--.split('_')[0-->
                                                    <!-- <img :src="'https://oss.zbg.com/images/market-' + data.market.split('_')[0] + '.png'" /> -->
                                                    <b>{{showCoinNew(data.market)}}</b><span><i>/</i>{{showMoneyNew(data.market)}}</span>
                                                </p>
                                                <p>{{data.lastPrice}}</p>
                                                <p :class="data.rate >= 0 ? 'buyColor' : 'sellColor'">{{ data.rate >= 0
                                                    ? '' +
                                                    showRate(data.rate) : '' + showRate(data.rate) }}%</p>
                                            </li>
                                        </template>

                                    </ul>
                                </div>
                            </div>
                        </div>
                        <ul class="statistics" v-cloak="">
                            <li v-if="!selectlan">
                                <p class="price"> {{currentPrice}}
                                    <span> ≈ {{currentPrice * usdprice | capitalizeusd }} USD</span></p>
                            </li>
                            <li v-else>
                                <p class="price"> {{currentPrice}}
                                    <span> ≈ {{currentPrice*cnyprice | capitalizecny }} CNY</span></p>
                            </li>
                            <li>24H
                                涨跌幅
                                <p :class="rateClass">{{riseRate}}%</p>
                            </li>
                            <li>24H
                                最高
                                <p>{{highPrice}} {{moneyName}}</p>
                            </li>
                            <li>24H
                                最低
                                <p>{{lowPrice}} {{moneyName}}</p>
                            </li>
                            <li>24H
                                成交量
                                <p>{{volume}} {{  coinName=='BCHABC'?'BCH':coinName }}</p>
                            </li>
                        </ul>
                    </div>
                    <div class="chart-oper" v-cloak="">
                        <div class="item" v-cloak="">
                            <p v-if="period == '1w'">
                                周
                            </p>
                            <p v-if="period == '1d'">
                                日
                            </p>
                            <p v-if="period == '4h'">4
                                小时
                            </p>
                            <p v-if="period == '1h'">1
                                小时
                            </p>
                            <p v-if="period == '30m'">30
                                分
                            </p>
                            <p v-if="period == '15m'">15
                                分
                            </p>
                            <p v-if="period == '1m'">1
                                分
                            </p>
                            <p v-if="period == 'line'">
                                分时
                            </p>
                            <div class="item-list" v-cloak="">
                                <ul>
                                    <li role="button" @click="switchPeriod('1w')" :class="[period == '1w' ? 'active' : '']">
                                        周
                                    </li>
                                    <li role="button" @click="switchPeriod('1d')" :class="[period == '1d' ? 'active' : '']">
                                        日
                                    </li>
                                    <li role="button" @click="switchPeriod('4h')" :class="[period == '4h' ? 'active' : '']">
                                        4
                                        小时
                                    </li>
                                    <li role="button" @click="switchPeriod('1h')" :class="[period == '1h' ? 'active' : '']">
                                        1
                                        小时
                                    </li>
                                    <li role="button" @click="switchPeriod('30m')" :class="[period == '30m' ? 'active' : '']">
                                        30
                                        分
                                    </li>
                                    <li role="button" @click="switchPeriod('15m')" :class="[period == '15m' ? 'active' : '']">
                                        15
                                        分
                                    </li>
                                    <li role="button" @click="switchPeriod('1m')" :class="[period == '1m' ? 'active' : '']">
                                        1
                                        分
                                    </li>
                                    <li role="button" @click="switchPeriod('line')" :class="[period == 'line' ? 'active' : '']">
                                        分时
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!--<div class="line"></div>-->
                        <!--<div class="item">-->
                        <!--<p>工具</p>-->
                        <!--<div class="item-list more">-->
                        <!--<ul>-->
                        <!--<li>-->
                        <!--<p>技术指标</p>-->
                        <!--<div class="common-select"><a @click="switchIndic()" role="button" :class="{'on' : kline.indicsStatus == 'on'}"><i></i></a></div>-->
                        <!--</li>-->
                        <!--<li>-->
                        <!--<p>画线工具</p>-->
                        <!--<div class="common-select"><a @click="switchTool()" role="button" :class="{'on' : kline.toolStatus == 'on'}"><i></i></a></div>-->
                        <!--</li>-->
                        <!--<li>-->
                        <!--<p>主指标</p>-->
                        <!--<a @click="setChartMainIndicator('MA')" :class="{'selected': kline.mIndic == 'MA'}">MA</a>-->
                        <!--<a @click="setChartMainIndicator('EMA')" :class="{'selected': kline.mIndic == 'EMA'}">EMA</a>-->
                        <!--<a @click="setChartMainIndicator('BOLL')" :class="{'selected': kline.mIndic == 'BOLL'}">BOLL</a>-->
                        <!--<a @click="setChartMainIndicator('SAR')" :class="{'selected': kline.mIndic == 'SAR'}">SAR</a>-->
                        <!--<a @click="setChartMainIndicator('NONE')" :class="{'selected': kline.mIndic == 'NONE'}">NONE</a>-->
                        <!--</li>-->
                        <!--<li>-->
                        <!--<p>主图样式</p>-->
                        <!--<a @click="setChartMainStyle('CandleStick')" :class="{'selected': kline.chartStyle == 'CandleStick'}">CandleStick</a>-->
                        <!--<a @click="setChartMainStyle('CandleStickHLC')" :class="{'selected': kline.chartStyle == 'CandleStickHLC'}">CandleStickHLC</a>-->
                        <!--<a @click="setChartMainStyle('OHLC')" :class="{'selected': kline.chartStyle == 'OHLC'}">OHLC</a>-->
                        <!--</li>-->
                        <!--&lt;!&ndash;<li><p></p><a @click="showChartSetting" role="button">指标参数设置</a></li>&ndash;&gt;-->
                        <!--</ul>-->
                        <!--</div>-->
                        <!--</div>-->
                    </div>
                </div>
                <div style="position: absolute; top: 50px;bottom: 0;left: 0;right: 0;" v-show="chartType === 'kline'">
                    <!--老版本k线-->
                    <!--<iframe :src="'/kline/lite/' + currentMarket + '?money=' + assistCoin.toLowerCase()" id="marketFrame"-->
                        <!--class="marketFrame" name="marketFrame" onload="" frameborder="0" width="100%" style="height:100%"-->
                        <!--hspace="0" scrolling="no"></iframe>-->
                    <!--'?market='-->
                    <!--线上环境-->
                    <iframe :src="DOMAIN_DEV+ '/lib/dist/index.html?market='+ currentMarket +'&type=' + period.toUpperCase() + '&lan=' + selectlan   +'&currentMarketId=' + currentMarketId + '&priceDecimal=' + currentMarketConfig.priceDecimal + '&zbgApi=' + domDev + '&version=' + 1625832957646 + '&wsUrl=' + wsUrl  " id="marketFrame"
                            class="marketFrame" name="marketFrame" onload="" frameborder="0" width="100%" style="height:100%"
                            hspace="0" scrolling="no"></iframe>
                    <!--测试环境 /lib/dist/index.html? http://localhost:8081-->
                    <!--<iframe :src="'/lib/dist/index.html?market='+ currentMarket +'&type=' + period.toUpperCase() + '&lan=' + selectlan   +'&currentMarketId=' + currentMarketId + '&priceDecimal=' + currentMarketConfig.priceDecimal + '&zbgApi=' + domDev + '&version=' + 1625832957646 + '&wsUrl=' + wsUrl  " id="marketFrame"-->
                    <!--class="marketFrame" name="marketFrame" onload="" frameborder="0" width="100%" style="height:100%"-->
                    <!--hspace="0" scrolling="no"></iframe>-->
                </div>
                <div style="height: 100%;" v-if="chartType === 'depth'">
                    <exx-highchart class="depth-chart" :options="depthChartOptions" ref="depth"></exx-highchart>
                </div>
            </div>
            <div class="entrust-area" v-if="isLogin" v-cloak="">
                <div class="head">
                    <ul class="tab">
                        <li @click="changeEntrustTab('doing')" :class="{'on' : currentEntrustTab == 'doing'}">
                            当前委托
                        </li>
                        <li @click="changeEntrustTab('history')" :class="{'on' : currentEntrustTab == 'history'}">
                            成交历史
                        </li>
                    </ul>
                    <div class="oper" v-if="isLogin">
                        <a href="/u/bills" target="_blank" role="button">
                            综合账单</a>
                        <a href="/u/allEntrust" target="_blank" role="button">
                            全部委托</a>
                        <img @click="Refresh" class="Refresh" src="/src/images/zbg/images/Refresh@2x.png" alt="">
                        <!--<a @click="showModal = 'batchCancel'" role="button">批量撤单</a>-->
                    </div>
                </div>
                <div class="body">
                    <!--<div v-if="!isLogin" class="notLogin">-->
                    <!--请您先<a href="/login">登录</a>或<a href="/register">注册</a>-->
                    <!--</div>-->
                    <div class="entrust-list" v-if="isLogin" v-cloak="">
                        <ul class="title">
                            <li>
                                <p><span>
                                        时间</span></p>
                                <p><span>
                                        方向</span></p>
                                <p><span>
                                        委托价/
                                        成交均价({{moneyName}})</span></p>
                                <p><span>
                                        委托量/
                                        成交量({{coinName=='BCHABC'?'BCH':coinName}})</span></p>
                                <p><span>
                                        成交额({{moneyName}})</span></p>
                                <p><span>
                                        状态/
                                        操作</span></p>
                            </li>
                        </ul>
                        <ul class="list">
                            <li v-if="isLogin && getGroupEntrust(currentEntrustTab).length > 0  &&  !loading" v-for="item in getGroupEntrust(currentEntrustTab)">
                                <template v-if="item.type == 1">
                                    <p>{{showTime(item.createTime)}}</p>
                                    <p class="buyColor">
                                        买
                                    </p>
                                    <p>
                                        <span class="hint--top" :aria-label="showAssistHint(item.price)">{{newShowMoney(item.price)}}</span>
                                        / <span class="hint--top" :aria-label="showAssistHint(item.completeTotalMoney/item.completeAmount)">{{newShowMoney(item.completeTotalMoney/item.completeAmount)}}</span>
                                    </p>
                                    <p><span>{{newShowCoin(item.amount)}}</span> / {{newShowCoin(item.completeAmount)}}
                                    </p>
                                    <p>
                                        <span class="hint--top" :aria-label="showAssistHint(item.completeTotalMoney)">{{newShowAmount(item.completeTotalMoney)}}</span>
                                    </p>
                                    <p v-if="item.status == 3 || item.status == 0"><span v-html="showStatus(item.status)"></span>
                                        | <a role="button" @click="doCancelEntrust(item.entrustId)">
                                            取消</a>
                                    </p>
                                    <p v-if="item.status != 3 && item.status != 0"><span v-html="showStatus(item.status)"></span></p>
                                </template>
                                <template v-if="item.type == 0">
                                    <p>{{showTime(item.createTime)}}</p>
                                    <p class="sellColor">
                                        卖
                                    </p>
                                    <p>
                                        <span class="hint--top" :aria-label="showAssistHint(item.price)">{{newShowMoney(item.price)}}</span>
                                        / <span class="hint--top" :aria-label="showAssistHint(item.completeTotalMoney/item.completeAmount)">{{newShowMoney(item.completeTotalMoney/item.completeAmount)}}</span>
                                    </p>
                                    <p><span>{{newShowCoin(item.amount)}}</span> / {{newShowCoin(item.completeAmount)}}
                                    </p>
                                    <p>
                                        <span class="hint--top" :aria-label="showAssistHint(item.completeTotalMoney)">{{newShowAmount(item.completeTotalMoney)}}</span>
                                    </p>
                                    <p v-if="item.status == 3 || item.status == 0"><span v-html="showStatus(item.status)"></span>
                                        | <a role="button" @click="doCancelEntrust(item.entrustId)">
                                            取消</a>
                                    </p>
                                    <p v-if="item.status != 3 && item.status != 0"><span v-html="showStatus(item.status)"></span></p>
                                </template>
                            </li>
                            <!--<li class="container-page-li" v-if="isLogin && getGroupEntrust(currentEntrustTab).length > 0  &&  !loading">-->
                            <!--<page-lite class="container-page-lite"-->
                            <!--:page-index="userEntrustRecordFromCache.pageIndex"-->
                            <!--:page-size="userEntrustRecordFromCache.pageSize"-->
                            <!--:page-count="userEntrustRecordFromCache.pageCount"-->
                            <!--@index="pageLiteChangeFn"></page-lite>-->
                            <!--</li>-->
                        </ul>
                        <div class="norecord" v-if="isLogin && getGroupEntrust(currentEntrustTab).length == 0 && !loading ">
                            没有记录 
                        </div>
                        <div class="spinner" v-else-if="isLogin && loading ">
                            <div class="rect1"></div>
                            <div class="rect2"></div>
                            <div class="rect3"></div>
                            <div class="rect4"></div>
                            <div class="rect5"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="plateFill-area">
            <div class="plate-area">
                <dish-part :dish-data="lastDepth" :market-config="currentMarketConfig" :current-market="currentMarket"
                    :assist-price="assistPrice" ref="dishPart" :key="dishKey"></dish-part>
                <deal-record :deal-record="dealRecord" :market-config="currentMarketConfig" :current-market="currentMarket"
                    ref="dealRecord" :key="dealKey"></deal-record>
            </div>
            <div class="fill-area" v-cloak="">
                <!--<div class="head">-->
                <!--<div class="cd-select">-->
                <!--&lt;!&ndash;<p>价格输入转换</p>&ndash;&gt;-->
                <!--&lt;!&ndash;<a :class="{'on': inputPriceMode != 0}" @click="toggleInputPriceMode"></a>&ndash;&gt;-->
                <!--</div>-->
                <!--</div>-->
                <div class="body" v-show="!showLeverInfo">
                    <trade-form :trade-type="1" :current-user-asset="currentUserAsset" :market-config="currentMarketConfig"
                        :current-market="currentMarket" :assist-price="assistPrice" ref="tradeFormBuy" :key="tradeKey1"></trade-form>
                    <trade-form :trade-type="0" :current-user-asset="currentUserAsset" :market-config="currentMarketConfig"
                        :current-market="currentMarket" :assist-price="assistPrice" ref="tradeFormSell" :key="tradeKey2"></trade-form>
                </div>
            </div>
        </div>
    </div>
    <div class="plate-time flex flex-lr-center flex-tb-center" v-cloak="" v-if="marketOpenStatus">
        <div class="time">
            <i class="model_close" @click="marketOpenStatus = false"></i>
            <template v-if="marketOpenStatus && marketOpenTime[0] < 30">
                <h2>ZBG.COM</h2>
                <h3 v-if="!isLock">
                    开盘倒计时
                </h3>
                <h3 v-else>
                    火箭计划开盘倒计时
                </h3>

                <div class="countdown flex flex-tb-center">
                    <p>{{marketOpenTime[0]}}</p>
                    <em>
                        天</em>
                    <p>{{marketOpenTime[1]}}</p>
                    <em>
                        时</em>
                    <p>{{marketOpenTime[2]}}</p>
                    <em>
                        分</em>
                    <p class="sec">{{marketOpenTime[3]}}</p>
                    <em>
                        秒</em>
                </div>
                <p v-if="!isLock" >
                    开盘时间：{{marketStartTime}} GMT+0800 (CST)</p>
                <p v-else >
                    火箭计划开盘时间：{{marketStartTime}} GMT+0800 (CST)</p>
            </template>
            <template v-if="marketOpenStatus && marketOpenTime[0] > 30">
                <h3 class="text">
                    敬请期待
                </h3>
            </template>
        </div>
    </div>
    <!--过渡动画-->
    <div class="spinner-main" v-if="mainLoding">
        <div class="spinner-1">
            <div class="rect1"></div>
            <div class="rect2"></div>
            <div class="rect3"></div>
            <div class="rect4"></div>
            <div class="rect5"></div>
        </div>
    </div>
    <!-- 账单 -->
    <modal v-cloak class="modal-bill" :open="showModal == 'bill'" @close="showModal = false">
        <bill :params="billParams" theme="light" />
    </modal>
    <!-- 委托记录 -->
    <modal v-cloak class="modal-entrust" :open="showModal == 'entrust'" @close="showModal = false">
        <modal-entrust :params="entrustParams" theme="light" />
    </modal>
    <!-- 开启关闭杠杆 -->
    <modal v-cloak :open="showModal == 'toggleUserAction'" @close="showModal = false">
        <toggle-user-action :params="userParams" :done="userActionSuccess()" theme="light" />
    </modal>
    <!-- 批量取消委托 -->
    <modal v-cloak :open= "showModal == 'batchCancel'" @close="showModal = false">
        <batch-cancel :market-config="currentMarketConfig" theme="light"/>
    </modal>
    <!--还款-->
    <modal v-cloak :open="showModal == 'refund'" @close="showModal = false">
        <modal-refund :params="refundParams" :user-asset="currentUserAsset" />
    </modal>
</section>

<div class="sidebar-area temporary" id="app-sider">
    <div class="sidebar-menu">
        <!--<ul class="menu-top">
            <li>
                <a @click="changeTab('spot')" class="tab" :class="{'active' : currentTab == 'spot' && keyWord == ''}" role="button">
                    <svg class="icon" style="width: 26px; height: 26px;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M182.969195 682.353876c5.082762 0 10.165524-1.940189 14.045901-5.822612l162.111145-162.111145 127.207194 127.207194 276.513708-276.504498 74.374918 74.381058 100.836593-100.82636c7.760754-7.756661 7.760754-20.335141 0-28.093848s-20.333094-7.758708-28.092825 0l-72.742744 72.736605-74.374918-74.381058L486.332411 585.441663l-127.207194-127.20617L168.923294 648.439462c-7.760754 7.761778-7.760754 20.333094 0 28.091802C172.802648 680.413688 177.886433 682.353876 182.969195 682.353876zM972.061071 870.926696c0 10.972912-8.892531 19.86749-19.86442 19.86749L52.210106 890.794186 52.210106 147.765415c0-10.972912 8.892531-19.866467 19.86442-19.866467 10.972912 0 19.866467 8.893554 19.866467 19.866467l0 703.295837 860.255659 0C963.16854 851.060229 972.061071 859.951737 972.061071 870.926696z"></path></svg>
                    <p>现货</p>
                </a>
            </li>
            <li>
                <a @click="changeTab('forward')" class="tab" :class="{'active' : currentTab == 'forward' && keyWord == ''}" role="button">
                    <svg class="icon" style="width: 26px; height: 26px;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M222.874043 93.3859c-115.596761 0-209.30705 187.41853-209.30705 418.6141 0 231.193523 93.710288 418.6141 209.30705 418.6141 115.596761 0 209.30705-187.420577 209.30705-418.6141C432.181093 280.804431 338.470805 93.3859 222.874043 93.3859L222.874043 93.3859zM222.874043 888.75269c-92.478228 0-167.44564-168.68077-167.44564-376.753713 0-208.076012 74.967412-376.75269 167.44564-376.75269 92.479251 0 167.44564 168.677701 167.44564 376.75269C390.319683 720.072943 315.353294 888.75269 222.874043 888.75269L222.874043 888.75269zM963.697589 512c0 208.072943-74.967412 376.753713-167.446663 376.753713l-532.591991 0c-12.519128 16.129352-25.891693 30.083156-39.947827 41.86141l572.539818 0c115.596761 0 209.308073-187.420577 209.308073-418.6141M499.492128 93.3859l-275.78102 0c14.056134 11.778254 27.428699 25.731034 39.947827 41.86141l235.833193 0M222.874043 302.69295c-57.799404 0-104.653525 93.710288-104.653525 209.30705s46.854121 209.30705 104.653525 209.30705 104.653525-93.710288 104.653525-209.30705S280.673447 302.69295 222.874043 302.69295L222.874043 302.69295zM222.874043 679.446663c-34.678824 0-62.792115-74.970482-62.792115-167.446663 0-92.478228 28.113291-167.44564 62.792115-167.44564 34.679847 0 62.793138 74.967412 62.793138 167.44564C285.666158 604.476181 257.55389 679.446663 222.874043 679.446663L222.874043 679.446663zM939.450349 82.382289c-48.422849-48.393173-112.777553-75.054393-181.26846-75.054393-68.466348 0-132.830261 26.66122-181.232644 75.060533-48.420803 48.41364-75.085092 112.790856-75.085092 181.266413-0.01228 68.483744 26.631544 132.846634 75.045183 181.289949 48.397267 48.367591 112.766296 75.033927 181.223435 75.033927 68.490907 0 132.881426-26.682709 181.316555-75.085092C1039.372106 344.962659 1039.387455 182.352141 939.450349 82.382289L939.450349 82.382289 939.450349 82.382289M915.829372 421.267533c-42.119283 42.113143-98.121761 65.328891-157.693532 65.328891-59.529815 0-115.51899-23.204491-157.609621-65.279772-42.092677-42.09984-65.267493-98.091062-65.258283-157.661809 0-59.561537 23.186072-115.559922 65.293075-157.64953 42.09984-42.090631 98.071619-65.269539 157.6219-65.269539 59.553351 0 115.536386 23.177885 157.64646 65.272609C1002.733651 192.935174 1002.733651 334.370417 915.829372 421.267533L915.829372 421.267533 915.829372 421.267533M868.947622 326.471516l-88.602967-51.241035L780.344654 135.490857c0-11.793604-9.567913-21.360494-21.364587-21.360494-11.787464 0-21.355377 9.56689-21.355377 21.360494l0 149.524478c0 7.92346 9.848299 14.56574 16.255219 18.241456 1.771343 2.667759 6.642281 5.082762 9.611915 6.79066l88.11178 53.404304c10.207479 5.892197 21.274536 2.390443 27.169803-7.819083 5.895267-10.213619 0.406253-23.264866-9.827833-29.160133l0 0 0-0.002047L868.947622 326.470493M868.947622 326.471516 868.947622 326.471516z"></path></svg>
                    <p>期</p>
                </a>
            </li>
            <li v-if="isLogin">
                <a @click="changeTab('user')" class="tab" :class="{'active' : currentTab == 'user' && keyWord == ''}" role="button">
                    <svg class="icon" style="width: 34px; height: 34px;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M758.941182 890.181225 512.085958 759.364831l-246.87262 130.816394 47.152926-275.909957L112.629173 419.590334l276.019451-40.102347 123.43631-250.118548 123.418914 250.118548 274.996145 40.102347L711.788256 614.271268 758.941182 890.181225zM187.05321 443.766966l162.508187 158.399613-38.361703 223.693712 200.886263-105.616456 200.868867 105.616456-38.361703-223.693712 162.508187-158.399613L612.512205 411.136801l-100.426247-203.523323L411.642315 411.136801 187.05321 443.766966z"></path></svg>
                    <p>我的</p>
                </a>
            </li>
            <li class="hide">
                <a @click="changeTab('news')" class="tab" :class="{'active' : currentTab == 'news' && keyWord == ''}" role="button">
                    <svg class="icon" style="width: 28px; height: 28px;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M334.7456 114.39104c-110.75584 41.50272-202.4192 121.57952-259.03616 223.74912h181.89824c20.23424-103.49056 51.09248-176.6912 77.13792-223.74912zM492.07296 338.13504V82.86208c-38.82496 1.24416-76.30848 7.44448-112.36864 17.1264-27.49952 45.99296-63.10912 123.24864-85.56544 238.15168h197.93408v-0.00512zM939.648 338.14016c-55.7056-100.52096-144.58368-180.15744-252.87168-222.24384 25.8816 47.08864 56.28928 119.85408 76.32384 222.24384h176.54784zM641.5104 100.79744a498.944 498.944 0 0 0-112.8448-17.9968v255.34464h197.95968c-22.33344-114.26304-57.68704-191.26272-85.11488-237.34784zM706.6368 910.19776c108.7488-41.99936 198.05184-121.6768 253.61408-222.6176h-176.50176c-20.17792 103.4496-51.06176 176.04096-77.11232 222.6176zM549.52448 687.5904v254.60736c38.45632-1.69984 75.94496-7.05024 111.67744-16.96256 27.47904-45.24544 63.01184-122.5984 85.53472-237.63968h-197.21216zM97.08544 687.5904c56.69376 102.43072 148.39808 182.78912 259.54816 224.14848-26.20928-46.5152-57.49248-119.63392-77.88544-224.14848H97.08544zM401.77152 926.08c35.69152 9.48736 72.77568 15.54944 111.16032 16.78336v-255.27296H315.73504c22.67136 115.73248 58.48576 193.34656 86.03648 238.4896zM250.45504 619.76576V404.24448h-27.3408v169.20576L109.92128 404.24448h-29.25056v215.52128h27.3408V450.40128l113.19296 169.36448zM454.79424 429.68064v-25.43616H298.96704v215.52128h160.82432v-25.43616H327.48544v-73.36448h119.2192v-25.27744H327.48544V429.68064zM536.82688 619.76576h29.10208l45.71648-164.21888c1.96096-6.95296 4.06528-15.38048 6.32832-25.28256 0.67584 3.13344 2.92864 11.56608 6.76352 25.28256l45.4144 164.21888h27.4944L756.736 404.24448h-28.66688l-33.80736 138.48576c-4.41344 17.62816-7.99744 33.26976-10.73152 46.88384-3.4304-23.81312-9.02656-49.24416-16.768-76.288l-30.86336-109.08672h-34.39104l-41.02656 145.536c-0.9728 3.52768-4.21376 16.80384-9.70752 39.8336a727.2704 727.2704 0 0 0-9.1136-44.09344l-32.77312-141.27616h-29.25568l57.19552 215.5264zM936.22784 528.24064c-5.98016-8.8576-15.24224-16.19456-27.78624-21.96992-8.6272-3.9168-24.52992-8.50432-47.6928-13.75232-23.17824-5.23776-37.51936-10.36288-43.00288-15.35488-5.58592-5.00224-8.38144-11.37152-8.38144-19.11808 0-8.91392 3.94752-16.53248 11.83232-22.8608 7.88992-6.31808 20.45952-9.48224 37.71392-9.48224 16.55808 0 29.0816 3.4816 37.56032 10.43968 8.46848 6.95808 13.44512 17.24928 14.91456 30.86848l27.3408-2.05312c-0.49152-12.65152-4.02432-23.96672-10.58304-33.96096-6.56896-9.99424-15.94368-17.56672-28.14976-22.71232-12.20608-5.1456-26.28608-7.72096-42.25536-7.72096-14.51008 0-27.6992 2.45248-39.552 7.35232-11.85792 4.89984-20.87936 12.07808-27.04896 21.53472-6.17472 9.46176-9.25696 19.62496-9.25696 30.50496 0 9.90208 2.51392 18.8416 7.56736 26.82368 5.04832 7.99232 12.71296 14.67904 23.00416 20.06528 7.94112 4.21888 21.80096 8.69888 41.60512 13.45024 19.79392 4.75648 32.57856 8.26368 38.36928 10.51648 9.00096 3.42528 15.47776 7.65952 19.39968 12.71808 3.9168 5.0432 5.87776 10.94656 5.87776 17.70496 0 6.66624-2.03264 12.8256-6.10304 18.45248-4.0704 5.65248-10.2656 10.07104-18.59584 13.30176-8.32512 3.24096-17.93536 4.85376-28.81536 4.85376-12.24704 0-23.2704-2.12992-33.07008-6.38976-9.80992-4.26496-17.02912-9.85088-21.6832-16.75776-4.6592-6.912-7.61344-15.75936-8.89344-26.54208l-26.89536 2.36544c0.384 14.40256 4.33664 27.32032 11.8272 38.72768 7.50592 11.41248 17.8432 19.968 31.0272 25.6512s29.52192 8.5248 49.024 8.5248c15.38048 0 29.2352-2.82112 41.51808-8.45312 12.30336-5.62688 21.73952-13.52192 28.29824-23.65952 6.56896-10.1376 9.85088-20.95616 9.85088-32.41984-0.00512-11.56096-2.99008-21.77024-8.96512-30.64832z"></path></svg>
                    <p>新闻</p>
                </a>
            </li>
        </ul>
        <ul class="menu-bottom">
            <li>
                <a href="/help/leverRule" target="_blank">
                    <svg class="icon" style="width: 26px; height: 26px;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M479.6416 695.808l52.6336 0 0 57.344-52.6336 0 0-57.344ZM531.8656 271.1552c-96.1536-5.12-155.0336 38.1952-175.8208 127.7952l-1.1264 4.8128 47.616 14.848 1.2288-5.7344c15.0528-69.3248 54.6816-102.6048 120.4224-100.7616 58.2656 4.5056 89.4976 31.9488 95.4368 84.0704 4.4032 33.3824-19.1488 66.9696-70.144 99.9424-43.3152 30.5152-65.2288 68.096-65.2288 111.7184l0 28.672 43.3152 0 0-26.624c-1.536-33.9968 14.4384-60.6208 48.64-81.408 65.536-36.7616 96.256-80.896 91.3408-131.072C661.1968 318.464 615.5264 275.968 531.8656 271.1552zM512 42.7008C253.2352 42.7008 42.7008 253.2352 42.7008 512S253.2352 981.2992 512 981.2992c258.7648 0 469.2992-210.5344 469.2992-469.2992S770.7648 42.7008 512 42.7008zM512 940.544C275.7632 940.544 83.456 748.2368 83.456 512S275.7632 83.456 512 83.456c236.3392 0 428.544 192.2048 428.544 428.544S748.3392 940.544 512 940.544z"></path></svg>
                    <p>杠杆规则</p>
                </a>
            </li>
            <li>
                <a href="/help/forwardRule" target="_blank">
                    <svg class="icon" style="width: 26px; height: 26px;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M479.6416 695.808l52.6336 0 0 57.344-52.6336 0 0-57.344ZM531.8656 271.1552c-96.1536-5.12-155.0336 38.1952-175.8208 127.7952l-1.1264 4.8128 47.616 14.848 1.2288-5.7344c15.0528-69.3248 54.6816-102.6048 120.4224-100.7616 58.2656 4.5056 89.4976 31.9488 95.4368 84.0704 4.4032 33.3824-19.1488 66.9696-70.144 99.9424-43.3152 30.5152-65.2288 68.096-65.2288 111.7184l0 28.672 43.3152 0 0-26.624c-1.536-33.9968 14.4384-60.6208 48.64-81.408 65.536-36.7616 96.256-80.896 91.3408-131.072C661.1968 318.464 615.5264 275.968 531.8656 271.1552zM512 42.7008C253.2352 42.7008 42.7008 253.2352 42.7008 512S253.2352 981.2992 512 981.2992c258.7648 0 469.2992-210.5344 469.2992-469.2992S770.7648 42.7008 512 42.7008zM512 940.544C275.7632 940.544 83.456 748.2368 83.456 512S275.7632 83.456 512 83.456c236.3392 0 428.544 192.2048 428.544 428.544S748.3392 940.544 512 940.544z"></path></svg>
                    <p>期货规则</p>
                </a>
            </li>
            <li>
                <a href="/help/leverTech" target="_blank">
                    <svg class="icon" style="width: 30px; height: 30px;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M853.5 213.1v-2.2-1.5c0-0.7-0.7-1.5-0.7-2.2v-1.5c0-0.7-0.7-1.5-0.7-2.2 0 0 0-0.7-0.7-0.7l-2.2-2.2c-0.7-0.7-1.5-1.5-3-2.2 0 0-0.7 0-0.7-0.7-0.7-0.7-1.5-0.7-2.2-1.5-0.7 0-0.7 0-1.5-0.7-0.7 0-1.5-0.7-2.2-0.7h-8.8c-0.7 0-0.7 0-1.5 0.7-0.7 0-1.5 0.7-2.2 0.7L126 524c-7.4 3.7-11.2 11.2-10.4 18.6s6.7 14.1 14.9 16.4l267.1 58c1.5 0 3 0.7 3.7 0.7 4.5 0 8.9-1.5 12.6-4.5l401.7-357.8-9.7 447.1-308.7-87c-9.7-3-20.1 3-23.1 12.6-3 9.7 3 20.1 12.6 23.1l64.7 18.6-124.1 144.3v-148c0-10.4-8.2-18.6-18.6-18.6s-18.6 8.2-18.6 18.6V864c0 7.4 4.5 14.9 11.9 17.1 2.2 0.7 4.5 1.5 6.7 1.5 5.2 0 10.4-2.2 14.1-6.7l164.4-190.4c1.5-1.5 2.2-3.7 3-5.2L818.6 745c1.5 0.7 3.7 0.7 5.2 0.7 3.7 0 8.2-1.5 11.2-3.7 4.5-3.7 7.4-8.9 7.4-14.9l11.1-514zM396 579.1l-203.8-44.6 535.6-250.7L396 579.1z"></path></svg>
                    <p>引导</p>
                </a>
            </li>
        </ul>-->
    </div>

    <div class="sidebar-content" :class="currentTab">
        <div class="close hint--left" aria-label="关闭" @click="changeTab(currentTab)">
            <svg class="icon" aria-hidden="true">
                <use xlink:href="#lei-close"></use>
            </svg>
        </div>
        <div class="sidebar-content-head">
            <div class="market-search">
                <input type="text" placeholder="搜索" v-model="keyWord" name="search__1625832957646">
            </div>
        </div>

        <div class="market-list scrollbar" :class="{'simple' : currentShow}" v-if="currentTab != 'news' || keyWord != ''">
            <div class="market-oper flex flex-tb-center flex-lr">
                <div class="common-select" @click="changeShow"><p>精简模式</p><a :class="{'on' : currentShow}" role="button"></a></div>
                <div class="filter flex flex-tb-center">
                    <a role="button" @click="changeSort('volume')" :class="{'up' : sortBy == 'volumeUp', 'down' : sortBy == 'volumeDown'}">成交量</a>
                    <a role="button" @click="changeSort('rate')" :class="{'up' : sortBy == 'rateUp', 'down' : sortBy == 'rateDown'}">涨跌幅</a>
                </div>
            </div>
            <div class="market-mgt" v-if="isLogin && currentTab == 'user'">
                <a role="button" @click="openAddMarket">管理我的市场</a>
            </div>
            <div class="market-box-content">
                <div class="sideScrollbar">
                    <div class="market-box" :class="{'active' : currentMarket == data.market}" v-for="(data,index) in getGroupMarket(currentTab)" @click="gotoTrade(data.market)" v-if="showSider">
                        <div class="market-box-head">
                            <h3><img :src="'/src/images/icon/market-icon/market-' +data.market.split('_')[0]+ '.png'"><b>{{showCoin(data.market)}}</b><i>/</i>{{showMoney(data.market)}}</h3>
                            <div class="ups"><span :class="data.rate >= 0 ? 'red' : 'green'">{{ data.rate >= 0 ? '+' + showRate(data.rate) : '' + showRate(data.rate) }}%</span></div>
                        </div>
                        <a class="market-top" role="button" @click.stop="topUserMarket(data.market)" v-if="index != 0 && currentShow && currentTab == 'user' && keyWord == '' && sortBy == ''">置顶</a>
                        <div class="market-box-body">
                            <div class="chat hint--top" aria-label="最近6小时行情走势">
                                <inline-chart type="line" :settings="getLineChartColor(index, true)" :data="getLineData(data.lineData)"></inline-chart>
                            </div>
                        </div>
                        <div class="market-box-foot">
                            <div class="price"><p>价格</p><span :class="showHintClass(index, data.rate)" :aria-label="showAssistHint(data.lastPrice,data.market)">{{showPrice(data.lastPrice,data.market)}}</span> {{showMoney(data.market)}}</div>
                            <div class="amount"><p>交易量</p><span class="hint--top" :aria-label="showVolumeHint(data.convertVolume)">{{data.volume}}</span> {{showCoin(data.market)}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="news-list scrollbar" v-if="currentTab == 'news' && keyWord == ''">
            <div class="news-box">
                <h3>澳大利亚：澳洲联储银行利率决议： 1.50%</h3>
                <div class="date">2017.11.07 / <span class="hour">16:39</span></div>
                <div class="text">10月供应管理协会（ISM）非制造业综合指数现值为 60.1 点，预期为 58.5 点，前值为 59.8 点。</div>
            </div>
            <div class="news-box">
                <h3>澳大利亚：澳洲联储银行利率决议： 1.50%</h3>
                <div class="date">2017.11.07 / <span class="hour">16:39</span></div>
                <div class="text">10月供应管理协会（ISM）非制造业综合指数现值为 60.1 点，预期为 58.5 点，前值为 59.8 点。</div>
            </div>
            <div class="news-box">
                <h3>澳大利亚：澳洲联储银行利率决议： 1.50%</h3>
                <div class="date">2017.11.07 / <span class="hour">16:39</span></div>
                <div class="text">10月供应管理协会（ISM）非制造业综合指数现值为 60.1 点，预期为 58.5 点，前值为 59.8 点。</div>
            </div>
            <div class="news-box">
                <h3>澳大利亚：澳洲联储银行利率决议： 1.50%</h3>
                <div class="date">2017.11.07 / <span class="hour">16:39</span></div>
                <div class="text">10月供应管理协会（ISM）非制造业综合指数现值为 60.1 点，预期为 58.5 点，前值为 59.8 点。</div>
            </div>
        </div>
    </div>

    <modal v-cloak :open= "showModal == 'addMarket'" @close="showModal = false">
        <add-market :params="marketParams" :done="getUserMarket" />
    </modal>
</div>
<!--引入侧边栏app-->
<script>
    require(['vue', 'common/methods', 'common/juabox'], function (Vue, Methods, JuaBox) {
        EXX.appSider = new Vue({
            el: "#app-sider",
            data: function () {
                return {
                    currentMarket: "safemoon_usdt",
                    //spot现货，forward期货，user用户市场
                    currentTab: ISLOGIN ? 'user' : '_krw',
                    theme: "dark",
                    //精简模式切换
                    currentShow: true,
                    keyWord: '',
                    //rateUp,rateDown,volumeUp,volumeDown,nameUp,nameDown,priceUp,priceDown
                    sortBy: 'rateDown',
                    assistPrice: null,
                    /*currentUserAsset : {
                        userFund : {}
                    },*/
                    //原始的所有市场数据
                    allMarket: '',
                    allMarketArray: [],
                    //用户市场
                    userMarket: '',
                    assistCoin: MONEY,
                    loginUser: Methods.getLocalUserInfo(),
                    isLogin: ISLOGIN,
                    marketConfig: '',
                    marketParams: {},
                    assistList: {
                        'none': {key: 'none', name: "默认", icon: '', symbol: '฿', decimal: 6},
                        /*'btc': {key: 'btc', name: 'BTC', icon: 'icon-btc', symbol: '฿',decimal : 6},*/
                        'usd': {key: 'usd', name: 'USD', icon: 'icon-meiyuan', symbol: '$', decimal: 3},
                        'krw': {
                            key: 'krw',
                            name: 'KRW',
                            icon: '',
                            symbol: '₩',
                            decimal: '3'
                        }
                    },
                    showModal: false,
                    showSider: false,
                    siderScroll: '',
                    lightShowsider: true,

                    websocket: '', //websocket服务，
                    marketAreaList: []
                }
            },
            computed: {
                // 将市场id转为 市场名字符串 返回对象
                marketsIdSwitch: function () {
                    var marketId = {};
                    if (this.marketConfig) {
                        for (var a = 0; a < this.allMarket.length; a++) {
                            for (var b = 0; b < this.marketConfig.length; b++) {
                                if (this.allMarket[a][0] == this.marketConfig[b].marketId) {
                                    // if ((this.allMarket[a][0] + 2) == this.marketConfig[b].marketId){
                                    marketId[this.marketConfig[b].marketId] = this.marketConfig[b].name;  //格式: '1': btc/qtum
                                }
                            }
                        }
                    }
                    return marketId;
                },
                currentAccountId: function () {
                    if (this.isLogin) {
                        return Methods.getCookie(ENV + 'currentAccountId') || Methods.getCookie(ENV + 'uid');
                    }
                },
                currentUserAsset: function () {
                    return EXX.userNav.loginUser;
                },
                isNeedInterval: function () {
                    if (!this.showSider) {
                        return false;
                    }
                    /*if(this.currentTab != 'spot' && this.currentTab != 'forward' && this.currentTab != 'user' && this.keyWord == ''){
                        return false;
                    }*/
                    return true;
                }
            },
            watch: {
                //监听市场数据变化，设置当前市场价格
                allMarket: function (newVal) {
                    //设置K线顶部数据
                    if (EXX.appTradePro && EXX.appTradePro.currentMarketId) {

                        var currMarketId = EXX.appTradePro.currentMarketId;
                        for (var i = 0; i < newVal.length; i++) {
                            if (newVal[i][0] == currMarketId) {
                                /**
                                 *作者: GongQi
                                 *时间: 2018/5/9
                                 *功能: 修改currentPrice的取值在app（EXX.appTradePro中进行）,
                                 */
                                EXX.appTradePro.currentPrice = newVal[i][1]; //当前价格
                                EXX.appTradePro.riseRate = newVal[i][5]; //涨跌幅
                                EXX.appTradePro.highPrice = newVal[i][2]; //最高价
                                EXX.appTradePro.lowPrice = newVal[i][3]; //最低价
                                EXX.appTradePro.volume = newVal[i][4]; //交易量
                                EXX.appTradePro.totalnum = newVal[i][9]; //总成交额

                                EXX.appTradePro.allMarket = this.convertMarket(this.allMarket); //涨跌幅

                                // // EXX.appTradePro.currentPrice = newVal[i][1]; //当前价格
                                // EXX.appTradeHead.riseRate = newVal[i][5]; //涨跌幅
                                // EXX.appTradeHead.highPrice = newVal[i][2]; //最高价
                                // EXX.appTradeHead.lowPrice = newVal[i][3]; //最低价
                                // EXX.appTradeHead.volume = newVal[i][4]; //交易量
                                //
                                // EXX.appTradeHead.allMarket = this.convertMarket(this.allMarket); //涨跌幅
                                if (EXX.appTradePro.allMarketLoading) {
                                    EXX.appTradePro.allMarketLoading = false;
                                }

                                break;
                            }
                        }
                    }
                },
                isNeedInterval: function (newVal, oldVal) {
                    if (newVal === true) {
                        this.getAssistPrice();
                        // this.getAllMarket();
                        this.getUserMarket();
                    }
                },
                currentTab: function (newVal, oldVal) {
                    if (this.currentTab == '' && this.theme == 'light') {
                        this.lightShowsider = false;
                    }
                    if (this.currentTab != '' && this.theme == 'light') {
                        this.lightShowsider = true;
                    }
                }
            },
            methods: {
                // 获取币价汇率-ok
                getAssistPrice: function (callback) {
                    var _this = this;
                    //如果在交易页面就不请求，直接取隔壁数据
                    if (EXX.appTradePro && EXX.appTradePro.assistPrice) {
                        _this.assistPrice = EXX.appTradePro.assistPrice;
                        //callback && callback(EXX.appTradePro.assistPrice);
                        return false;
                    }
                    //不需要的时候不请求
                    if (!this.isNeedInterval) {
                        return false;
                    }
                    Methods.ajax({
                        url: DOMAIN_DEV + "/exchange/config/controller/website/pricecontroller/" + 'getassistprice',
                        success: function (res) {
                            _this.assistPrice = res.datas;
                            callback && callback(res.datas);
                        },
                        error: function () {
                        }
                    });
                },
                // 获取市场配置-ok
                getMarketConfig: function (callback) {
                    var _this = this
                    fn()
                    function fn(){
                        setTimeout(function(){
                        if(EXX.appTradePro.marketConfig){
                            _this.marketConfig = EXX.appTradePro.marketConfig;
                            callback && callback(_this.marketConfig);
                        }else{
                            fn()
                        }
                    },1000)
                    }
                    return
                    var _this = this

                    Methods.ajax({
                        // url: DOMAIN_TRADE + API_PREFIX + 'getMarketConfig',
                        url: DOMAIN_DEV + "/exchange/config/controller/website/marketcontroller/" + 'getByWebId?marketType=0',
                        success: function (res) {
                            _this.marketConfig = res.datas;
                            callback && callback(res.datas);
                        }
                    });
                },
                // 获取所有市场行情- 改为用websocket
                getAllMarket: function (callback) {
                    var _this = this;


                    // 主页和专业交易
                    // Methods.getJSONP({
                    //     url: DOMAIN_TRADE + API_PREFIX + 'getAllMarket?note=side',
                    //     success: function (res) {
                    //         _this.allMarket = res.datas;
                    //         callback && callback(res.datas);
                    //     }
                    // });
                    var wsUrl = WEBSOCKET + '/getMarketList';
                    //建立握手
                    if ('WebSocket' in window) {
                        _this.websocket = new WebSocket(wsUrl);
                    } else if ('MozWebSocket' in window) {
                        _this.websocket = new MozWebSocket(wsUrl);
                    } else {
                        // console.log('Your browser does not support websocket.')
                        return false;
                    }

                    _this.websocket.onopen = function (event) {
                        //离开或者刷新当前页面时
                        window.onbeforeunload = function () {
                            _this.websocket && _this.websocket.close();
                        }
                    };
                    _this.websocket.onmessage = function (event) {
                        console.log(event)
                        // console.log(JSON.parse(event.data))
                        // var res = JSON.parse(event.data);
                        //
                        // if (typeof res.market == 'object') {
                        //     _this.allMarket = res.market;
                        // } else {
                        //     _this.allMarket = [];
                        // }
                    };
                },

                /**
                 *作者: GongQi
                 *时间: 2018/5/10
                 *功能: 接口->Websocket/getMarketList 合并为 Websocket/getMarketList
                 *     函数->doDealTradeStatistic 替换 getAllMarket
                 */
                doDealTradeStatistic: function (data) {
                    var _this = this;
                    var res = data;
                    // console.log(data)
                    if (typeof res.trade_statistic == 'object') {
                        _this.allMarket = res.trade_statistic;
                    } else {
                        _this.allMarket = [];
                    }
                },
                //获取用户市场-ok
                getUserMarket: function (callback) {
                    //不需要的时候不请求
                    if (!this.isNeedInterval || !this.isLogin) {
                        return false;
                    }
                    //alert(callback);
                    Methods.ajax({
                        // url: DOMAIN_MAIN + API_PREFIX + 'getUserMarket',
                        url: DOMAIN_DEV + "/exchange/user/controller/website/usermarketcontroller/" + 'getusermarket',
                        success: function (res) {
                            if (!res.datas) {
                                return console.log('getAllMarket failed.')
                            }

                            this.userMarket = res.datas;
                            callback && callback();
                        }.bind(this)
                    });
                },
                // 设置辅助币种-ok
                setAssistCoin: function (coin) {
                    if (!this.isLogin) {
                        Methods.setCookie(ENV + 'mname', coin);
                        this.assistCoin = coin;
                        top.location.reload();
                        return false;
                    }

                    var data = {
                        assistCoin: coin
                    };
                    Methods.ajax({
                        // url: DOMAIN_MAIN + API_PREFIX + 'editAssistCoin',
                        url: DOMAIN_DEV + "/exchange/user/controller/website/usercontroller/" + 'editassistcoin',
                        data: JSON.stringify(data),
                        success: function (res) {
                            Methods.setCookie(ENV + 'mname', coin);
                            this.assistCoin = coin;
                            top.location.reload();
                        }.bind(this)
                    });
                },
                //获取指定辅助货币的价格
                getPriceByAssist: function (price, market, assist) {
                    if (!price || price == '' || !market || market == '' || this.assistPrice == null) {
                        return ''
                    }
                    var money = market.split('_')[1];
                    //优先取指定的assist
                    var assistCoin = assist || this.assistCoin;
                    if (assistCoin == 'none' || assistCoin == '') {
                        return Methods.fixNumber(price, 4);
                    } else {
                        return Methods.fixNumber(parseFloat(price) * parseFloat(this.assistPrice[assistCoin][money]), this.assistList[assistCoin].decimal) || '--';
                    }
                },
                //获取指定辅助货币的价格
                getVolumeByAssist: function (price, market, assist) {
                    if (!price || price == '' || !market || market == '' || this.assistPrice == null) {
                        return ''
                    }
                    var coin = market.split('_')[0];
                    //优先取指定的assist 默认保留4位小数
                    var assistCoin = assist || this.assistCoin;
                    if (assistCoin == 'none' || assistCoin == '') {
                        return Methods.fixNumber(price, 4);
                    } else {
                        return Methods.fixNumber(parseFloat(price) * parseFloat(this.assistPrice[assistCoin][coin]), 4) || '--';
                    }
                },
                //过滤指定的市场
                getGroupMarket: function (group) {
                    var _this = this;
                    //搜索优先
                    if (this.keyWord != '') {
                        return this.getMarketsForKeyWord(this.keyWord);
                    }
                    var result = [];
                    var allMarket = this.allMarket;
                    var marketConfig = this.marketConfig;
                    var userMarket = this.userMarket;
                    // var userType = this.currentUserAsset.userType;

                    if (allMarket == '' || marketConfig == '') {
                        // console.log('allMarket or marketConfig not init');
                        return result;
                    }
                    if (this.isLogin && this.currentTab == 'user' && userMarket == '') {
                        // console.log('userMarket not init');
                        return result;
                    }

                    allMarket.forEach(function (item, index) {
                        var key = _this.marketsIdSwitch[item[0]];
                        if (group == 'spot') {
                            /*if(marketConfig[key].leverType == 0){
                                if (!this.isLogin) {
                                    if(!marketConfig[key].demoMode){
                                        result[key] = allMarket[key];
                                    }
                                }else{
                                    //区分模拟/真实市场
                                    if(userType != 3 && !marketConfig[key].demoMode){
                                        result[key] = allMarket[key];
                                    }
                                    if(userType == 3 && marketConfig[key].demoMode){
                                        result[key] = allMarket[key];
                                    }
                                }
                            }*/
                        } else if (group == 'forward') {
                            /*if(marketConfig[key].leverType != 0){
                                if (!this.isLogin) {
                                    if(!marketConfig[key].demoMode){
                                        result[key] = allMarket[key];
                                    }
                                }else{
                                    //区分模拟/真实市场
                                    if(userType != 3 && !marketConfig[key].demoMode){
                                        result[key] = allMarket[key];
                                    }
                                    if(userType == 3 && marketConfig[key].demoMode){
                                        result[key] = allMarket[key];
                                    }
                                }
                            }*/
                        } else if (group == 'user') {
                            //用户自选市场
                            userMarket.forEach(function (umarket, idx) {
                                if (item[0] == umarket.marketId) {
                                    result.push(item);
                                    // result[result.length-1].push(umarket.sortId); //将sortId追加到最后面
                                }
                            });
                        } else {
                            if (typeof(key)!="undefined" && key.indexOf(group) != -1) {
                                // 过滤掉模拟市场
                                // if(!allMarket[key][9]){
                                //     result[key] = allMarket[key];
                                // }
                                result.push(item);
                            }
                        }
                    });

                    return this.doSortMarket(this.convertMarket(result));
                },
                //搜索关键字市场
                getMarketsForKeyWord: function (keyword) {
                    var _this = this;
                    // var userType = this.currentUserAsset.userType;
                    // var marketConfig = this.marketConfig;
                    var markets = [];
                    var oriMarkets = this.allMarket;

                    oriMarkets.forEach(function (item, index) {
                        var currMarketName = _this.marketsIdSwitch[item[0]];
                        if (currMarketName.indexOf(keyword.toLowerCase()) != -1) {
                            //过滤后的数组
                            markets.push(item);
                        }
                    });

                    return this.doSortMarket(this.convertMarket(markets));
                },
                //转换对象市场为数组市场(为了排序)
                convertMarket: function (result) {
                    var _this = this;
                    var resultArray = [];

                    result.forEach(function (item, index) {
                        var lineData;
                        try {
                            lineData = JSON.parse(item[6]);
                        } catch (e) {
                            lineData = '';
                        }

                        var obj = {
                            marketId: item[0], //市场id
                            market: _this.marketsIdSwitch[item[0]], //市场名
                            // 价格
                            lastPrice: item[1], //最新价

                            // buyOne : item[4],
                            // sellOne : item[2],
                            highPrice: item[2], //最高价
                            lowPrice: item[3], //最低价

                            // 成交量
                            volume: item[4],
                            //折算交易量为USD排序
                            convertVolume: _this.getVolumeByAssist(item[4], _this.marketsIdSwitch[item[0]], 'usd'),
                            // 走势图
                            lineData: lineData,
                            //涨跌幅
                            rate: item[5],

                            //杠杆倍数
                            // leverRate : _this.marketConfig[key].leverRate,
                            sortId: item[item.length - 1] ? item[item.length - 1] : 0
                        }
                        resultArray.push(obj);
                    });

                    return resultArray;
                },
                //排序的方法
                doSortMarket: function (markets) {
                    var _this = this;
                    var sortBy = this.sortBy;
                    var tab = this.currentTab;
                    if ((tab != 'user' && sortBy == '') || markets.length == 0) {
                        return markets;
                    }
                    markets.sort(function (x, y) {
                        if (sortBy == 'rateUp') {
                            return x.rate - y.rate;
                        } else if (sortBy == 'rateDown') {
                            return y.rate - x.rate;
                        } else if (sortBy == 'volumeUp') {
                            return x.convertVolume - y.convertVolume;
                        } else if (sortBy == 'volumeDown') {
                            return y.convertVolume - x.convertVolume;
                        } else if (sortBy == 'nameUp') {
                            return y.market.substring(0, 1).charCodeAt() - x.market.substring(0, 1).charCodeAt();
                        } else if (sortBy == 'nameDown') {
                            return x.market.substring(0, 1).charCodeAt() - y.market.substring(0, 1).charCodeAt();
                        } else if (sortBy == 'priceUp') {
                            return parseFloat(_this.getPriceByAssist(x.lastPrice, x.market, 'usd')) - parseFloat(_this.getPriceByAssist(y.lastPrice, y.market, 'usd'));
                        } else if (sortBy == 'priceDown') {
                            return parseFloat(_this.getPriceByAssist(y.lastPrice, y.market, 'usd')) - parseFloat(_this.getPriceByAssist(x.lastPrice, x.market, 'usd'));
                        } else if (tab == 'user') {
                            return y.sortId - x.sortId;
                        }

                    });

                    return markets;
                },
                //检查是否是用户自选市场
                checkUserMarket: function (marketid) {
                    var result = false;
                    var userMarket = this.userMarket;
                    for (var i = 0; i < userMarket.length; i++) {
                        if (userMarket[i].marketId == marketid) {
                            result = true;
                        }
                    }
                    return result;
                },
                topUserMarket: function (market) {
                    var data = {
                        marketId: market
                    };
                    Methods.ajax({
                        type: 'GET',
                        // url: DOMAIN_MAIN + API_PREFIX + 'topUserMarket',
                        url: DOMAIN_DEV + "/exchange/user/controller/website/usermarketcontroller/" + 'topusermarket',
                        data: JSON.stringify(data),
                        success: function (res) {
                            this.getUserMarket();
                            $.toast({
                                heading: "修改用户市场成功",
                                text: EXX.L(res.resMsg.message),
                                showHideTransition: 'plain',
                                icon: 'success'
                            });
                        }.bind(this)
                    });
                },
                //获取线图样式
                getLineChartColor: function (index, isClose) {
                    var colors = [
                        ['#58A065', 'rgba(67,144,234,0.08)'],
                        ['#4390EB', 'rgba(67,144,234,0.08)'],
                        ['#F7931A', 'rgba(247, 147, 26, 0.08)'],
                        ['#F5D525', 'rgba(244,213,37,0.08)'],
                        ['#5B646F', 'rgba(91,100,111,0.09)'],
                        ['#0ACC9F', 'rgba(10,204,159,0.08)'],
                        ['#6CA4EF', 'rgba(88,160,101,0.08)']
                    ];

                    var colorsClosed = [
                        ['#666', 'rgba(67,144,234,0.08)']
                    ];

                    if (index >= colors.length) {
                        index = index % colors.length;
                    }
                    var obj = {
                        fill: "",
                        height: 30,
                        stroke: isClose ? colors[index][0] : colorsClosed[0][0],
                        strokeWidth: 1,
                        width: 212
                    };
                    return obj;
                },
                //处理小线图数据
                getLineData: function (array) {
                    if (array.length > 0) {
                        var arr = [];
                        //容错处理

                        if (!array) {
                            array = []
                        }
                        arr = array.map(function (item) {
                            return item[1];
                        });
                        var min = arr[0];
                        for (var i = 0; i < arr.length; i++) {
                            if (arr[i] < min) {
                                min = arr[i]
                            }
                        }
                        var arr2 = arr.map(function (item) {
                            return item - min;
                        });
                        return arr2.join(",");
                    } else {
                        return '';
                    }
                },
                // showPrice: function (val, market) {
                //     if (isNaN(val) || !market) {
                //         return '--'
                //     } else {
                //         return Methods.fixNumber(val, 4)
                //     }
                // },
                showCoin: function (market) {
                    return market.split('_')[0].toUpperCase();
                },
                showMoney: function (market) {
                    return market.split('_')[1].toUpperCase();
                },
                showRate: function (rate) {
                    return Methods.fixNumber(rate, 2)
                },
                showAssistCoin: function (market) {
                    if (!market) {
                        return '--'
                    }
                    var moneyName = market.split('_')[1].toUpperCase();
                    //显示辅助货币名字，不显示默认
                    if (this.assistCoin == 'none') {
                        return moneyName;
                    } else {
                        return this.assistList[this.assistCoin].name || moneyName;
                    }
                },
                showAssistName: function (market) {
                    //显示辅助货币名字，有默认显示
                    return this.assistList[this.assistCoin].name || market.split('_')[1].toUpperCase();
                },
                //价格折合的提示内容
                showAssistHint: function (price, market) {
                    return "折合:" + this.getPriceByAssist(price, market) + " " + this.showAssistCoin(market);
                },
                showHintClass: function (index, rate) {
                    var class1 = index == 0 && this.currentShow ? 'hint--bottom' : 'hint--top',
                        class1 = this.currentShow ? class1 : 'hint--right',
                        class2 = parseFloat(rate) >= 0 ? 'red' : 'green';
                    return class1 + ' ' + class2;
                },
                //交易量折合的提示内容
                showVolumeHint: function (volume) {
                    if (parseFloat(volume) > 10000 && parseFloat(volume) < 100000000) {
                        volume = Methods.fixNumber((parseFloat(volume) / 10000), 2) + "万";
                    }
                    if (parseFloat(volume) > 100000000) {
                        volume = Methods.fixNumber((parseFloat(volume) / 100000000), 4) + "亿";
                    }
                    return "折合:$ " + volume;
                },
                changeShow: function () {
                    if (this.currentShow == true) {
                        this.currentShow = false;
                    } else {
                        this.currentShow = true;
                    }
                },
                //切换市场列表
                changeTab: function (tab) {
                    if (this.currentTab == tab) {
                        $('body').removeClass('side-open');
                        // this.currentTab = ''
                        this.showSider = false;
                    } else {
                        this.currentTab = tab;
                        $('body').addClass('side-open');
                        this.showSider = true;
                        //切换至用户市场清除排序
                        if (tab == 'user' && this.theme == 'dark') {
                            this.sortBy = '';
                        }
                    }
                    //关闭聊天
                    $('body').removeClass('chat-open');
                    $(".exx-msg").removeClass("open");

                    this.initChatScroll();
                    this.keyWord = '';
                },
                //列表排序
                changeSort: function (name) {
                    var sortBy = this.sortBy;
                    var swift = function (name, sort) {
                        if (sort == '') {
                            return name + 'Down';
                        }
                        if (sort.indexOf(name) != -1) {
                            if (sort.indexOf('Down') != -1) {
                                return name + 'Up';
                            }
                            if (sort.indexOf('Up') != -1) {
                                return '';
                            }
                        } else {
                            //递归
                            return arguments.callee(name, '');
                        }
                    }
                    this.sortBy = swift(name, sortBy);
                },
                openAddMarket: function () {
                    this.marketParams = {
                        account: this.currentUserAsset,
                        userMarkets: this.userMarket
                    }
                    this.showModal = 'addMarket';
                },
                gotoTrade: function (market) {
                    market = market.replace('/', '_');

                    if (this.theme == 'light') {
                        top.location.href = '/tradePro/' + market;
                    } else {
                        top.location.href = '/trade/' + market;
                    }
                },
                initChatScroll: function () {
                    if (!this.siderScroll && $('.market-box-content').length > 0) {
                        this.siderScroll = new IScroll('.market-box-content', {
                            mouseWheel: true,
                            scrollbars: "custom",
                            fadeScrollbars: true,
                            bounceEasing: 'quadratic'
                        });
                    }
                    if (this.siderScroll) {
                        this.siderScroll.refresh();
                    }
                },
                //编辑用户市场 type 0 取消   1 添加
                editUserMarket: function (type, marketid) {
                    var url = DOMAIN_DEV + "/exchange/user/controller/website/usermarketcontroller/";
                    if (type == 0) {
                        url += 'deleteusermarket';
                    } else {
                        url += 'addusermarket'
                    }

                    var data = {
                        marketId: marketid
                    };
                    Methods.ajax({
                        // url: DOMAIN_MAIN + API_PREFIX + 'doEditMarket',
                        url: url,
                        data: JSON.stringify(data),
                        success: function (res) {
                            this.getUserMarket();
                            $.toast({
                                heading: "修改用户市场信息成功",
                                text: "修改用户市场信息成功",
                                showHideTransition: 'plain',
                                icon: 'success'
                            });
                        }.bind(this)
                    });
                },
                /**
                 *作者: GongQi
                 *时间: 2018/6/7
                 *功能: 获取交易区
                 */
                getMarketAreaListByWebId: function() {
                    Methods.ajax({
                        url: DOMAIN_DEV + "/exchange/config/controller/website/MarketController/" + 'getMarketAreaListByWebId',
                        success: function (res) {
                            this.marketAreaList=res.datas
                        }.bind(this)
                    });
                },
            },
            created: function () {
                var _this = this;
                //先获取配置和价格表
                _this.getMarketConfig(function () {
                    // setInterval(_this.getAllMarket, 5000);
                    // _this.getAllMarket();
                    setInterval(_this.getAssistPrice, 90000);
                });

                if (_this.theme == 'light') {
                    _this.showSider = true;
                }
            },
            updated: function () {
                this.initChatScroll();
            },
            mounted: function () {
                // this.getMarketAreaListByWebId()
                var _this = this;
                if (_this.isLogin) {
                    _this.getUserMarket();
                }
            },
            beforeDestroy: function () {

            }
        })
    });
</script>

<script type="text/x-template" id="dish-part">
    <div class="plateInside-area">
            <ul class="title">
                <li>
                <p><span>价格({{$parent.moneyName}})</span></p>
                <p><span>数量({{  $parent.coinName=='BCHABC'?'BCH':$parent.coinName }})</span></p>
                </li>
            </ul>
            <div class="body" id="dishWrap">
                <div class="dishWrap_container">
                    <div class="box sell-disc" id="asksWrap" v-if="BrowserType!='FF'">
                        <ul class="tradeNew-table"></ul>
                    </div>
                    <div v-if="BrowserType=='FF'" class="box parent_direction-downs" id="parent_direction-downs">
                        <div class="direction-downss">
                            <ul class="tradeNew-table1"></ul>
                        </div>
                    </div>
                    <div class="current-price">
                        <template v-if="!isNaN(assistPrice)">{{currentPrice}} {{$parent.moneyName}}</template>
                    </div>
                    <div class="box buy-disc" id="bidsWrap">
                        <ul class="tradeNew-table"></ul>
                    </div>
                </div>
                <div class="more">
                    <a href="javascript:;" @click="goinfo"> 更多 </a>
                </div>

            </div>
    </div>


</script>

<script>
    require(['vue', 'common/methods'], function (Vue, Methods) {
        return Vue.component('dish-part', {
            template: "#dish-part",
            props: {
                marketConfig: {
                    type: Object,
                    default: function () {
                        return {}
                    }
                },
                dishData: {
                    type: Object,
                    default: function () {
                        return {}
                    }
                },
                currentMarket: {
                    type: String,
                    default: ''
                }
            },
            data: function () {
                return {
                    dishLength: 50,
                    assistList: this.$parent.assistList,
                    lastDepth: '',
                    buyh:0,
                    sellh:0,
                    dishInterval:null,
                }
            },
            computed: {
                currentPrice: function () {
                    return this.$parent.showMoney(this.$parent.currentPrice);
                },
                assistPrice: function () {
                    return this.$parent.getPriceByAssist(this.currentPrice);
                },
                bids: function () {
                    var oArray = this.dishData.bids;
                    var nArray = [];
                    //获取恰当的买单档位
                    if (oArray && oArray.length > 0) {
                        var ilength = oArray.length;
                        //重新循环赋值才能深复制过来
                        oArray.forEach(function (item, index) {
                            if (ilength > this.dishLength) {
                                if (index < this.dishLength) {
                                    nArray[index] = item;
                                }
                            } else {
                                nArray[index] = item;
                            }
                        }.bind(this));
                    }
                    return nArray;
                },
                asks: function () {
                    var oArray = this.dishData.asks;
                    var nArray = [];
                    //获取恰当的卖单档位(取最后的this.length档)
                    if (oArray && oArray.length > 0) {
                        if (oArray.length > this.dishLength) {
                            for (var i = 0; i < this.dishLength; i++) {
                                nArray[i] = oArray[oArray.length - this.dishLength + i]
                            }
                        } else {
                            for (var i = 0; i < oArray.length; i++) {
                                nArray[i] = oArray[i]
                            }
                        }
                    }
                    return nArray;
                },
                BrowserType: function () {
                    return this.myBrowser()
                }
            },
            methods: {
                myBrowser() {
                    var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串
                    var isOpera = userAgent.indexOf('Opera') > -1;
                    if (isOpera) {
                        return 'Opera';
                    }
                    ; //判断是否Opera浏览器
                    if (userAgent.indexOf('Firefox') > -1) {
                        return 'FF';
                    } //判断是否Firefox浏览器
                    if (userAgent.indexOf('Chrome') > -1) {
                        return 'Chrome';
                    }
                    if (userAgent.indexOf('Safari') > -1) {
                        return 'Safari';
                    } //判断是否Safari浏览器
                    if (userAgent.indexOf('compatible') > -1 && userAgent.indexOf('MSIE') > -1 && !isOpera) {
                        return 'IE';
                    }
                    ; //判断是否IE浏览器
                },
                getMaxDepth: function (depth) {
                    var maxNum = 0;
                    //求卖单最大深度值
                    for (var i = 0; i < depth.length; i++) {
                        if (parseFloat(depth[i][1]) > maxNum) {
                            maxNum = parseFloat(depth[i][1]);
                        }
                    }
                    return maxNum;
                },
                getDepthPencent: function (number, maxNumber) {
                    return Methods.fixNumber(number / maxNumber * 100, 2);
                },
                // showPrice: function (price, type) {
                //     //格式化盘口价格
                //     return Methods.fixNumber(price, this.marketConfig.priceDecimal);
                // },
                showDepth: function (depth, type) {
                    //格式化盘口深度
                    return Methods.fixNumber(depth, this.marketConfig.amountDecimal);
                },
                changeLength: function (len) {
                    this.dishLength = len;
                    this.$parent.dishLength = len;
                },
                clickAsksRow: function (price, index) {
                    var depth = 0,
                        _this = this,
                        len = Math.min(_this.dishLength, _this.asks.length);

                    for (var i = index; i < len; i++) {
                        depth += parseFloat(_this.asks[i][1]);

                    }

                    this.$parent.$refs.tradeFormBuy.flashInput();

                    this.$parent.$refs.tradeFormBuy.inputPrice = price;
                    this.$parent.$refs.tradeFormBuy.inputPriceConvert = this.$parent.getPriceByAssist(price);

                    if (depth == 0){
                        this.$parent.$refs.tradeFormBuy.inputNumber  =''
                    } else{
                        this.$parent.$refs.tradeFormBuy.inputNumber = depth;
                    }

                    this.$parent.$refs.tradeFormSell.inputPrice = price;
                    this.$parent.$refs.tradeFormSell.inputPriceConvert = this.$parent.getPriceByAssist(price);
                    if (depth == 0){
                        this.$parent.$refs.tradeFormSell.inputNumber =''
                    } else{
                        this.$parent.$refs.tradeFormSell.inputNumber = depth;
                    }
                },
                clickBidsRow: function (price, index) {
                    var depth = 0,
                        _this = this;
                    for (var i = 0; i <= index; i++) {
                        depth += parseFloat(_this.bids[i][1]);
                    }
                    this.$parent.$refs.tradeFormSell.flashInput();

                    this.$parent.$refs.tradeFormBuy.inputPrice = price;
                    this.$parent.$refs.tradeFormBuy.inputPriceConvert = this.$parent.getPriceByAssist(price);

                    if (depth == 0){
                        this.$parent.$refs.tradeFormBuy.inputNumber  =''
                    } else{
                        this.$parent.$refs.tradeFormBuy.inputNumber = depth;
                    }



                    this.$parent.$refs.tradeFormSell.inputPrice = price;
                    this.$parent.$refs.tradeFormSell.inputPriceConvert = this.$parent.getPriceByAssist(price);

                    if (depth == 0){
                        this.$parent.$refs.tradeFormSell.inputNumber =''
                    } else{
                        this.$parent.$refs.tradeFormSell.inputNumber = depth;
                    }
                },
                bindSetPrice: function () {
                    var _this = this;
                    $("#asksWrap").on('click', '.body', function () {
                        var price = $(this).find(".price").text();


                        var index = $(this).index();

                        _this.clickAsksRow(price, index);
                        // console.log(price)
                    });
                    $("#parent_direction-downs").on('click', '.body', function () {
                        var price = $(this).find(".price").text();
                        var index = $(this).index();
                        _this.clickAsksRow(price, index);
                    });
                    $("#bidsWrap").on('click', '.body', function () {
                        var price = $(this).find(".price").text();
                        var index = $(this).index();
                        _this.clickBidsRow(price, index);
                    });
                },
                //盘口处理方法
                updateDepth: function (data, callback) {
                    if (!data) {
                        return false;
                    }
                    if (this.BrowserType != 'FF') {
                        var parentAsks = $("#asksWrap .tradeNew-table");
                    } else {
                        var parentAsks = $(".tradeNew-table1");
                    }

                    var parentBids = $("#bidsWrap .tradeNew-table");
                    var asks = data.asks.slice(0);
                    var bids = data.bids.slice(0);
                    if (this.lastDepth == '') {
                        this.lastDepth = {};
                        this.depthInit(asks, parentAsks);
                        this.depthInit(bids, parentBids);
                    } else {
                        var oldasks = this.lastDepth.asks.slice(0);
                        var oldbids = this.lastDepth.bids.slice(0);

                        parentAsks.find(".body.remove").remove();
                        parentAsks.find(".body.add").removeClass("add");
                        this.asksAndBids(asks, oldasks, parentAsks, this.getMaxDepth(asks),'asks');

                        parentBids.find(".body.remove").remove();
                        parentBids.find(".body.add").removeClass("add");
                        this.asksAndBids(bids, oldbids, parentBids, this.getMaxDepth(bids),'bids');
                    }
                    Vue.set(this.lastDepth, 'asks', data.asks.slice(0));
                    Vue.set(this.lastDepth, 'bids', data.bids.slice(0));

                    //刷新辅助货币的价格
                    this.flushAssistPrice();

                    if(this.BrowserType=='FF'){
                        Vue.nextTick(function(){
                            $("#parent_direction-downs").scrollTop(1000)
                        })
                    }
                    callback && callback();

                },
                //初始化盘口
                depthInit: function (data, $obj) {
                    $obj.empty();
                    if (data && data.length > 0) {
                        var view = "";

                        for (var i = 0; i < data.length; i++) {
                            view += this.getRowHtml(data[i], data);
                        }
                        $obj.append(view);

                        view = null;
                        //绑定盘口点击事件
                        this.bindSetPrice();
                    }
                },
                //盘口动画效果
                asksAndBids: function (addasks, oldasks, tbDiv, maxDepth,type) {
                    //第一步比对价格相等的行，对比数量
                    for (var i = 0; i < oldasks.length; i++) {
                        var isExist = false;
                        for (var j = 0; j < addasks.length; j++) {
                            if (parseFloat(oldasks[i][0]) == parseFloat(addasks[j][0])) {
                                isExist = true;
                                if (parseFloat(oldasks[i][1]) != parseFloat(addasks[j][1])) {
                                    //逐行比对
                                    var $amount = tbDiv.find(".body:eq(" + i + ") .num");
                                    var $assist = tbDiv.find(".body:eq(" + i + ") .foldPrice");
                                    //var $depth = tbDiv.find("div:eq(" + i + ") .depth i");
                                    var amount = this.getAmount(addasks[j][1]);
                                    var assist = this.getAssistPrice(addasks[j][0]);
                                    //var depth = this.getDepth(addasks[j], addasks) + '%';
                                    $amount.html("<span class=\"amountColor\">" + amount + "</span>");
                                    $assist.html(assist);
                                }
                                addasks.splice(j, 1);
                                break;
                            }
                        }
                        //若价格不存在则标识要移除
                        if (!isExist) {
                            tbDiv.find(".body:eq(" + i + ")").addClass("remove");
                            tbDiv.find(".body:eq(" + i + ")").slideUp(500,function () {
                                oldasks[i][2] = -1;//标识该数据对应div被移除
                            })
                            // tbDiv.find(".body:eq(" + i + ")").stop().animate({opacity:'0',height:'0'},1000,function () {
                            //
                            // })
                        }
                    }
                    //第二步将新价格插入
                    for (var j = 0; j < oldasks.length; j++) {
                        for (var i = 0; i < addasks.length; i++) {
                            if (parseFloat(addasks[i][0]) > parseFloat(oldasks[j][0])) {
                                var html = this.getRowHtml(addasks[i], addasks, "add");
                                // tbDiv.find(".body:eq(" + i + ")").slideDown(500)

                                tbDiv.find(".body:eq(" + j + ")").before(html);
                                oldasks.splice(j, 0, addasks[i]);
                                addasks.splice(i, 1);
                                break;
                            }
                        }
                    }
                    //剩下的按新行全部插入
                    var totalDiv = "";
                    for (var i = 0; i < addasks.length; i++) {
                        oldasks.push(addasks[i]);
                        totalDiv += this.getRowHtml(addasks[i], addasks, 'add')
                    }
                    //asks  bids
                    if (totalDiv != '') {
                        tbDiv.append(totalDiv);
                    }
                    //执行动画效果
                    // tbDiv.find(".body.add").css({height:'0'});
                    // tbDiv.find(".body.add").stop().animate({height:'24'},500);
                    // setTimeout((function ($remove, $add) {
                    //
                    //     return function () {
                    //         $remove.slideUp(500, function () {
                    //             $(this).remove();
                    //         });
                    //         $add.removeClass("add");
                    //     };
                    // })(tbDiv.find(".body.remove"), tbDiv.find(".body.add")), 500);
                },
                //快速刷新盘口
                quickInitTen: function () {
                    var _this = this;
                    window.clearInterval(_this.dishInterval);
                    //为了加快盘口显示速度连续刷10秒，后面数据更新在获取数据的接口回调中
                    this.updateDepth(this.dishData, function () {

                        var timeOut = 0;
                        _this.dishInterval  = setInterval(function () {
                            _this.updateDepth(_this.dishData);
                            timeOut += 1;
                            if (timeOut > 1) {
                                window.clearInterval(_this.dishInterval);
                            }
                        }, 1000)
                    });

                },
                //刷新盘口和当前价格的辅助货币价格
                flushAssistPrice: function () {
                    var _this = this;
                    $("#dishWrap .tradeNew-table .tr").each(function (i) {
                        var price = $(this).find('.price').text();
                        var assistPrice = _this.$parent.getPriceByAssist(price);
                        $(this).find('.foldPrice').text(assistPrice);
                    });
                },
                getPrice: function (val) {
                    var price = this.$parent.showMoney(val) + '';
                    if (this.marketConfig.amountDecimal == 0) {
                        return [price, 0];
                    } else {
                        return price.split('.');
                    }
                },
                getAssistPrice: function (val) {
                    return this.$parent.getPriceByAssist(val);
                },
                getAmount: function (val) {
                    return this.$parent.showCoin(val);
                },
                getDepth: function (val, data) {
                    return parseFloat(val) / parseFloat(this.getMaxDepth(data)) * 100;
                },
                getRowHtml: function (arr, data, style) {
                    var price = this.getPrice(arr[0]);
                    var amount = this.getAmount(arr[1]);
                    var assist = this.getAssistPrice(arr[0]);
                    //var depth = this.getDepth(arr[1], data);
                    var style = style || '';
                    var html = '';
                    html += "<li class=\"tr body " + style + "\" style=\"display: flex;\">";
                    if (this.marketConfig.amountDecimal == 0) {
                        html += "   <p class=\"td price\"><span class=\"cor1\">" + price[0] + "</span></p>";
                    } else {
                        html += "   <p class=\"td price\"><span class=\"cor1\">" + price[0] + "</span><span class=\"cor2\">." + price[1] + "</span></p>";
                    }
                    // html += "   <p class=\"td foldPrice\">" + assist + "</p>";
                    html += "   <p class=\"td num\"><span>" + amount + "</span></p>";
                    html += "</li>";

                    return html;
                },
                goinfo(){
                    window.location.href = `/info?marketName=${this.marketConfig.name}`
                    // window.open(`/info?marketId=${this.marketConfig.marketId}`)
                },

            },
            watch: {},
            mounted: function () {
                this.bindSetPrice();
                this.quickInitTen();
                $("#bidsWrap .tradeNew-table").empty()
                $("#asksWrap .tradeNew-table").empty()
            },
            updated: function () {

            },
            beforeUpdate: function () {

            },
            beforeDestroy: function () {

            }
        });
    })

</script>

<script type="text/x-template" id="deal-record">
    <div class="plateInside-area">
            <ul class="title">
                <li>
                    <p class="item price"><span>价格({{$parent.moneyName}})</span></p>
                    <p class="item num"><span>数量({{  $parent.coinName=='BCHABC'?'BCH':$parent.coinName }})</span></p>
                    <p class="item time"><span>时间</span></p>
                </li>
            </ul>
            <div class="body" id="tradeRecord">
                <ul class="tradeNew-table" :class="{'showAssistPrice' : showAssistPrice}"></ul>
            </div>
    </div>
</script>

<script>
    require(['vue', 'common/methods'], function (Vue, Methods){
        return Vue.component('deal-record', {
            template: "#deal-record",
            props: {
                marketConfig: {
                    type: Object,
                    default: function () {
                        return {}
                    }
                },
                dealRecord: {
                    type: Array,
                    default: function () {
                        return []
                    }
                },
                currentMarket : {
                    type: String,
                    default: ''
                }
            },
            data: function () {
                return {
                    tradeDate:new Date(),
                    showAssistPrice : false
                }
            },
            computed: {
            },
            methods: {
                dateFormatTf: function (i) {
                    return (i < 10 ? '0' : '') + i;
                },
                dateFormat: function (currentDate) {
                    return currentDate.getFullYear()
                        + "-" + this.dateFormatTf(currentDate.getMonth() + 1)
                        + "-" + this.dateFormatTf(currentDate.getDate())
                        + " " + this.dateFormatTf(currentDate.getHours())
                        + ":" + this.dateFormatTf(currentDate.getMinutes())
                        + ":" + this.dateFormatTf(currentDate.getSeconds());
                },
                //处理成交记录
                setFirstRecord: function (item) {
                    if (item != null && item.length > 0) {
                        //初始化50条交易记录
                        var totalUls = "";
                       
                        for (var i = item.length - 1; i >= 0; i--) {
                            totalUls += this.getRowHtml(item[i]);
                        }
                        $("#tradeRecord .tradeNew-table").html(totalUls);
                    }
                },
                pushTrades: function (array) {
                    // console.log(array)
                    var $this = this;
                    var $trades = $("#tradeRecord .tradeNew-table");
                    var totalUls = "";
                    if (array == '' && array.length == 0) {
                        return false;
                    }
                    for (var i = array.length - 1; i >= 0; i--) {
                        var item = array[i];
                        if (i >= array.length - $this.$parent.tradesLimit) {
                            if (item.tid < $this.$parent.last_trade_tid) continue; //判断时间

                            if (this.$parent.last_trade_tid != 0) {
                                totalUls += $this.getRowHtml(item, 'newclass');
                            } else {
                                totalUls += $this.getRowHtml(item);
                            }
                        }
                    }
                    if ($this.$parent.last_trade_tid != 0) {

                        $trades.prepend(totalUls);//插入在最开始位置
                        // $trades.find(".newclass").css({height:'0'})
                    } else {
                        $trades.append(totalUls);
                    }
                    totalUls = null;
                    // $trades.find(".newclass").animate({height:'24'},500, function () {
                    //     $(this).removeClass("newclass");
                    // });
                    //删除大于100条的数据
                    $trades.find(".tr:gt(" + (this.$parent.tradesLimit - 1) + ")").remove();
                },
                getRowHtml : function (item, newclass) {
                    this.tradeDate.setTime(item.date * 1000);
                    var dateStr = this.dateFormatTf(this.tradeDate.getHours())
                        + ":" + this.dateFormatTf(this.tradeDate.getMinutes())
                        + ":" + this.dateFormatTf(this.tradeDate.getSeconds());
                    var price = this.$parent.showMoney(item.price).split(".");
                    var assist = this.$parent.getPriceByAssist(item.price).split(".");
                    var amount = this.$parent.showCoin(item.amount);
                    var newclass = newclass||''
                    var amountClass = item.type == 'buy' ? 'sellColor' : 'buyColor';
                    var html = "";
                    html += "<li class='tr body "+ newclass +"'>";
                    html += "   <p class=\"td price " + amountClass +"\"><span class=\"cor1\">"+ price[0] +"</span><span class=\"cor2\">."+ price[1] +"</span></p>";
                    html += "   <p class=\"td num\"><span>"+ amount +"</span></p>";
                    html += "   <p class=\"td time\">"+ dateStr +"</p>";
                    html += "</li>";
                    return html;
                },
                clickRow : function (price) {
                    this.$parent.$refs.tradeFormBuy.inputPrice = price;
                    this.$parent.$refs.tradeFormBuy.inputPriceConvert = this.$parent.getPriceByAssist(price);

                    this.$parent.$refs.tradeFormSell.inputPrice = price;
                    this.$parent.$refs.tradeFormSell.inputPriceConvert = this.$parent.getPriceByAssist(price);
                },
                bindSetPrice: function () {
                    var _this = this;
                    $("#tradeRecord").on('click', '.body', function () {
                        var price = $(this).find(".price").text();
                        _this.clickRow(price);
                    });
                },
                //刷新交易记录的辅助货币价格
                flushAssistPrice : function () {
                    var _this = this;
                    $("#tradeRecord .tradeNew-table .tr").each(function (i) {
                        var price = $(this).find('.price').text();
                        var assistPrice = _this.$parent.getPriceByAssist(price);
                        $(this).find('.foldPrice').text(assistPrice);
                        //console.log(assistPrice);
                    });
                }
            },
            watch: {

            },
            mounted: function() {
                /*var _this = this;
                this.updateRecord(this.dealRecord, function () {
                    setInterval(function () {
                        _this.updateRecord(_this.dealRecord);
                    },1000)
                });*/
                this.bindSetPrice();
            },
            updated : function () {

            },
            beforeUpdate: function() {

            },
            beforeDestroy: function() {

            }
        });
    })

</script>

<script type="text/x-template" id="trade-form">
    <!--卖出表单开始-->
    <div class="box" :class="{'flash' : flashForm}" v-if="tradeType == 0">
        <!--<h3>卖出{{coinName}}</h3>-->
        <p class="assets-num">
            可用 <b class="sellColor">{{canUseCoin}} {{coinName=='BCHABC'?'BCH':coinName}}</b></p>
        <div class="form-group">
            <!--原始价格输入-->
            <template v-if="inputPriceMode == 0">
                    <!--<label v-if="tradeMode != 1">价格</label>-->
                    <!--<label class="t" v-if="tradeMode == 1"><span>最低卖出价格{{moneyName}}</span></label>-->
                    <!--<div class="coverPrice">价格折合：<b class="sellColor">{{inputPriceConvert}}</b> {{showAssistCoin}}</div>-->
                    <div class="form-control">
                        <input class="sellColor" type="text" v-model="inputPrice" @input="convertPrice($event,0)" v-on:change="convertPrice($event,0)" />
                        <span class="current-num" v-show="inputPrice == ''  ">卖出价 </span>
                        <!--{{$parent.buyOne}} {{moneyName}}-->
                        <span class="unit">{{moneyName}}</span>
                    </div>

                </template>
            <!--转换价格输入-->
            <template v-if="inputPriceMode != 0">
                    <!--<label v-if="tradeMode != 1">价格</label>-->
                    <!--<label class="t" v-if="tradeMode == 1"><span>最低卖出价格{{showAssistCoin}}</span></label>-->
                    <!--<div class="coverPrice">实际委托价格：<b class="sellColor">{{inputPrice}}</b> {{moneyName}}</div>-->
                    <div class="form-control">
                        <input class="sellColor" type="text" v-model="inputPriceConvert" @input="convertPrice($event,3)" v-on:change="convertPrice($event,3)"/>
                        <span class="current-num" v-show="inputPrice == ''">卖出价{{$parent.getPriceByAssist($parent.buyOne)}}{{showAssistCoin}}</span>
                        <span class="unit">{{showAssistCoin}}</span>
                    </div>
                </template>
            <i class="up" @click="UpDownNumber(0,1)"></i>
            <i class="down" @click="UpDownNumber(0,0)"></i>
        </div>
        <div class="form-group" v-if="tradeMode == 1">
            <template v-if="inputPriceMode == 0">
                    <label class="t"><span>最高卖出价格{{moneyName}}</span></label>
                    <div class="coverPrice">价格折合：<b class="sellColor">{{inputMaxPriceConvert}}</b> {{showAssistCoin}}</div>
                    <input class="sellColor" type="text" v-model="inputMaxPrice" @input="convertPrice($event,1)" v-on:change="convertPrice($event,1)"/>
                </template>
            <template v-if="inputPriceMode != 0">
                    <label class="t"><span>最高卖出价格{{showAssistCoin}}</span></label>
                    <div class="coverPrice">实际委托价格：<b class="sellColor">{{inputMaxPrice}}</b> {{moneyName}}</div>
                    <input class="sellColor" type="text" v-model="inputMaxPriceConvert" @input="convertPrice($event,4)" v-on:change="convertPrice($event,4)"/>
                </template>
        </div>
        <div class="form-group">
            <!--<label>数量</label>-->
            <div class="form-control">
                <input type="text" v-model="inputNumber">
                <span class="current-num" id="sellVolumLable" v="323.19" v-show="inputNumber == ''">卖出量{{canUseCoin}}</span>
                <span class="unit">{{coinName=='BCHABC'?'BCH':coinName}}</span>
            </div>
        </div>
        <div :id="'rangeSlider_' + tradeType" class="range range_sell"><span class="sliderPercent">{{showPercent}}%</span></div>
        <p class="assets-num">
            总计 <b class="sellColor hint--top-left" :aria-label="showAssistTotalAmount">{{totalAmount}} {{moneyName}}</b></p>
        <div class="btn">
            <a @click="doCheckEntrust" class="sellBgColor" role="button" v-html="showButton" :class="{'disabled' : requestLocked || !isLogin}"></a>
        </div>

        <div class="trade-form-modal" v-if="tradeFormModal">
            <div class="trade-form-verification">
                <span class="verification-close" @click="cancelVerification">X</span>
                <div class="verification-title">
                    资金密码
                </div>
                <input id="verification-input" type="password" placeholder="请输入您的资金密码" v-model="verificationPwd">
                <button class="verification-button" @click="verification(verificationPwd)">确定</button>
            </div>
        </div>
    </div>

    <div class="box" :class="{'flash' : flashForm}" v-else="">
        <p class="assets-num">
            可用 <b class="buyColor">{{canUseMoney}} {{moneyName}}</b></p>
        <div class="form-group" v-if="tradeMode == 1">
            <template v-if="inputPriceMode == 0">
                    <label class="t"><span>最低买入价格{{moneyName}}</span></label>
                    <div class="coverPrice">价格折合：<b class="buyColor">{{inputMinPriceConvert}}</b> {{showAssistCoin}}</div>
                    <input class="buyColor" type="text" v-model="inputMinPrice" @input="convertPrice($event,2)" v-on:change="convertPrice($event,2)"/>
                </template>
            <template v-if="inputPriceMode != 0">
                    <label class="t"><span>最低买入价格{{showAssistCoin}}</span></label>
                    <div class="coverPrice">实际委托价格：<b class="buyColor">{{inputMinPrice}}</b> {{moneyName}}</div>
                    <input class="buyColor" type="text" v-model="inputMinPriceConvert" @input="convertPrice($event,5)" v-on:change="convertPrice($event,5)"/>
                </template>
        </div>
        <div class="form-group">
            <template v-if="inputPriceMode == 0">
                    <!--<label v-if="tradeMode != 1"><span>价格</span></label>-->
                    <!--<label class="t" v-if="tradeMode == 1"><span>最高买入价格{{moneyName}}</span></label>-->
                    <!--<div class="coverPrice">价格折合：<b class="buyColor">{{inputPriceConvert}}</b> {{showAssistCoin}}</div>-->
                    <div class="form-control">
                        <input class="buyColor" type="text" v-model="inputPrice" @input="convertPrice($event,0)" v-on:change="convertPrice($event,0)" />
                        <span class="current-num" v-show="inputPrice == ''">买入价 </span>
                        <!--{{$parent.sellOne}}{{moneyName}}-->
                        <span class="unit">{{moneyName}}</span>
                    </div>

                </template>
            <template v-if="inputPriceMode != 0">
                    <!--<label v-if="tradeMode != 1"><span>价格</span></label>-->
                    <!--<label class="t" v-if="tradeMode == 1"><span>最高买入价格{{showAssistCoin}}</span></label>-->
                    <!--<div class="coverPrice">实际委托价格：<b class="buyColor">{{inputPrice}}</b> {{moneyName}}</div>-->
                    <div class="form-control">
                        <input class="buyColor" type="text" v-model="inputPriceConvert" @input="convertPrice($event,3)" v-on:change="convertPrice($event,3)" />
                        <span class="current-num" v-show="inputPrice == ''">买入价{{$parent.getPriceByAssist($parent.sellOne)}}{{showAssistCoin}}</span>
                        <span class="unit">{{showAssistCoin}}</span>
                    </div>

                </template>
        </div>
        <div class="form-group">
            <!--<label>数量</label>-->
            <div class="form-control">
                <input type="text" v-model="inputNumber">
                <span class="current-num" v-show="inputNumber == ''">买入量{{realCanBuyCoin}}</span>
                <span class="unit">{{coinName=='BCHABC'?'BCH':coinName}}</span>
            </div>
        </div>
        <div :id="'rangeSlider_' + tradeType" class="range range_buy">
            <!-- 滑动杆 --><span class="sliderPercent">{{showPercent}}%</span></div>
        <p class="assets-num">
            总计 <b class="buyColor hint--top-left" :aria-label="showAssistTotalAmount">{{totalAmount}} {{moneyName}}</b></p>
        <div class="btn">
            <a @click="doCheckEntrust" class="buyBgColor" role="button" v-html="showButton" :class="{'disabled' : requestLocked || !isLogin}"></a>
        </div>
        <div class="trade-form-modal" v-if="tradeFormModal">
            <div class="trade-form-verification">
                <span class="verification-close" @click="cancelVerification">X</span>
                <div class="verification-title">
                    交易校验
                </div>
                <input id="verification-input-2" type="password" placeholder="资金密码" v-model="verificationPwd">
                <button class="verification-button" @click="verification(verificationPwd)">确定</button>
            </div>
        </div>
    </div>
</script>

<!--引入交易表单app-->
<script>
    function Redirect(redirect) {
        swal({
            title: "请先设置资金密码",
            // text: "即将跳转到上一页",
            icon: "warning",
            buttons: ["立即跳转", false],
            dangerMode: false,
        }).then(function() {
            window.location.href = redirect;
        }).then(function() {
            window.location.href = redirect;
        })
        window.setTimeout(function() {
            window.location.href = redirect;
        }, 3000);
    }
    require(['vue', 'common/methods', 'common/juabox'], function(Vue, Methods, JuaBox) {
        return Vue.component('trade-form', {
            template: "#trade-form",
            props: {
                marketConfig: {
                    type: Object,
                    default: function() {
                        return {};
                    }
                },
                //交易类型 0卖，1买
                tradeType: {
                    type: [String, Number],
                    default: 0
                },
                assistPrice: {
                    type: Object,
                    default: function() {
                        return null;
                    }
                },
                currentUserAsset: {
                    type: Object,
                    default: function() {
                        return null;
                    }
                },
                currentMarket: {
                    type: String,
                    default: "safemoon_usdt"
                }
            },
            data: function() {
                return {
                    exchangeMode: Methods.getCookie(ENV + 'ExchangeMode'),
                    assistMoney: Methods.getCookie(ENV + 'mname') || 'none',
                    isLogin: ISLOGIN,
                    inputPrice: '',
                    inputMaxPrice: '',
                    inputMinPrice: '',
                    inputPriceConvert: '',
                    inputMaxPriceConvert: '',
                    inputMinPriceConvert: '',
                    inputNumber: '',
                    rangeSlider: '',
                    rangePercent: '0.00',
                    requestLocked: false,
                    //委托类型 0限价委托，1批量委托，2计划委托
                    tradeMode: 0,
                    flashForm: false,
                    // showModal: false,
                    securityPassword: '',
                    pubKey: '',
                    rsaKeyId: '',
                    entrustParams: {},
                    tradeFormModal: false,
                    verificationPwd: '',
                    loginUser: Methods.getLocalUserInfo()
                }
            },
            computed: {
                //输入价格模式：0输入原始价格，1输入转换价格
                inputPriceMode: function() {
                    return this.$parent.inputPriceMode;
                },
                showAssistCoin: function() {
                    return this.$parent.showAssistCoin();
                },
                canUseCoin: function() {
                    return this.$parent.canUseCoin;
                },
                canUseMoney: function() {
                    return this.$parent.canUseMoney;
                },
                canUseCoinReal: function() {
                    return this.$parent.canUseCoinReal;
                },
                canUseMoneyReal: function() {
                    return this.$parent.canUseMoneyReal;
                },
                realCanBuyCoin: function() {
                    if (this.inputPrice != '') {
                        return Methods.fixDecimal(this.canUseMoney / this.inputPrice, this.marketConfig.amountDecimal);
                    } else {
                        return this.$parent.canBuyCoin;
                    }
                },
                realCanSellMoney: function() {
                    if (this.inputPrice != '') {
                        return Methods.fixDecimal(this.canUseCoin * this.inputPrice, this.marketConfig.priceDecimal);
                    } else {
                        return this.$parent.canSellMoney;
                    }
                },
                coin: function() {
                    // return this.marketConfig.coin;
                    if (this.marketConfig.name) {
                        return this.marketConfig.name.split("_")[0].toLowerCase();
                    }
                },
                money: function() {
                    // return this.marketConfig.money;
                    if (this.marketConfig.name) {
                        return this.marketConfig.name.split("_")[1].toLowerCase();
                    }
                },
                coinName: function() {
                    // return this.marketConfig.coinName;
                    if (this.marketConfig.name) {
                        return this.marketConfig.name.split("_")[0].toUpperCase();
                    }
                },
                moneyName: function() {
                    // return this.marketConfig.moneyName;
                    if (this.marketConfig.name) {
                        return this.marketConfig.name.split("_")[1].toUpperCase();
                    }
                },
                currentAccountId: function() {
                    return this.$parent.currentAccountId;
                },
                assistRegEx: function() {
                    return new RegExp("^(([1-9]{1}\\d*)|([0]{1}))(\\.(\\d){0," + this.$parent.assistList[this.$parent.assistCoin].decimal + "})?$");
                },
                moneyRegEx: function() {
                    return new RegExp("^(([1-9]{1}\\d*)|([0]{1}))(\\.(\\d){0," + this.marketConfig.priceDecimal + "})?$");
                },
                coinRegEx: function() {
                    return new RegExp("^(([1-9]{1}\\d*)|([0]{1}))(\\.(\\d){0," + this.marketConfig.amountDecimal + "})?$");
                },
                totalAmount: function() {
                    if (this.inputPrice && this.inputNumber && this.tradeMode == 0) {
                        return Methods.fixDecimal(Methods.numMultiply(this.inputPrice, this.inputNumber), this.marketConfig.priceDecimal);
                    } else {
                        return '--';
                    }
                },
                showAssistTotalAmount: function() {
                    if (!isNaN(this.totalAmount)) {
                        return "折合:" + this.$parent.getPriceByAssist(this.totalAmount) + " " + this.showAssistCoin;
                    }
                },
                leverAmount: function() {
                    //计算使用了多少杠杆资金
                    var result = '--';
                    if (this.$parent.currentMarketLever && this.isLogin) {
                        if (this.tradeType == 0 && this.inputNumber > 0) {
                            result = this.inputNumber - this.$parent.getUseable(this.coin);
                            return Methods.fixDecimal(Math.max(result, 0), this.marketConfig.amountDecimal);
                        }
                        if (this.tradeType == 1 && this.totalAmount > 0) {
                            result = this.totalAmount - this.$parent.getUseable(this.money);
                            return Methods.fixDecimal(Math.max(result, 0), this.marketConfig.priceDecimal);
                        }
                    }
                    return result;
                },
                showButton: function() {
                    if (this.isLogin) {
                        if (this.requestLocked) {
                            return "正在提交委托...";
                        }
                        //非开启杠杆的市场不可下单
                        /*if(this.noEntrust){
                            return "当前账号已在其他市场开启杠杆，不可在当前市场下单，请切换账户或切换市场进行下单。";
                        }*/
                        if (this.tradeMode == 0) {
                            if (this.tradeType == 0) {
                                return "卖出 " + `${this.coinName=='BCHABC'?'BCH':this.coinName}`;
                            }
                            if (this.tradeType == 1) {
                                return "买入 " + `${this.coinName=='BCHABC'?'BCH':this.coinName}`;
                            }
                        }
                        if (this.tradeMode == 1) {
                            if (this.tradeType == 0) {
                                return "批量卖出";
                            }
                            if (this.tradeType == 1) {
                                return "批量买入";
                            }
                        }
                        if (this.tradeMode == 2) {
                            if (this.tradeType == 0) {
                                return "计划卖出";
                            }
                            if (this.tradeType == 1) {
                                return "计划买入";
                            }
                        }
                    } else {
                        if (this.tradeType == 0) {
                            return "卖出" + `${this.coinName=='BCHABC'?'BCH':this.coinName}`;
                        }
                        if (this.tradeType == 1) {
                            return "买入" + `${this.coinName=='BCHABC'?'BCH':this.coinName}`;
                        }
                    }

                },
                //单独写的动态计算显示百分比数据
                showPercent: function() {
                    //此处不做超出100%验证，监视属性中计算
                    if (this.isLogin) {
                        if (this.tradeType == 1 && this.inputPrice && this.inputNumber && parseFloat(this.canUseMoney) > 0) {
                            return Methods.fixNumber(this.inputPrice * this.inputNumber / this.canUseMoney * 100, 2);
                        }
                        if (this.tradeType == 0 && this.inputNumber && parseFloat(this.canUseCoin) > 0) {
                            return Methods.fixNumber(this.inputNumber / this.canUseCoin * 100, 2);
                        }
                    }
                    return '0.00';
                },
                priceCover: function() {
                    return this.$parent.getPriceByAssist(this.inputPrice);
                },
                maxPriceCover: function() {
                    return this.$parent.getPriceByAssist(this.inputMaxPrice);
                },
                minPriceCover: function() {
                    return this.$parent.getPriceByAssist(this.inputMinPrice);
                }
            },
            methods: {
                getPubKey: function() {
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_DEV + "/exchange/user/controller/website/baseapicontroller/" + 'getpubkey',
                        success: function(res) {
                            this.pubKey = res.datas.pubKey;
                            this.rsaKeyId = res.datas.keyId;
                        }.bind(this)
                    });
                },
                openTransfer: function(type, coin) {
                    return EXX.userNav.openTransfer(type, this.$parent.currentUserAsset.userId, coin)
                },
                doCheckEntrust: function() {
                    var showError = function(msg) {
                        $.toast({
                            heading: "订单提交错误",
                            text: msg,
                            showHideTransition: 'fade',
                            icon: 'error'
                        });
                    }
                    if (!this.isLogin) {
                        return showError("请先&nbsp;<a href='/login'>登录</a>&nbsp;再进行交易。");
                    }
                    /*if(this.currentMarket == 'bot_qtum'){
                        if(parseFloat(this.inputPrice) > 0.033333 || parseFloat(this.inputMaxPrice) > 0.033333 || parseFloat(this.inputMinPrice) > 0.033333 ){
                            return JuaBox.info("买入价格不得高于预售价格0.033333 QTUM");
                        }
                    }*/
                    /*if (this.noEntrust) {
                        return JuaBox.sure("当前账号已在其他市场开启杠杆，不可在当前市场下单，请切换账户或切换市场进行下单。");
                    }*/
                    //请求锁 防止重复提交
                    if (this.requestLocked) {
                        return showError("您有未完成的订单请求，请稍候再提交。");
                    }
                    var _priceProtect = parseFloat(this.$parent.currentMarketConfig.priceProtect); //价格保护系数
                    var _sellOne = parseFloat(this.$parent.sellOne); //卖一价
                    var _buyOne = parseFloat(this.$parent.buyOne); //买一价
                    var _percentProtect = ((parseFloat(_priceProtect) - 1) * 100).toFixed(2);
                    //校验限价委托表单数据
                    if (this.tradeMode == 0) {
                        if (!this.moneyRegEx.test(this.inputPrice) || this.inputPrice == 0 || this.inputPrice == '') {
                            return showError("请输入正确的委托金额");
                        }
                        if (!this.coinRegEx.test(this.inputNumber) || this.inputNumber == 0 || this.inputNumber == '') {
                            return showError("请输入正确的委托数量");
                        }
                        if (this.inputNumber < parseFloat(this.marketConfig.minAmount)) {
                            return showError("最小下单量" + parseFloat(this.marketConfig.minAmount) + this.coinName);
                        }
                        // minSize
                        if (parseFloat(this.marketConfig.minSize) > parseFloat(this.totalAmount)){
                            return showError("订单最小交易额错误，最小交易额" + parseFloat(this.marketConfig.minSize) + this.moneyName);
                        }
                        //判断是否低于市场价
                        /*if(this.tradeType == 0 && (_sellOne / parseFloat(this.inputPrice) > parseFloat(_priceProtect))){
                            return JuaBox.confirm(EXX.L('卖单价格低于市场价n%',this.inputPrice,_sellOne, _percentProtect),this.doSubmitEntrust);
                        }*/
                        //判断是否高于市场价
                        /*if(this.tradeType == 1 && (parseFloat(this.inputPrice) / _buyOne > parseFloat(_priceProtect))){
                            return JuaBox.confirm(EXX.L('买单价格高于市场价n%',this.inputPrice,_buyOne, _percentProtect),this.doSubmitEntrust);
                        }*/
                        //提交委托
                        this.doSubmitEntrust();
                    }
                    //校验批量委托表单数据
                    if (this.tradeMode == 1) {
                        if (this.tradeType == 0) {
                            if (!this.moneyRegEx.test(this.inputPrice) || this.inputPrice == 0 || this.inputPrice == '' ||
                                !this.moneyRegEx.test(this.inputMaxPrice) || this.inputMaxPrice == 0 || this.inputMaxPrice == '') {
                                return showError("请输入正确的委托金额。");
                            }
                            if (parseFloat(this.inputPrice) > parseFloat(this.inputMaxPrice)) {
                                return showError(EXX.L("批量分散卖出的最低限定价格m应低于最高限定价格n，请重设价格。", this.inputPrice, this.inputMaxPrice));
                            }
                            if (!this.coinRegEx.test(this.inputNumber) || this.inputNumber == 0 || this.inputNumber == '') {
                                return showError("请输入正确的委托数量");
                            }
                            if (this.inputNumber < parseFloat(this.marketConfig.minAmount)) {
                                return showError("最小下单量" + parseFloat(this.marketConfig.minAmount));
                            }
                            //判断是否低于市场价
                            /*if(_sellOne / parseFloat(this.inputPrice) > parseFloat(_priceProtect)){
                                return JuaBox.confirm(EXX.L('卖单价格低于市场价n%',this.inputPrice,_sellOne, _percentProtect),this.doBatchEntrust);
                            }*/
                            this.doBatchEntrust();
                        }
                        if (this.tradeType == 1) {
                            if (!this.moneyRegEx.test(this.inputPrice) || this.inputPrice == 0 || this.inputPrice == '' ||
                                !this.moneyRegEx.test(this.inputMinPrice) || this.inputMinPrice == 0 || this.inputMinPrice == '') {
                                return showError("请输入正确的委托金额");
                            }
                            if (parseFloat(this.inputPrice) < parseFloat(this.inputMinPrice)) {
                                return showError(EXX.L("批量分散买入的最高限定价格m应高于最低限定价格n，请重设价格。", this.inputPrice, this.inputMinPrice));
                            }
                            if (!this.coinRegEx.test(this.inputNumber) || this.inputNumber == 0 || this.inputNumber == '') {
                                return showError("请输入正确的委托数量");
                            }
                            if (this.inputNumber < parseFloat(this.marketConfig.minAmount)) {
                                return showError("请输入正确的委托数量");
                            }
                            //判断是否高于市场价
                            /*if(parseFloat(this.inputPrice) / _buyOne > parseFloat(_priceProtect)){
                                return JuaBox.confirm(EXX.L('买单价格高于市场价n%',this.inputPrice,_buyOne, _percentProtect),this.doBatchEntrust);
                            }*/
                            this.doBatchEntrust();
                        }
                    }
                },
                doSubmitEntrust: function(verification) {
                    var text = '';
                    if (this.tradeType == 0) {
                        text = "价格" + this.inputPrice + "" + this.moneyName + "卖出" + this.coinName + this.inputNumber;
                    } else if (this.tradeType == 1) {
                        text = "价格" + this.inputPrice + "" + this.moneyName + "买入" + this.coinName + this.inputNumber;
                    } else {
                        return console.log('unknown trade type')
                    }
                    // if (this.loginUser.safePwdAuth != 1) {
                    //     return Redirect('/u/account')
                    // }
                    var data = {};
                    if (verification) {
                        data = this.entrustParams
                    } else {
                        data = {
                            // userId: this.currentAccountId,
                            // market: this.currentMarket,
                            // isBuy: this.tradeType,
                            // unitPrice: this.inputPrice,
                            // number: this.inputNumber,
                            // isReal: false

                            // 限价委托
                            // webId: 100,
                            type: this.tradeType, //1买方 0卖方
                            price: this.inputPrice,
                            marketId: this.marketConfig.marketId,
                            userId: this.currentAccountId,
                            rangeType: 0, //0 现价委托 1 区间委托
                            // rangeLowPrice: '', //区间委托的最低价
                            // rangeHighPrice: '', //区间委托的最高价
                            amount: this.inputNumber, //委托数量
                        };
                    }
                    //锁定请求
                    this.requestLocked = true;
                    Methods.ajax({
                        // url: DOMAIN_TRADE + API_PREFIX + 'doEntrust',
                        url: DOMAIN_DEV + "/exchange/entrust/controller/website/EntrustController/" + 'addEntrust',
                        // url: DOMAIN_DEV + '/entrust/entrustController/addEntrust',
                        data: JSON.stringify(data),
                        success: function(res) {
                            // this.showModal = false;
                            this.cancelVerification();
                            //解除请求锁定
                            //清除输入框内容
                            this.clearEntrustInput();
                            //刷新委托和资金
                            EXX.appTradePro.getAccountAssets();

                            $.toast({
                                heading: "订单已执行",
                                text: text,
                                icon: 'success',
                                loader: true,
                                loaderBg: '#9EC600'
                            });
                            setTimeout(function() {
                                EXX.appTradePro.getUserEntrustRecordFromCache()
                            }, 1500)
                        }.bind(this),
                        error: function(res) {
                            let lan = Methods.getCookie(ENV + 'lan') == 'cn' ? 'cn' : 'en'
                            switch (res.resMsg.code) {
                                case "1001":
                                    this.requestLocked = false;

                                    JuaBox.showWrong("请求频繁")
                                    break;
                                case "6077":
                                    this.entrustParams = data;
                                    this.tradeFormModal = true;
                                    break;
                                case "6401":
                                    this.requestLocked = false;

                                    JuaBox.showWrong(res.datas[lan]);
                                    break;
                                case "6402":
                                    this.requestLocked = false;

                                    JuaBox.showWrong(res.datas[lan]);
                                    break;
                                case "6403":
                                    this.requestLocked = false;

                                    JuaBox.showWrong(res.datas[lan]);
                                    break;
                                case "9014":
                                    this.requestLocked = false;

                                    JuaBox.showWrong(res.datas[lan]);
                                    break;
                                case "9013":
                                    this.requestLocked = false;
                                    JuaBox.showWrong(res.datas[lan])
                                        // JuaBox.info(EXX.L(res.resMsg.message));
                                    break;
                                default:
                                    //解除请求锁定
                                    this.requestLocked = false;
                                    JuaBox.showWrong(EXX.L(res.resMsg.message));

                            }
                        }.bind(this)
                    });
                },
                doBatchEntrust: function() {
                    var priceHigh, priceLow;
                    if (this.tradeType == 0) {
                        priceHigh = this.inputMaxPrice;
                        priceLow = this.inputPrice;
                    } else {
                        priceHigh = this.inputPrice;
                        priceLow = this.inputMinPrice;
                    }
                    var data = {
                        // userId: this.currentAccountId,
                        // market: this.currentMarket,
                        // isBuy: this.tradeType,
                        // priceLow: priceLow,
                        // priceHigh: priceHigh,
                        // number: this.inputNumber,
                        // isReal: false

                        // 批量委托
                        // webId: 100,
                        type: this.tradeType, //1买方 0卖方
                        price: this.inputPrice,
                        marketId: this.marketConfig.marketId,
                        userId: this.currentAccountId,
                        rangeType: 1, //0 现价委托 1 区间委托
                        rangeLowPrice: priceLow, //区间委托的最低价
                        rangeHighPrice: priceHigh, //区间委托的最高价
                        amount: this.inputNumber //委托数量
                            // entrustId: '',
                    };
                    //锁定请求
                    this.requestLocked = true;
                    Methods.ajax({
                        // url: DOMAIN_TRADE + API_PREFIX + 'doBatchEntrust',
                        url: DOMAIN_DEV + "/exchange/entrust/controller/website/EntrustController/" + 'addEntrust',
                        // url: DOMAIN_DEV + '/entrust/entrustController/addEntrust',
                        data: JSON.stringify(data),
                        success: function(res) {
                            //解除请求锁定
                            this.requestLocked = false;
                            //清除输入框内容
                            this.clearEntrustInput();
                            //刷新委托和资金
                            EXX.appTradePro.getAccountAssets();

                            // var data = res.datas.split(":");
                            $.toast({
                                heading: "订单已执行",
                                // text : EXX.L("成功批量委托m笔，一共na，总金额va", data[0], data[1], this.coinName, data[2], this.moneyName),
                                text: EXX.L("成功批量委托m笔，一共na，总金额va", 1, data.amount, this.coinName, data.amount * data.rangeHighPrice, this.moneyName),
                                icon: 'success',
                                loader: true,
                                loaderBg: '#9EC600'
                            });
                        }.bind(this),
                        error: function(res) {
                            //解除请求锁定
                            this.requestLocked = false;
                            JuaBox.showWrong(EXX.L(res.resMsg.message));
                            // JuaBox.info(EXX.L(res.resMsg.message));
                        }.bind(this)
                    });
                },
                clearEntrustInput: function() {
                    this.inputPrice = '';
                    this.inputMaxPrice = '';
                    this.inputMinPrice = '';
                    this.inputPriceConvert = '';
                    this.inputMaxPriceConvert = '';
                    this.inputMinPriceConvert = '';
                    this.inputNumber = '';
                },
                changeTradeMode: function(type) {
                    this.tradeMode = type;
                },
                initSlider: function() {
                    var _this = this;
                    var rangeId = "#rangeSlider_" + _this.tradeType;
                    if ($(rangeId).length == 0) {
                        return false;
                    }
                    this.rangeSlider = new BitRange({
                        range: rangeId,
                        step: 0.01,
                        point: 5,
                        delay: 15,
                        slide: function(value, obj) {
                            if (_this.checkSlider()) {
                                _this.rangeSlider.Update(value);
                                _this.rangePercent = value;
                            } else {
                                _this.rangeSlider.Update(0);
                                _this.rangePercent = 0;
                                return false;
                            }
                        }
                    });
                },
                //判断当前滑动杆是否可用
                checkSlider: function() {
                    if (!this.isLogin) {
                        return false;
                    }
                    if (this.tradeType == 0 && this.canUseCoin == 0) {
                        return false;
                    }
                    if (this.tradeType == 1 && (this.canUseMoney == 0 || this.inputPrice == '' || this.inputPrice == 0)) {
                        return false;
                    }
                    return true;
                },
                checkNumberByPercent: function() {
                    if (this.isLogin) {
                        var percent = parseFloat(this.showPercent);
                        //若超过100%则按100%计算
                        if (percent > 100) {
                            percent = 100;
                            if (this.tradeType == 1 && this.inputPrice != '' && this.inputPrice != 0) {
                                this.inputNumber = this.canUseMoney / this.inputPrice;
                            }
                            if (this.tradeType == 0) {
                                this.inputNumber = this.canUseCoin;

                            }
                        }
                        //console.log('监视数量：',percent);
                        if (this.rangeSlider) {
                            this.rangeSlider.Update(percent);
                        }
                    }
                },
                //切换输入框上的label
                toggleLabel: function() {
                    if (this.$parent.theme == 'light') {
                        return false;
                    }
                    $('.box input').on('focus', function() {
                        $(this).parent().addClass('focus');
                    });
                    $('.box input').on('blur', function() {
                        $(this).parent().removeClass('focus');
                    });
                },
                //增加或减少数量、价格
                UpDownNumber: function(type, flag) {
                    //flag 0- 1+
                    //type:
                    //0:inputPrice
                    //1:inputNumber
                    //2:inputMaxPrice
                    //3:inputMinPrice
                    if (!this.isLogin) {
                        return false;
                    }
                    var _this = this;
                    var step = 0.01;

                    switch (type) {
                        case 0:
                            if (this.inputPrice == '' || this.inputPrice == 0) {
                                if (this.tradeType == 0) {
                                    this.inputPrice = this.$parent.buyOne;
                                    this.inputPriceConvert = this.$parent.getPriceByAssist(this.$parent.buyOne);
                                } else {
                                    this.inputPrice = this.$parent.sellOne;
                                    this.inputPriceConvert = this.$parent.getPriceByAssist(this.$parent.sellOne);
                                }
                            } else {
                                if (flag == 0) {
                                    this.inputPrice = this.inputPrice * (1 - step);
                                    this.inputPriceConvert = this.inputPriceConvert * (1 - step);
                                } else {
                                    this.inputPrice = this.inputPrice * (1 + step);
                                    this.inputPriceConvert = this.inputPriceConvert * (1 + step);
                                }
                            }
                            break;
                        case 1:
                            if (this.inputNumber == '' || this.inputNumber == 0) {
                                if (this.tradeType == 0) {
                                    this.inputNumber = this.canUseCoin * step;
                                } else {
                                    this.inputNumber = this.$parent.canBuyCoin * step;
                                }
                            } else {
                                if (flag == 0) {
                                    this.inputNumber = this.inputNumber * (1 - step);
                                } else {
                                    this.inputNumber = this.inputNumber * (1 + step);
                                }
                            }
                            break;
                        case 2:
                            if (this.inputMaxPrice == '' || this.inputMaxPrice == 0) {
                                if (this.tradeType == 0) {
                                    this.inputMaxPrice = this.$parent.buyOne;
                                    this.inputMaxPriceConvert = this.$parent.getPriceByAssist(this.$parent.buyOne);
                                } else {
                                    this.inputMaxPrice = this.$parent.sellOne;
                                    this.inputMaxPriceConvert = this.$parent.getPriceByAssist(this.$parent.sellOne);
                                }
                            } else {
                                if (flag == 0) {
                                    this.inputMaxPrice = this.inputMaxPrice * (1 - step);
                                    this.inputMaxPriceConvert = this.inputMaxPriceConvert * (1 - step);
                                } else {
                                    this.inputMaxPrice = this.inputMaxPrice * (1 + step);
                                    this.inputMaxPriceConvert = this.inputMaxPriceConvert * (1 + step);
                                }
                            }
                            this.inputMaxPrice = Methods.fixFloat(this.inputMaxPrice, this.marketConfig.priceDecimal);
                            this.inputMaxPriceConvert = Methods.fixFloat(this.inputMaxPriceConvert, this.$parent.assistList[this.$parent.assistCoin].decimal);
                            break;
                        case 3:
                            if (this.inputMinPrice == '' || this.inputMinPrice == 0) {
                                if (this.tradeType == 0) {
                                    this.inputMinPrice = this.$parent.buyOne;
                                    this.inputMinPriceConvert = this.$parent.getPriceByAssist(this.$parent.buyOne);
                                } else {
                                    this.inputMinPrice = this.$parent.sellOne;
                                    this.inputMinPriceConvert = this.$parent.getPriceByAssist(this.$parent.sellOne);
                                }
                            } else {
                                if (flag == 0) {
                                    this.inputMinPrice = this.inputMinPrice * (1 - step);
                                    this.inputMinPriceConvert = this.inputMinPriceConvert * (1 - step);
                                } else {
                                    this.inputMinPrice = this.inputMinPrice * (1 + step);
                                    this.inputMinPriceConvert = this.inputMinPriceConvert * (1 + step);
                                }
                            }
                            this.inputMinPrice = Methods.fixFloat(this.inputMinPrice, this.marketConfig.priceDecimal);
                            this.inputMinPriceConvert = Methods.fixFloat(this.inputMinPriceConvert, this.$parent.assistList[this.$parent.assistCoin].decimal);
                            break;
                        default:
                            return false;
                    }
                },
                //转换输入的价格（使用事件触发）
                convertPrice: function(e, type) {
                    var price = e.target.value || e;
                    /*if(price == '' || isNaN(price)){
                        return '--';
                    }*/
                    var aPrice = this.$parent.getPriceByAssist(price);
                    var cPrice = this.$parent.getPriceByPrice(price);
                    switch (type) {
                        case 0:
                            this.inputPriceConvert = aPrice;
                            break;
                        case 1:
                            this.inputMaxPriceConvert = aPrice;
                            break;
                        case 2:
                            this.inputMinPriceConvert = aPrice;
                            break;
                        case 3:
                            this.inputPrice = cPrice;
                            break;
                        case 4:
                            this.inputMaxPrice = cPrice;
                            break;
                        case 5:
                            this.inputMinPrice = cPrice;
                            break;
                        default:
                            return '--'
                    }
                },
                //点选价格后闪烁2秒
                flashInput: function() {
                    this.flashForm = true;
                    setTimeout(function() {
                        this.flashForm = false;
                    }.bind(this), 1000)
                },
                //点选百分百买卖
                setPercent: function(val) {
                    this.rangePercent = parseFloat(val) * 100;
                },
                verification: function(res) {
                    var encryptionPwd = Methods.encryptPwd(res, this.pubKey);
                    this.entrustParams.rsaKeyId = this.rsaKeyId
                    this.entrustParams.securityPassword = encryptionPwd
                    this.doSubmitEntrust(true)
                },
                cancelVerification: function() {
                    this.tradeFormModal = false;
                    this.requestLocked = false;
                    this.entrustParams = {};
                    this.verificationPwd = ''
                },
                isLegalCoin: function(name) {
                    var coinConfig = this.$parent.coinConfig
                    for (var i = 0; i < coinConfig.length; i++) {
                        if (coinConfig[i].name == name) {
                            return coinConfig[i].isLegalCoin
                        }
                    }
                }
            },
            watch: {
                //inputPrice && inputPriceConvert，
                //inputMaxPrice && inputMaxPriceConvert，
                //inputMinPrice && inputMinPriceConvert
                //这三对属性无法在监视属性中相互触发，否则会陷入死循环，已改为事件单独触发同步，待优化解决
                inputPrice: function(newVal, oldVal) {
                    //监视数据不合格则先转换
                    if (!this.moneyRegEx.test(newVal) && newVal != '') {
                        this.inputPrice = Methods.checkDecimal(newVal, this.marketConfig.priceDecimal);
                    }
                    this.checkNumberByPercent();
                    //this.inputPriceConvert = this.$parent.getPriceByAssist(newVal);
                },
                inputMaxPrice: function(newVal, oldVal) {
                    //监视数据不合格则先转换
                    if (!this.moneyRegEx.test(newVal) && newVal != '') {
                        this.inputMaxPrice = Methods.checkDecimal(newVal, this.marketConfig.priceDecimal);
                    }
                    //this.inputMaxPriceConvert = this.$parent.getPriceByAssist(newVal);
                },
                inputMinPrice: function(newVal, oldVal) {
                    //监视数据不合格则先转换
                    if (!this.moneyRegEx.test(newVal) && newVal != '') {
                        this.inputMinPrice = Methods.checkDecimal(newVal, this.marketConfig.priceDecimal);
                    }
                    //this.inputMinPriceConvert = this.$parent.getPriceByAssist(newVal);
                },
                inputNumber: function(newVal, oldVal) {
                    //监视数据不合格则先转换
                    if (this.isLogin && this.tradeType == 1 && this.canUseMoney == 0) {
                        //登陆后若没有资金则不赋值
                        this.inputNumber = "0";
                    }
                    if (this.isLogin && this.tradeType == 0 && this.canUseCoin == 0) {
                        //登陆后若没有资金则不赋值
                        this.inputNumber = "0";
                    }
                    if (!this.coinRegEx.test(newVal) && newVal != '') {
                        this.inputNumber = Methods.checkDecimal(newVal, this.marketConfig.amountDecimal);
                    }
                    this.checkNumberByPercent();
                },
                inputPriceConvert: function(newVal, oldVal) {
                    //监视数据不合格则先转换
                    if (!this.assistRegEx.test(newVal) && newVal != '') {
                        this.inputPriceConvert = Methods.checkDecimal(newVal, this.$parent.assistList[this.$parent.assistCoin].decimal);
                    }
                },
                inputMaxPriceConvert: function(newVal, oldVal) {
                    //监视数据不合格则先转换
                    if (!this.assistRegEx.test(newVal) && newVal != '') {
                        this.inputMaxPriceConvert = Methods.checkDecimal(newVal, this.$parent.assistList[this.$parent.assistCoin].decimal);
                    }
                },
                inputMinPriceConvert: function(newVal, oldVal) {
                    //监视数据不合格则先转换
                    if (!this.assistRegEx.test(newVal) && newVal != '') {
                        this.inputMinPriceConvert = Methods.checkDecimal(newVal, this.$parent.assistList[this.$parent.assistCoin].decimal);
                    }
                },
                rangePercent: function(newVal, oldVal) {
                    if (newVal > 0) {
                        if (this.tradeType == 0) {
                            this.inputNumber = this.canUseCoin * newVal * 0.01;
                        } else {
                            this.inputNumber = this.canUseMoney / this.inputPrice * newVal * 0.01;
                        }
                    } else {
                        this.inputNumber = '';
                    }
                },
                tradeMode: function() {
                    setTimeout(this.toggleLabel, 300);
                },
                inputPriceMode: function() {
                    setTimeout(this.toggleLabel, 300);
                }
            },
            created: function() {

            },
            mounted: function() {
                this.getPubKey();
                //this.initSlider();
                this.toggleLabel();
                //解决有时候不显示
                setTimeout(this.initSlider, 3000);
            },
            beforeUpdate: function() {

            },
            beforeDestroy: function() {

            }
        });
    })
</script>

<script type="text/x-template" id="vue-modal">
  <transition name="modal">
    <div v-if="open" class="exx-modal-mask" >
      <div ref="modal" class="exx-modal-wrap">
        <div @click="close" class="closebutton"></div>
        <slot>
        </slot>
      </div>
    </div>
  </transition>
</script>

<script>
    /***********
     **Vue 弹窗组件
     ************/
    require(['vue'], function (Vue) {
        return Vue.component('modal', {
            template: "#vue-modal",
            props: {
                open: {
                    type: Boolean,
                    default: false
                }
            },
            data: function () {
                return {}
            },
            computed: {

            },
            watch : {
                open : function (newVal,oldVal) {
                    if(newVal == true){
                        $('body').addClass('modal-open');
                    }else{
                        $('body').removeClass('modal-open');
                    }
                }
            },
            methods: {
                close: function () {
                    this.$emit('close');
                },
                handleClickOutside: function (e) {
                    var el = this.$refs.modal;
                    if (el && !el.contains(e.target)) {
                        //this.open = false;
                    }
                }
            },
            updated: function () {
            },
            mounted: function () {
                document.addEventListener("keydown", function (e) {
                    if (this.open && e.keyCode == 27) {
                        this.close();
                    }
                });
                document.addEventListener('click', this.handleClickOutside, true);
            },
            beforeDestroy: function () {
                document.removeEventListener('click', this.handleClickOutside, true)
            }
        });
    })

</script>


<!--引入交易app-->
<script>
    require(['vue', 'common/methods', 'common/juabox', 'mathjs/dist/math.min'], function(Vue, Methods, JuaBox) {
        EXX.appTradePro = new Vue({
            el: "#app-trade-pro",
            data: function() {
                return {
                    //风格类型
                    theme: '',
                    //当前市场
                    currentMarket: 'safemoon_usdt', //当前市场格式为 qtum_btc 要转为marketId
                    coin: 'safemoon',
                    money: 'usdt', // 当前市场买方币
                    coinName: 'SAFEMOON',
                    moneyName: 'USDT',
                    siteTitle: document.title,
                    assistPrice: null,
                    showLeverInfo: false,
                    lastAssetTime: 0,
                    currentUserAsset: {
                        userFund: {},
                        marketLevers: {}
                    },
                    allMarket: null,
                    allMarketLoading: true,
                    currentMarketData: null,
                    assistCoin: MONEY,
                    loginUser: Methods.getLocalUserInfo(),
                    isMobile: Methods.isMobile(),
                    isLogin: ISLOGIN,
                    marketConfig: null,
                    coinConfig: '',
                    //get方法获取盘口的数量
                    depthShowSize: 50,
                    //大众版控制的盘口数量
                    dishLength: 5,
                    currentPrice: "--",
                    highPrice: '--',
                    lowPrice: '--',
                    volume: '--',
                    riseRate: '0.00',
                    buyOne: '',
                    sellOne: '',
                    lastDepth: {
                        asks: [],
                        bids: [],
                        maxbBids: "0",
                        maxbAsks: "0"
                    },
                    dishFull: false,
                    dealRecord: [],
                    tradesLimit: 100,
                    last_trade_tid: 0,
                    rateClass: 'text-primary trading-redcolor',
                    priceClass: 'text-primary trading-redcolor',
                    arrowClass: 'icon-arrowup',
                    entrustingRecord: [],
                    entrustingRecordTime: 0,
                    entrustingRecordLenght: 0,
                    entrustRecord: [],
                    entrustTab: [
                        ['doing', "正在进行的委托"],
                        ['history', "历史委托"]
                    ],
                    currentEntrustTab: 'doing',
                    assistList: {
                        'none': {
                            key: 'none',
                            name: "默认",
                            icon: '',
                            symbol: '฿',
                            decimal: 6
                        },
                        //'btc': {key: 'btc', name: 'BTC', icon: 'icon-btc', symbol: '฿',decimal : 6},
                        'usd': {
                            key: 'usd',
                            name: 'USD',
                            icon: 'icon-meiyuan',
                            symbol: '$',
                            decimal: 6
                        },
                        'krw': {
                            key: 'krw',
                            name: 'KRW',
                            icon: '',
                            symbol: '₩',
                            decimal: '3'
                        }
                    },
                    showModal: false,
                    billParams: {},
                    userParams: {},
                    entrustParams: {},
                    refundParams: {},
                    currentTradeMode: 0,
                    chartType: 'kline',
                    kline: {
                        period: '15m',
                        theme: 'dark',
                        money: MONEY,
                        chartStyle: '',
                        mIndic: '',
                        indicsStatus: '',
                        toolStatus: ''
                    },
                    //输入价格模式：0输入原始价格，1输入转换价格
                    inputPriceMode: Methods.getCookie(ENV + 'inputPriceMode') || 0,
                    //开盘时间处理
                    marketOpenTime: ['-', '-', '-', '-'],
                    marketOpenStatus: false,
                    marketStartTime: '--',
                    entrustScroll: '',
                    localCoin: 'krw', // 当地法币
                    allFlag: true, //默认true获取全量数据, K线价格切换时,必须接收全量数据显示.
                    cancelEntrustList: [],
                    isRepeat: false,
                    serverTime: '',
                    totalnum: '',
                    //websocket消息 计算属性
                    // klineData: '',
                    // entrustData: '',
                    // tradeData: '',
                    loading: false,
                    cnyprice: [], //转换价格
                    usdprice: [], //转换价格
                    selectlan: false,
                    // userEntrustRecordFromCache: {
                    //     pageIndex: 1,
                    //     pageSize: 15,
                    //     pageCount: 0
                    // }
                    searchMarketOp: '',
                    tickersList: [],
                    searchList: [],
                    MainMarket: [], //搜索推荐区
                    searchMainMarket: '',
                    transactionAmount: '3000',
                    isshowData: false,
                    isLock: false,
                    userAssets: [],
                    tradeKey1: 1,
                    tradeKey2: 100,
                    dishKey: 10000,
                    dealKey: 1000000,
                    openMarketInterval: {},
                    period: '15m',
                    domDev: DISH_API,
                    tId1: null,
                    tId2: null,
                    tId3: null,
                    tId4: null,
                    wsUrl: 'wss://kline.zbg.io',
                    DOMAIN_DEV: '',
                    mainLoding: true,
                }
            },
            computed: {
                //转化marketId
                currentMarketId: function() {

                    var currentMarkets = this.currentMarket;

                    var marketId = '';
                    if (this.marketConfig) {

                        this.marketConfig.forEach(function(coin, index) {
                            if (coin.name == currentMarkets) {
                                marketId = coin.marketId;
                            }
                        });
                    }
                    return marketId;
                },
                /**
                 * 格式化用户资产数据
                 * 将金额不为0的货币与所有货币列表整合
                 */
                userCoinFunds: function() {
                    var coins = this.coinConfig || [];
                    var userAssets = this.userAssets;

                    var coinAssets = [];
                    coins.forEach(function(coin, index, array) {
                        var coinItem = coin;
                        userAssets.forEach(function(asset, idx, arr) {
                            if (coin.currencyId == asset.currencyTypeId) {
                                for (var k in asset) {
                                    coin[k] = asset[k];
                                }
                            }
                        });
                        coinAssets.push(coinItem);
                    }.bind(this));

                    return coinAssets;
                },
                // K线消息
                klineData: function() {
                    var time = this.kline.period.toUpperCase();
                    if (time == 'LINE') {
                        //分时 传1M
                        time = '1M';
                    }
                    return this.currentMarketId + '_KLINE_' + time + '_' + this.currentMarket
                        .toUpperCase();
                    // return '90_KLINE_5M_qc_btc';
                },
                //委托盘口消息
                entrustData: function() {
                    return this.currentMarketId + '_ENTRUST_ADD_' + this.currentMarket
                        .toUpperCase();
                    // return "90_ENTRUST_ZB";
                },
                //交易记录消息
                tradeData: function() {
                    return this.currentMarketId + '_TRADE_' + this.currentMarket.toUpperCase();
                    // return "90_TRADE_ZB"
                },
                trade24Data: function() {
                    return this.currentMarketId + '_TRADE_STATISTIC_24H';
                    // return "90_TRADE_ZB"
                },
                currentMarketConfig: function() {
                    var _this = this;
                    if (_this.marketConfig) {
                        // 过滤出当前市场信息
                        var config = {};
                        _this.marketConfig.forEach(function(market, index) {
                            if (market.name == _this.currentMarket) {
                                config = market;
                            }
                        });

                        //处理模拟盘的币种名称
                        /*if(config.demoMode) {
                            config.coinName = config.coinName.substring(1);
                            config.moneyName = config.moneyName.substring(1);
                            _this.coinName = config.coinName;
                            _this.moneyName = config.moneyName;
                        }*/
                        return config;
                    } else {
                        return {}
                    }
                },
                currentMarketLever: function() {
                    if (!this.currentUserAsset.marketLevers) {
                        this.currentUserAsset.marketLevers = {}
                    }
                    return this.currentUserAsset.marketLevers[this.currentMarket];
                },
                currentAccountId: function() {
                    if (this.isLogin) {
                        // return Methods.getCookie(ENV + 'currentAccountId') || Methods.getCookie(ENV + 'uid');
                        return this.loginUser.userId;
                    }
                },
                canUseCoinReal: function() {
                    if (this.isLogin) {
                        return this.showCoin(this.getUseable(this.coin));
                    } else {
                        return "--";
                    }
                },
                canUseMoneyReal: function() {
                    if (this.isLogin) {
                        return this.showMoney(this.getUseable(this.money));
                    } else {
                        return "--";
                    }
                },
                canUseCoin: function() {
                    if (this.isLogin) {
                        return this.showCoin(this.getUseable(this.coin));
                    } else {
                        return "--";
                    }
                },
                canUseMoney: function() {
                    if (this.isLogin) {
                        return this.showMoney(this.getUseable(this.money));
                    } else {
                        return "--";
                    }
                },
                canBuyCoinReal: function() {
                    if (!this.isLogin || !this.assistPrice) {
                        return '--';
                    } else {
                        var canbuy = Methods.numMultiply(this.getUseable(this.money), Methods
                            .numDivider(this.assistPrice.usd[this.money], this.assistPrice.usd[
                                this.coin]));
                        return this.showCoin(canbuy);
                    }
                },
                canSellMoneyReal: function() {
                    if (!this.isLogin || !this.assistPrice) {
                        return '--';
                    } else {
                        var cansell = Methods.numMultiply(this.getUseable(this.coin), Methods
                            .numDivider(this.assistPrice.usd[this.coin], this.assistPrice.usd[
                                this.money]));
                        return this.showMoney(cansell);
                    }
                },
                canBuyCoin: function() {
                    if (!this.isLogin || !this.assistPrice) {
                        return '--';
                    } else {
                        var canbuy = Methods.numMultiply(this.getUseable(this.money), Methods
                            .numDivider(this.assistPrice.usd[this.money], this.assistPrice.usd[
                                this.coin]));
                        return this.showCoin(canbuy);
                    }
                },
                canSellMoney: function() {
                    if (!this.isLogin || !this.assistPrice) {
                        return '--';
                    } else {
                        var cansell = Methods.numMultiply(this.getUseable(this.coin), Methods
                            .numDivider(this.assistPrice.usd[this.coin], this.assistPrice.usd[
                                this.money]));
                        return this.showMoney(cansell);
                    }
                },
                canLoanCoin: function() {
                    if (!this.isLogin || !this.currentUserAsset.coinFundMap || !this
                        .currentUserAsset.coinFundMap[this.coin]) {
                        return '--';
                    } else {
                        return this.showCoin(this.currentUserAsset.coinFundMap[this.coin].canLoan);
                    }
                },
                canLoanMoney: function() {
                    if (!this.isLogin || !this.currentUserAsset.coinFundMap || !this
                        .currentUserAsset.coinFundMap[this.money]) {
                        return '--';
                    } else {
                        return this.showMoney(this.currentUserAsset.coinFundMap[this.money]
                            .canLoan);
                    }
                },
                hasLoanCoin: function() {
                    if (!this.isLogin || !this.currentUserAsset.coinFundMap || !this
                        .currentUserAsset.coinFundMap[this.coin]) {
                        return '--';
                    } else {
                        return this.showCoin(this.currentUserAsset.coinFundMap[this.coin].loanIn);
                    }
                },
                hasLoanMoney: function() {
                    if (!this.isLogin || !this.currentUserAsset.coinFundMap || !this
                        .currentUserAsset.coinFundMap[this.money]) {
                        return '--';
                    } else {
                        return this.showMoney(this.currentUserAsset.coinFundMap[this.money].loanIn);
                    }
                },
                leverRiskWord: function() {
                    if (!this.isLogin || !this.currentMarketLever) {
                        return '--';
                    } else {
                        var leverRatioStatus = parseFloat(this.currentMarketLever.leverRatioStatus);
                        var wordArray = [
                            "--",
                            "低",
                            "中",
                            "高",
                            "平仓中"
                        ];
                        return wordArray[leverRatioStatus];
                    }
                },
                leverSliderPecent: function() {
                    if (!this.isLogin || !this.currentMarketLever) {
                        return 0;
                    } else {
                        var userRatio = parseFloat(this.currentMarketLever.userRatio);
                        return parseFloat(userRatio).toFixed(2);
                    }
                },
                depthChartOptions: function() {
                    var asks = this.lastDepth.asks.slice(0).reverse() || [];
                    var bids = this.lastDepth.bids.slice(0) || [];
                    var currentPrice = [
                        [Number(this.currentPrice), 0]
                    ];
                    var sumAsks = 0;
                    var sumBids = 0;
                    var fasks = asks.map(function(ask, index) {
                        if (index > 0) {
                            sumAsks = (Number(ask[1]) + Number(sumAsks)).toFixed(4);

                        } else {
                            sumAsks = ask[1]
                        }
                        return [Number(ask[0]), Number(sumAsks)];
                    });

                    var fbids = bids.map(function(bid, index) {
                        if (index > 0) {
                            sumBids = (Number(bid[1]) + Number(sumBids)).toFixed(4);
                        } else {
                            sumBids = bid[1]
                        }
                        return [Number(bid[0]), Number(sumBids)];
                    });
                    fbids.reverse();
                    var opts = {
                        title: null,
                        rangeSelector: {
                            selected: 1
                        },
                        rangeSelector: {
                            enabled: false
                        },
                        exporting: {
                            enabled: false
                        },
                        credits: {
                            enabled: false
                        },
                        chart: {
                            alignTicks: true,
                            plotBorderColor: '#3C3F46',
                            plotBorderWidth: 1,
                            backgroundColor: "#292d37",
                            marginBottom: 50
                        },
                        legend: {
                            enabled: false,
                            backgroundColor: "transparent",
                            y: 20,
                            shadow: false,
                            itemHoverStyle: {
                                color: '#EBEBEB'
                            },
                            itemStyle: {
                                cursor: 'pointer',
                                color: '#333'
                            }
                        },
                        xAxis: {
                            title: null,
                            labels: {
                                formatter: function() {
                                    return this.value;
                                }
                            },
                            minPadding: 0.001,
                            maxPadding: 0.001,
                            tickWidth: 1,
                            tickLength: 5,
                            tickColor: "#3C3F46",
                            lineColor: "#3C3F46"
                        },
                        yAxis: [{
                            type: 'datetime',
                            title: null,
                            reversed: true
                        }, {
                            title: null,
                            labels: {
                                format: "{value}"
                            },
                            opposite: true,
                            min: 0,
                            gridLineDashStyle: 'solid',
                            gridLineColor: "#3C3F46",
                            gridLineWidth: 1
                        }],
                        plotOptions: {
                            areaspline: {
                                marker: {
                                    symbol: 'circle',
                                    radius: 0,
                                    states: {
                                        hover: {
                                            enabled: true
                                        }
                                    }
                                }
                            },
                            scatter: {
                                radius: 5,
                                marker: {
                                    radius: 5,
                                    symbol: "triangle-down"
                                },
                                states: {
                                    hover: {
                                        enabled: false
                                    },
                                    select: {
                                        enabled: false
                                    }
                                },
                                tooltip: {
                                    headerFormat: ' <b>{series.name}</b><br>',
                                    pointFormat: ' <b>{point.x}'
                                },
                                cursor: "pointer"
                            }
                        },
                        series: [{
                            name: "卖单",
                            data: fasks,
                            type: 'areaspline',
                            color: "#31c871",
                            yAxis: 1,
                            zIndex: 1
                        }, {
                            name: "最新价",
                            data: currentPrice,
                            type: 'scatter',
                            color: "#6baffb",
                            yAxis: 1,
                            zIndex: 2
                        }, {
                            name: '买单',
                            data: fbids,
                            type: 'areaspline',
                            color: "#de211d",
                            yAxis: 1,
                            zIndex: 1
                        }]
                    };
                    var isLight = top.location.href.indexOf('/tradePro') != -1;
                    if (isLight) {
                        opts.chart.plotBorderColor = "#fff";
                        opts.chart.backgroundColor = "#fff";
                        opts.yAxis[1].gridLineColor = "#eee";
                    }

                    return opts;
                },
                klineFrame: function() {
                    return document.getElementById('marketFrame').window || document.getElementById(
                        'marketFrame').contentWindow;
                },
                // searchMarket() {
                //     var _this = this
                //     var arr = []
                //     if (this.allMarket.length) {
                //         this.allMarket.forEach(function (val, index) {
                //             var str = val.market.replace('_', '/')
                //
                //             if (str.indexOf(_this.searchMarketOp.toLowerCase()) != -1) {
                //
                //                 for (let i = 0; i < _this.marketConfig.length; i++) {
                //                     var el = _this.marketConfig[i]
                //
                //
                //                     if (el.marketId == val.marketId) {
                //                         val.type = el.type
                //                     }
                //                 }
                //                 arr.push(val)
                //             }
                //         })
                //         return arr
                //     } else {
                //
                //         return arr
                //     }
                //
                // },
                // recommendMarket(){
                //     var _this = this
                //     var arr = []
                //     if(this.allMarket.length){
                //         this.allMarket.forEach(function(val,index){
                //
                //             for (let i = 0; i < _this.marketConfig.length; i++) {
                //                 var el = _this.marketConfig[i]
                //
                //                 if (el.marketId == val.marketId) {
                //                     val.type = el.type
                //                 }
                //             }
                //             arr.push(val)
                //         })
                //         return arr
                //
                //     } else{
                //
                //         return arr
                //     }
                // }
            },

            watch: {
                currentPrice: function(newVal, oldVal) {
                    if (!isNaN(newVal)) {
                        document.title = newVal + ' ' + this.siteTitle;
                    }
                    if (!isNaN(newVal) && !isNaN(oldVal)) {
                        if (parseFloat(newVal) > parseFloat(oldVal)) {
                            this.priceClass = 'text-primary trading-redcolor';
                            this.arrowClass = 'icon-arrowup';
                        } else {
                            this.priceClass = 'text-second trading-greencolor';
                            this.arrowClass = 'icon-arrowdown ';
                        }
                    }
                },
                riseRate: function(newVal, oldVal) {
                    if (!isNaN(newVal)) {
                        if (parseFloat(newVal) >= 0) {
                            this.riseRate = '+' + parseFloat(this.riseRate);
                            this.rateClass = 'text-primary buyColor';
                        } else {
                            this.rateClass = 'text-second sellColor';
                        }
                    }
                }
            },
            methods: {
                getAccountAssets: function() {
                    var _this = this
                    var data = {
                        // webId: 100,
                        userId: Methods.getLocalUserInfo(ENV + 'userInfo').userId,
                        pageSize: 9999,
                        pageNum: 1
                    };
                    Methods.ajax({
                        url: `${DOMAIN_DEV}/exchange/fund/controller/website/fundcontroller/findbypage?currencyNames=${_this.coin},${_this.money}`,
                        data: JSON.stringify(data),
                        success: function(res) {
                            _this.loaded = true;

                            if (res.datas.list) {
                                _this.userAssets = res.datas.list;
                            }
                        }.bind(_this),
                        error: function() {}
                    });
                },
                //searchList 监听搜索
                getSearchList() {
                    if (this.searchMainMarket == '') {
                        this.MainMarket = this.tickersList
                    } else {
                        this.MainMarket = []
                        for (let i = 0; i < this.tickersList.length; i++) {
                            var el = this.tickersList[i]

                            var str = el.market.replace('_', '/')
                            if (str.indexOf(this.searchMainMarket.toLowerCase()) != -1) {

                                this.MainMarket.push(el)

                            }

                        }
                    }

                    if (this.searchMainMarket == '') {
                        this.searchList = []
                        for (let i = 0; i < this.tickersList.length; i++) {
                            var el = this.tickersList[i]
                            if (((el._flag != 0 && !el.type) || el.ishot == '1')) {
                                this.searchList.push(el)
                            }
                        }

                    } else {
                        this.searchList = []
                        for (let i = 0; i < this.tickersList.length; i++) {
                            var el = this.tickersList[i]

                            var str = el.market.replace('_', '/')
                            if (str.indexOf(this.searchMainMarket.toLowerCase()) != -1) {

                                this.searchList.push(el)
                            }
                        }
                    }
                },
                getZbHttp() {
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_DEV +
                            '/exchange/config/controller/website/ConfigController/getZbHostConfigList',
                        success: function(res) {
                            this.transactionAmount = res.datas.transactionAmount ? res.datas
                                .transactionAmount : '3000'
                        }.bind(this)
                    });
                },
                //搜索推荐区
                getMainList() {

                },
                // 获取服务器时间
                getServerTime: function(callback) {
                    var _this = this;
                    Methods.ajax({
                        // url: DOMAIN_MAIN + API_PREFIX + 'getServerTime',
                        url: DOMAIN_DEV +
                            '/exchange/user/controller/website/usercontroller/' +
                            'getservertime',
                        success: function(res) {
                            this.serverTime = res.datas;
                            callback && callback(res.datas);
                        }
                    });
                },
                // 获取币价汇率
                getAssistPrice: function(callback) {
                    var _this = this;
                    var mname = _this.moneyName.toLowerCase()

                    Methods.ajax({
                        url: `${DOMAIN_DEV}/exchange/config/controller/website/pricecontroller/getassistprice?coins=${_this.moneyName.toLowerCase()},${_this.coinName.toLowerCase()}`,
                        success: function(res) {
                            _this.assistPrice = res.datas;
                            //币种对qc的价格
                            _this.cnyprice = _this.assistPrice.cny[_this.money]
                            _this.usdprice = _this.assistPrice.usd[_this.money]
                            _this.getTickers()
                            try {
                                _this.$refs.dishPart.flushAssistPrice();
                                _this.$refs.dealRecord.flushAssistPrice();
                            } catch (err) {
                                console.log('miss dish part component.')
                            }
                            callback && callback(res.datas);
                        },
                        error: function() {}
                    });
                },
                // 获取市场配置
                getMarketConfig: function(callback) {
                    var _this = this;
                    Methods.ajax({
                        // url: DOMAIN_TRADE + API_PREFIX + 'getMarketConfig',
                        url: DOMAIN_DEV +
                            "/exchange/config/controller/website/marketcontroller/" +
                            'getByWebId?marketType=0',
                        success: function(res) {
                            _this.marketConfig = res.datas;
                            callback && callback(res.datas);

                        }
                    });
                },
                //获取币种配置
                getCoinConfig: function() {
                    var _this = this
                    var data = {
                        // webId: 100
                    };
                    Methods.ajax({
                        type: 'GET',
                        // url: DOMAIN_MAIN + API_PREFIX + 'getCoinMaps',
                        data: data,
                        url: DOMAIN_DEV +
                            "/exchange/config/controller/website/currencycontroller/" +
                            'getCurrencyList',
                        success: function(res) {
                            this.coinConfig = res.datas;
                        }.bind(this)
                    });
                },
                // 获取所有市场行情 获取k线顶部数据
                /*getAllMarket: function (callback) {
                    var _this = this;
                    Methods.getJSONP({
                        url: DOMAIN_TRADE + API_PREFIX + 'getAllMarket',
                        success: function (res) {
                            _this.allMarket = res.datas;
                            _this.currentMarketData = res.datas[_this.currentMarket];
                            _this.buyOne = _this.showPrice(_this.currentMarketData[1]);
                            _this.sellOne = _this.showPrice(_this.currentMarketData[2]);
                            _this.highPrice = _this.showPrice(_this.currentMarketData[3]);
                            _this.lowPrice = _this.showPrice(_this.currentMarketData[4]);
                            _this.volume = _this.currentMarketData[5];
                            _this.riseRate = _this.currentMarketData[8];
                            callback && callback(res.datas);
                        }
                    });
                },*/
                doDealRecord: function(res) {
                    var _this = this;
                    var datas = res.datas || res.data;
                    /**
                     *作者: GongQi
                     *时间: 2018/5/9
                     *功能: 修改currentPrice的取值在app（EXX.appTradePro中进行）
                     */

                    this.currentPrice = Methods.toNonExponential(datas[datas.length - 1].price)
                    // this.currentPrice = datas[datas.length - 1].price;
                    // EXX.appTradeHead.currentPrice = datas[datas.length - 1].price;
                    if (datas && datas.length > 0) {
                        _this.dealRecord = datas.slice(0, _this.tradesLimit);
                        try {
                            if (_this.last_trade_tid != 0) {
                                _this.$refs.dealRecord.pushTrades(_this.dealRecord);
                            } else {
                                _this.$refs.dealRecord.setFirstRecord(_this.dealRecord);
                            }
                        } catch (err) {
                            console.log('miss lastTrade component.')
                        }
                        _this.last_trade_tid = _this.dealRecord[_this.dealRecord.length - 1].tid;
                    }
                },
                // 获取交易记录的方法 暂弃用
                getDealRecord: function(callback) {
                    var _this = this;
                    //ajax获取成交记录
                    var getDealRecordByAjax = function() {
                        var data = {
                            market: _this.currentMarket,
                            last_trade_tid: _this.last_trade_tid
                        };
                        Methods.getJSONP({
                            url: DOMAIN_TRADE + API_PREFIX + 'records',
                            data: data,
                            success: function(res) {
                                _this.doDealRecord(res);
                            }
                        });
                    };
                    //webSocket方法获取成交记录
                    var getDealRecordByWebsocket = function() {
                        var channel = {
                            event: "addChannel",
                            channel: _this.coin + _this.money + "_cny_lasttrades",
                            last_trade_tid: _this.last_trade_tid
                        }
                        //如果没有则初始化
                        if (typeof ExxWebSocket.channelManage.dealRecord == 'undefined') {
                            ExxWebSocket.channelManage.dealRecord = {
                                message: channel,
                                sended: false,
                                method: function(json) {
                                    _this.doDealRecord(json);
                                }
                            };
                        }
                    }
                    if (ExxWebSocket && ExxWebSocket.openWebSocket && !!_this.currentMarketConfig
                        .isPush) {
                        getDealRecordByWebsocket();
                        //getDealRecordByAjax();
                    } else {
                        getDealRecordByAjax();
                    }
                    callback && callback();
                },
                //获取用户委托记录-委托中记录
                getUserEntrustRecordFromCache: function(callback) {
                    var _this = this;
                    var data = {
                        marketId: _this.currentMarketId,
                        userId: _this.currentAccountId,
                        entrustType: 0,
                        // pageIndex: this.userEntrustRecordFromCache.pageIndex,
                        // pageSize: this.userEntrustRecordFromCache.pageSize,
                    };
                    Methods.ajax({
                        url: DOMAIN_DEV +
                            "/exchange/entrust/controller/website/EntrustController/" +
                            'getUserEntrustRecordFromCache',
                        data: data,
                        success: function(res) {
                            _this.loading = false
                            //VUE数组的更新
                            _this.entrustingRecord = res.datas;
                            var resLength = res.datas.length
                            if (resLength > 0 && _this.entrustingRecordTime < res.datas[
                                0].createTime) {
                                _this.entrustingRecordTime = res.datas[0].createTime;
                                _this.getAccountAssets();
                            } else if (resLength == 0 && _this.entrustingRecordTime !=
                                0) {
                                _this.entrustingRecordTime = 0;
                                _this.getAccountAssets();
                            } else if (this.entrustingRecordLenght != resLength) {
                                _this.getAccountAssets();
                            }
                            this.entrustingRecordLenght = resLength;
                            callback && callback(res.datas)
                        }
                    });
                },
                //获取用户委托记录
                getUserEntrustList: function(callback) {
                    var _this = this;
                    var data = {
                        //status: 0,
                        marketId: _this.currentMarketId,
                        userId: _this.currentAccountId,
                        pageSize: 999999,
                        pageIndex: 1
                    };
                    Methods.ajax({
                        url: DOMAIN_DEV +
                            "/exchange/entrust/controller/website/entrustcontroller/" +
                            'getUserEntrustList',
                        data: data,
                        success: function(res) {
                            //VUE数组的更新
                            // _this.entrustRecord = res.datas.entrustList.reverse();
                            _this.entrustRecord = res.datas.entrustList;
                            _this.loading = false
                            callback && callback(res.datas)
                        }
                    });
                },
                //取消委托
                doCancelEntrust: function(id, isReal) {
                    /**
                     *作者: GongQi
                     *时间: 2018/6/9
                     *功能: 新增请求节流
                     */
                    // if(this.isRepeat){
                    //     JuaBox.info("您有未完成的提交，请稍候……");
                    //     return;
                    // }
                    this.isRepeat = true;
                    var _this = this;
                    var cancelEntrustList = _this.cancelEntrustList
                    var cancelEntrustIndex;
                    var idIsNull = true;
                    for (var i = 0; i < cancelEntrustList.length; i++) {
                        // console.log(cancelEntrustList[i] == id)
                        if (cancelEntrustList[i] == id) {
                            idIsNull = false;
                            break;
                        }
                    }
                    if (idIsNull) {
                        cancelEntrustIndex = cancelEntrustList.push(id) - 1
                        var data = {
                            // isReal: 0,
                            // market: _this.currentMarketId,
                            // userId: _this.currentAccountId,
                            // entrustId: id
                            marketId: _this.currentMarketId, //此处marketId为空
                            entrustId: id
                        };
                        Methods.ajax({
                            //url: DOMAIN_TRADE + API_PREFIX + 'doCancelEntrust',
                            url: DOMAIN_DEV +
                                '/exchange/entrust/controller/website/EntrustController/' +
                                'cancelEntrust',
                            // url: DOMAIN_DEV + '/entrust/entrustController/cancelEntrust',
                            data: JSON.stringify(data),
                            success: function(res) {
                                this.isRepeat = false;
                                $.toast({
                                    heading: 'Success',
                                    text: '取消委托成功',
                                    showHideTransition: 'plain',
                                    icon: 'success'
                                });
                                cancelEntrustList.splice(cancelEntrustIndex, 1)

                                setTimeout(function() {
                                    _this.getUserEntrustRecordFromCache()
                                }, 1500)
                            },
                            error: function(res) {
                                //取消报错后刷新页面
                                if (res.resMsg.code == '2014') {
                                    JuaBox.info("缓存中无该委托单", function() {
                                        _this.getUserEntrustList()
                                    });
                                }
                            }
                        });
                    }
                },
                //全部还款
                doRepayAll: function(coin) {
                    var data = {};
                    data.coint = coin;
                    data.userId = this.currentAccountId;
                    Methods.ajax({
                        type: 'GET',
                        url: DOMAIN_MAIN + API_PREFIX + 'doRepayAll',
                        data: data,
                        success: function(res) {
                            //this.swiftTab('action');
                            //EXX.userIndex.closeModal();
                            JuaBox.info("还款成功");
                        }.bind(this)
                    });
                },
                // 设置辅助币种
                setAssistCoin: function(coin) {
                    // 设置K线单位cookie
                    Methods.setCookie(ENV + 'kassist', coin);

                    if (!this.isLogin) {
                        Methods.setCookie(ENV + 'mname', coin);
                        this.assistCoin = coin;
                        //top.location.reload();
                        return false;
                    }
                    if (coin == 'none') {
                        this.assistCoin = coin;
                        this.allFlag = true;
                        return false;
                    }

                    var data = {
                        assistCoin: coin
                    };
                    Methods.ajax({
                        // url: DOMAIN_MAIN + API_PREFIX + 'editAssistCoin',
                        url: DOMAIN_DEV +
                            "/exchange/user/controller/website/usercontroller/" +
                            'editassistcoin',
                        data: JSON.stringify(data),
                        success: function(res) {
                            Methods.setCookie(ENV + 'mname', coin);
                            this.assistCoin = coin;
                            this.allFlag = true;
                            //top.location.reload();
                        }.bind(this)
                    });

                },
                getMaxDepth: function(depth) {
                    var maxNum = 0;
                    //求卖单最大深度值
                    for (var i = 0; i < depth.length; i++) {
                        if (parseFloat(depth[i][1]) > maxNum) {
                            maxNum = parseFloat(depth[i][1]);
                        }
                    }
                    return maxNum;
                },
                //获取 全量数据
                getDishListData: function(marketId) {
                    var _this = this;
                    $.ajax({
                        type: "get",
                        url: DISH_API + "/api/data/v1/entrusts?marketId=" + marketId,
                        success: function(res) {
                            var datas = res.datas
                            _this.lastDepth = {};

                            Vue.set(_this.lastDepth, 'asks', datas.asks)
                            Vue.set(_this.lastDepth, 'bids', datas.bids)

                            try {
                                _this.$refs.dishPart.updateDepth(_this.lastDepth);
                            } catch (err) {
                                console.log('miss dishpartDark component.')
                            }
                            // setTimeout(function () {
                            //     _this.getDishListData(marketId)
                            // },30000)
                        }.bind(this),
                        error: function() {}
                    });
                },
                //合并盘口数据
                //[数据类型, 市场ID, 币种信息, 时间戳, 开盘数据, 最高价, 最低价, 收盘价, 成交量, 涨跌幅度, 美元汇率, K线周期, 是否经过转换]
                //[["K","90","btc_qc","1522849560","50.000000","50.000000","50.000000","50.000000","1.00","0.00","6.29","1M","false"]]
                mixDishArray: function(res) {
                    var _this = this;
                    //增量更新的合并盘口方法
                    var mixArray = function(oldArray, newArray, type) {
                        var m = new top.hashMap();
                        var n = new top.hashMap();
                        var resultArray = [];
                        for (var i = 0, ilength = oldArray.length; i < ilength; i++) {
                            m.put(parseFloat(oldArray[i][0]), oldArray[i][1]);
                        }
                        for (var i = 0, ilength = newArray.length; i < ilength; i++) {
                            n.put(parseFloat(newArray[i][0]), newArray[i][1]);
                        }

                        m.each(function(key, value, index) {
                            var na = n.get(key);
                            if (na) {
                                m.put(key, na);
                            }
                        });
                        n.each(function(key, value, index) {
                            if (value == 0) {
                                m.remove(key);
                            } else {
                                m.put(key, value);
                            }
                        });
                        m.each(function(key, value, index) {
                            resultArray[index] = []
                            resultArray[index][0] = key;
                            resultArray[index][1] = value;
                        });
                        /**
                         *  作者:Seven
                         *  时间:2018/8/10 17:46
                         *  Email:csz.seven@gmail.com
                         *  描述:控制盘口档位大小为50
                         */
                        // console.log(resultArray)
                        // resultArray.reverse()
                        if (type == "Ask") {
                            resultArray.splice(50)
                            return resultArray.reverse();

                        } else {
                            resultArray.reverse().splice(50)
                            return resultArray
                        }

                    }
                    //封装为统一的结构
                    var result = {
                        datas: {}
                    };
                    //正常请求的数据处理 盘口推送暂无当前价格字段，所以暂不设置当前价格(已注释掉)
                    /**
                     *  作者:Seven
                     *  时间:2018/8/10 16:41
                     *  Email:csz.seven@gmail.com
                     *  描述:此处多余逻辑已去除
                     */
                    result.datas.asks = res.asks;
                    result.datas.bids = res.bids;

                    //倒序
                    // res.datas.asks.reverse();
                    //合并盘口数据
                    var data = result.datas;

                    if (_this.lastDepth.asks.length == 0 && _this.lastDepth.bids.length == 0 && !
                        _this.dishFull) {
                        _this.lastDepth = {};
                        Vue.set(_this.lastDepth, 'asks', data.asks)
                        Vue.set(_this.lastDepth, 'bids', data.bids)
                        _this.dishFull = true
                    } else {
                        //处理增量推送
                        var resultAsksArray, resultBidsArray;
                        /**
                         *  作者:Seven
                         *  时间:2018/8/10 16:43
                         *  Email:csz.seven@gmail.com
                         *  描述:增量-多余逻辑已去除
                         */
                        resultAsksArray = mixArray(_this.lastDepth.asks, data.asks, "Ask");
                        resultBidsArray = mixArray(_this.lastDepth.bids, data.bids, "Bid");
                        //_this.lastDepth.asks = resultAsksArray;
                        //_this.lastDepth.bids = resultBidsArray;
                        Vue.set(_this.lastDepth, 'asks', resultAsksArray);
                        Vue.set(_this.lastDepth, 'bids', resultBidsArray);
                        try {
                            _this.$refs.dishPart.updateDepth(_this.lastDepth);
                        } catch (err) {
                            console.log('miss dishpartDark component.')
                        }
                    }
                    //计算最大深度值
                    var getMaxDepth = function(depth) {
                        var maxNum = 0;
                        //求卖单最大深度值
                        for (var i = 0; i < depth.length; i++) {
                            if (parseFloat(depth[i][1]) > maxNum) {
                                maxNum = parseFloat(depth[i][1]);
                            }
                        }
                        return maxNum;
                    }
                    //最大深度值
                    Vue.set(_this.lastDepth, 'maxbBids', getMaxDepth(_this.lastDepth.bids));
                    Vue.set(_this.lastDepth, 'maxAsks', getMaxDepth(_this.lastDepth.asks));

                },
                //获取币种的可用资金（不包括杠杆）
                getUseable: function(coin) {
                    var _this = this;
                    var userCoinFunds = this.userCoinFunds;

                    for (var i = 0; i < userCoinFunds.length; i++) {
                        var currCoin = userCoinFunds[i].name;
                        if (currCoin == coin) {
                            var useable = userCoinFunds[i].amount || 0;
                            return useable;
                        }
                    }
                    return false;
                },
                //获取币种的可用资金（包括杠杆）暂弃用
                getAllUseable: function(coin) {
                    var _this = this;
                    if (!_this.currentUserAsset.coinFundMap || !_this.currentUserAsset.coinFundMap[
                        coin]) {
                        return '--';
                    } else {
                        var coinAsset = _this.currentUserAsset.coinFundMap[coin];
                        var useable = coinAsset.available || 0;
                        var canLoan = coinAsset.canLoan || 0;
                        if (_this.currentMarketLever) {
                            useable = Number(useable) + Number(canLoan);
                        }
                        return useable;
                    }
                },
                //获取指定辅助货币的价格
                getPriceByAssist: function(price, market, assist) {
                    if (!price || price == '' || !market || market == '' || this.assistPrice ==
                        null) {
                        return '0'
                    }
                    var money = market.split('_')[1];
                    //优先取指定的assist
                    var assistCoin = assist || MONEY;
                    if (assistCoin == 'none' || assistCoin == '') {
                        return Methods.fixNumber(price, 4);
                    } else {
                        return Methods.fixNumber(parseFloat(price) * parseFloat(this.assistPrice[
                            assistCoin][money]), this.assistList[assistCoin].decimal) || 0;
                    }
                },
                //获取辅助货币价格的下单价
                getPriceByPrice: function(price) {
                    if (!price || price == '') {
                        return ''
                    }
                    var money = this.money;
                    var assistCoin = this.assistCoin;
                    if (assistCoin == 'none' || assistCoin == '') {
                        return Methods.fixNumber(price, this.currentMarketConfig.priceDecimal);
                    } else {
                        return Methods.fixNumber(parseFloat(price) / parseFloat(this.assistPrice[
                            assistCoin][money]), this.currentMarketConfig.priceDecimal) || '--';
                    }
                },
                //过滤指定的委托
                getGroupEntrust: function(group) {
                    var result = [];
                    switch (group) {
                        case "doing":
                            result = this.entrustingRecord
                            break;
                        case "history":
                            result = this.entrustRecord
                            break;
                    }
                    return result;
                },
                //是否可以充值
                getIsPayIn: function(coin) {
                    // return this.coinConfig && this.coinConfig[coin] && this.coinConfig[coin].isPayIn;
                    var _this = this;
                    if (_this.coinConfig) {
                        for (var i = 0; i < _this.coinConfig.length; i++) {
                            if (_this.coinConfig[i].name == coin && _this.coinConfig[i]
                                .rechargeFlag == 1) {
                                //默认都能充值，返回true
                                return _this.coinConfig[i];
                            }
                        }
                    }
                },
                //是否可以提币
                getIsPayOut: function(coin) {
                    // return this.coinConfig && this.coinConfig[coin] && this.coinConfig[coin].isPayOut;
                    var _this = this;
                    if (_this.coinConfig) {
                        for (var i = 0; i < _this.coinConfig.length; i++) {
                            if (_this.coinConfig[i].name == coin) {
                                return _this.coinConfig[i].drawFlag;
                            }
                        }
                    }
                },
                //是否可以划入划出 暂无用
                getIsDoInOut: function(coin) {
                    return this.coinConfig && this.coinConfig[coin] && this.coinConfig[coin]
                        .isDoInOut;
                },
                showStatus: function(status) {
                    var obj = {
                        "-2": "资金解冻失败",
                        "-1": "用户资金不足",
                        "0": "<span class='text-second'>交易中</span>",
                        "1": "已取消",
                        "2": "<span class='text-primary'>已完成</span>",
                        "3": "<span class='text-second'>交易中</span>",
                        "4": "<span class='text-second'>取消中</span>"
                    }
                    return obj[status];
                },
                showSource: function(source) {
                    var obj = {
                        "6": "API",
                        "8": "WEB",
                        "5": "APP"
                    }
                    return obj[source];
                },
                showTime: function(time) {
                    return Methods.getDateTime(time, "MM-DD HH:MM:SS");
                },
                showCoin: function(val) {
                    if (isNaN(val)) {
                        return '--'
                    } else {
                        return Methods.fixNumber(val, this.currentMarketConfig.amountDecimal)
                    }
                },
                newShowCoin: function(val) {
                    if (isNaN(val)) {
                        return '--'
                    } else {
                        return Methods.fixNumber(val, 9)
                    }
                },
                showMoney: function(val) {
                    if (isNaN(val)) {
                        return '--'
                    } else {
                        return Methods.fixNumber(val, this.currentMarketConfig.priceDecimal)
                    }
                },
                newShowMoney: function(val) {
                    if (isNaN(val)) {
                        return '--'
                    } else {
                        return Methods.fixNumber(val, 9)
                    }
                },
                showCoinNew: function(market) {
                    return market.split('_')[0].toUpperCase();
                },
                showMoneyNew: function(market) {
                    return market.split('_')[1].toUpperCase();
                },
                gotoTrade: function(market) {
                    var _this = this
                    // 点击当前盘口无效
                    if (this.currentMarket == market) {
                        return
                    }
                    _this.lastDepth = {
                        asks: [],
                        bids: [],
                        maxbBids: "0",
                        maxbAsks: "0"
                    }
                    _this.mainLoding = true;

                        //清除websocket订阅
                        if (window.parent.ExxWebSocket.openWebSocket) {
                            //取消订阅
                            var delete_klineParam = {
                                dataType: window.parent.EXX.appTradePro.klineData,
                                dataSize: 1000, //如需修改，还要改时间显示周期切换那里
                                action: "DEL"
                            };
                            window.parent.ExxWebSocket.websocket.send(JSON.stringify(
                                delete_klineParam));

                            //发送委托盘口参数
                            var delete_entrustParam = {
                                dataType: window.parent.EXX.appTradePro.entrustData,
                                dataSize: 50,
                                action: "DEL"
                            };
                            window.parent.ExxWebSocket.websocket.send(JSON.stringify(
                                delete_entrustParam));

                            //发送交易参数
                            var delete_tradeParam = {
                                dataType: window.parent.EXX.appTradePro.tradeData,
                                dataSize: 20,
                                action: "DEL"
                            };

                            window.parent.ExxWebSocket.websocket.send(JSON.stringify(
                                delete_tradeParam));
                            var delete_marketParam = {
                                dataType: EXX.appTradePro.trade24Data,
                                dataSize: 1,
                                action: "DEL"
                            }
                            window.parent.ExxWebSocket.websocket.send(JSON.stringify(
                                delete_marketParam));

                        }
                            //更新vue数据
                            _this.currentMarket = market;
                            _this.siteTitle = `${market.toUpperCase().replace('_','/')=='BCHABC/USDT'?'BCH/USDT':market.toUpperCase().replace('_','/')} | ZBG Exchange`

                            _this.coin = market.split("_")[0];
                            _this.money = market.split("_")[1];
                            _this.coinName = market.split("_")[0].toUpperCase();
                            _this.moneyName = market.split("_")[1].toUpperCase();
                            _this.currentPrice = '--';
                            _this.highPrice = '--';
                            _this.lowPrice = '--';
                            _this.volume = '--';
                            _this.riseRate = '0.00';
                            //清除深度和交易记录

                            _this.entrustingRecord = []
                            _this.dealRecord = []
                            //重新获取数据(资金,交易记录等)
                            _this.marketOpenStatus = false
                            _this.marketOpenTime = ['-', '-', '-', '-'];


                            //通过key更新自组件

                            _this.tradeKey1 += 1;
                            _this.tradeKey2 += 1;
                            _this.dishKey += 1;
                            _this.dealKey += 1;
                            _this.last_trade_tid = 0
                            //改变href hash
                            window.history.replaceState('', null, `/trade/${market}`)
                    setTimeout(() => {
                        _this.mountedTriger(1)

                    }, 100)
                },
                showPrice: function(val) {
                    if (isNaN(val)) {
                        return '--'
                    } else {
                        return Methods.fixDecimal(val, this.currentMarketConfig.priceDecimal)
                    }
                },
                showAmount: function(val) {
                    if (isNaN(val)) {
                        return '--'
                    } else {
                        return Methods.fixNumber(val, this.currentMarketConfig.amountDecimal)
                    }
                },
                newShowAmount: function(val) {
                    if (isNaN(val)) {
                        return '--'
                    } else {
                        return Methods.fixNumber(val, 9)
                    }
                },
                showRate: function(val) {
                    if (isNaN(val)) {
                        return '--'
                    } else {
                        if (parseFloat(val) >= 0) {
                            return "+" + Methods.fixNumber(val, 2)
                        } else {
                            return Methods.fixNumber(val, 2)
                        }
                    }
                },
                showAssistCoin: function() {
                    //显示辅助货币名字，不显示默认
                    if (this.assistCoin == 'none') {
                        return this.moneyName;
                    } else {
                        return this.assistList[this.assistCoin].name || this.moneyName;
                    }
                },
                showAssistName: function() {
                    //显示辅助货币名字，有默认显示
                    return this.assistList[this.assistCoin].name || this.moneyName;
                },
                //价格折合的提示内容
                showAssistHint: function(price) {
                    return "折合:" + this.getPriceByAssist(price) + " " + this
                        .showAssistCoin();
                },
                userActionSuccess: function() {
                    return function() {
                        //this.getUsersInfo();
                        this.showModal = false;
                    }.bind(this)
                },
                //开启关闭杠杆
                toggleLever: function() {
                    if (!this.isLogin) {
                        return false;
                    }
                    if (this.currentUserAsset.userType == 1) {
                        JuaBox.info("主账号不能开启杠杆，请切换到子账号再执行此操作");
                        return
                    }
                    if (this.currentMarketConfig.leverRate == 0) {
                        JuaBox.info("当前市场不允许开启杠杆，请切换市场后再开启。");
                        return
                    }
                    this.userParams = {
                        optType: 5,
                        userId: this.currentAccountId,
                        market: this.currentMarket,
                        account: this.currentUserAsset,
                        //最大杠杆倍数
                        maxLever: this.currentMarketConfig.leverRate
                    };
                    this.showModal = 'toggleUserAction';
                    /*if (this.currentUserMarkets.length == 0) {
                        JuaBox.info("开启杠杆需要添加一个交易市场");
                        this.openMarket();
                    } else if (this.currentUserMarkets.length > 2) {
                        JuaBox.info("开启杠杆只能应用于一个市场，请把多余的市场删除");
                        this.openMarket();
                    } else {
                        this.showModal = 'toggleUserAction';
                    }*/
                },
                //切换价格输入模式
                toggleInputPriceMode: function() {
                    /*if(this.moneyName == this.showAssistCoin()){
                        return JuaBox.info("请先选择价格显示货币为USD或CNY再开启价格输入转换功能");
                    }*/
                    if (this.inputPriceMode == 0) {
                        Methods.setCookie(ENV + 'inputPriceMode', 1, 7);
                        this.inputPriceMode = 1;
                    } else {
                        Methods.setCookie(ENV + 'inputPriceMode', 0, 7);
                        this.inputPriceMode = 0;
                    }
                },
                //检测当前价格输入模式，不合法则恢复默认
                checkInputPriceMode: function() {
                    if (this.moneyName == this.showAssistCoin()) {
                        Methods.setCookie(ENV + 'inputPriceMode', 0, 7);
                        this.inputPriceMode = 0;
                    }
                },
                openBill: function() {
                    this.billParams = {
                        userId: this.currentAccountId,
                        coin: this.coin
                    };
                    this.showModal = 'bill';
                },
                openEntrust: function() {
                    this.entrustParams = {
                        market: this.currentMarket,
                        userId: this.currentAccountId
                    };
                    this.showModal = 'entrust';
                },
                openRefund: function(coin) {
                    this.refundParams = {
                        userId: this.currentAccountId,
                        coin: coin
                    };
                    this.showModal = 'refund';
                },
                changeEntrustTab: function(type) {
                    this.currentEntrustTab = type;
                },
                changeTradeMode: function(type) {
                    this.currentTradeMode = type;
                    this.showLeverInfo = false;
                    this.$refs.tradeFormBuy.tradeMode = type;
                    this.$refs.tradeFormSell.tradeMode = type;
                },
                //获取图表的默认设置
                getChartSettings: function() {
                    var chartSettings = Methods.getCookie('chartSettings');
                    if (chartSettings) {
                        chartSettings = JSON.parse(decodeURIComponent(chartSettings));
                        for (var key in chartSettings.charts) {
                            Vue.set(this.kline, key, chartSettings.charts[key]);
                        }
                    }
                },
                switchPeriod: function(period) {
                    this.period = period
                    // /**
                    //  *作者: GongQi
                    //  *时间: 2018/5/9
                    //  *功能: 取消订阅 ws推送
                    //  */
                    // var delKlineParam = {
                    //     dataType: this.klineData,
                    //     dataSize: 1000,
                    //     action: "DEL"
                    // };
                    // ExxWebSocket.websocket.send(JSON.stringify(delKlineParam));
                    //
                    // this.setChartType('kline');
                    // Vue.set(this.kline, "period", period);
                    // this.klineFrame.switch_period(period);
                    //
                    // //发送K线参数
                    // var klineParam = {
                    //     dataType: this.klineData,
                    //     dataSize: 1000,
                    //     action: "ADD"
                    // };
                    // ExxWebSocket.websocket.send(JSON.stringify(klineParam));
                    //
                    // this.allFlag = true;
                },
                switchTheme: function(theme) {
                    Vue.set(this.kline, "theme", theme);
                    this.klineFrame.switch_theme(theme);
                },
                switchTool: function(val) {
                    if (!val) {
                        val = this.kline.toolStatus == 'on' ? 'off' : 'on';
                    }
                    Vue.set(this.kline, "toolStatus", val);
                    this.klineFrame.switch_tools(val);
                },
                switchIndic: function(val) {
                    if (!val) {
                        val = this.kline.indicsStatus == 'on' ? 'off' : 'on';
                    }
                    Vue.set(this.kline, "indicsStatus", val);
                    this.klineFrame.switch_indic(val);
                },
                setChartMoney: function(type) {
                    this.setChartType('kline');
                    Vue.set(this.kline, "money", type);
                    this.klineFrame.chart_set_money(type);

                    // 设置K线单位cookie
                    if (type.toLowerCase() == this.money) {
                        Methods.setCookie(ENV + 'kassist', 'none'); // 默认
                    } else {
                        Methods.setCookie(ENV + 'kassist', type.toLowerCase());
                    }
                    this.allFlag = true;


                    this.klineFrame.document.location.href = '/kline/lite/' + this.currentMarket +
                        '?money=' + type; //改变iframe的href, src属性不会随之改变
                },
                setChartMainIndicator: function(style) {
                    Vue.set(this.kline, "mIndic", style);
                    this.klineFrame.setChartMainIndicator(style);
                },
                setChartMainStyle: function(style) {
                    Vue.set(this.kline, "chartStyle", style);
                    this.klineFrame.setChartMainStyle(style);
                },
                showChartSetting: function() {
                    this.klineFrame.showChartSetting();
                },
                setChartType: function(type) {
                    this.chartType = type;
                },
                closeModal: function(name) {
                    this.showModal = false;
                },
                //倒计时开盘时间
                countOpenTime: function(totalTime) {
                    var _this = this;
                    var totalTime = totalTime;
                    var timedown = function() {
                        //计算出相差天数
                        var days = Math.floor(totalTime / (24 * 3600 * 1000))
                        //计算出小时数
                        var leave1 = totalTime % (24 * 3600 * 1000);
                        var hours = Math.floor(leave1 / (3600 * 1000))
                        //计算相差分钟数
                        var leave2 = leave1 % (3600 * 1000);
                        var minutes = Math.floor(leave2 / (60 * 1000))
                        //计算相差秒数
                        var leave3 = leave2 % (60 * 1000);
                        var seconds = Math.round(leave3 / 1000)

                        Vue.set(_this.marketOpenTime, 0, days < 10 ? '0' + days : days + '');
                        Vue.set(_this.marketOpenTime, 1, hours < 10 ? '0' + hours : hours + '');
                        Vue.set(_this.marketOpenTime, 2, minutes < 10 ? '0' + minutes :
                            minutes + '');
                        Vue.set(_this.marketOpenTime, 3, seconds < 10 ? '0' + seconds :
                            seconds + '');
                    }
                    timedown();
                    if (_this.openMarketInterval) {
                        window.clearInterval(_this.openMarketInterval);
                    }
                    _this.openMarketInterval = setInterval(function() {
                        totalTime -= 1000;

                        timedown();

                        if (totalTime == 30000 && !_this.isshowData ) {
                            _this.isshowData = true
                            _this.getDishListData(_this.currentMarketId)
                        }
                        if  (totalTime == 0){
                            _this.marketOpenStatus = false;
                            window.clearInterval(_this.openMarketInterval);
                        }
                    }, 1000)
                },
                initEntrustScroll: function() {
                    if (!this.entrustScroll && $('.entrust-box-body').length > 0) {
                        this.entrustScroll = new IScroll('.entrust-box-body', {
                            mouseWheel: true,
                            scrollbars: "custom",
                            fadeScrollbars: true,
                            bounceEasing: 'quadratic'
                        });
                    }
                    if (this.entrustScroll) {
                        this.entrustScroll.refresh();
                    }
                },
                lightThemeInit: function() {
                    if (this.theme == 'light') {
                        this.switchIndic('off');
                        this.switchTool('off');
                    }
                },
                /**
                 *作者: GongQi
                 *时间: 2018/6/12
                 *功能: 检测是否存在此交易对
                 */
                marketIsExist: function() {
                    var marketConfig = this.marketConfig;
                    var currentMarket = this.currentMarket;
                    var marketIsExist = false;
                    for (var i = 0; i < marketConfig.length; i++) {
                        if (currentMarket == marketConfig[i].name) {
                            marketIsExist = true;
                            break;
                        }
                    }
                    if (!marketIsExist) {
                        this.getByWebId()
                    }
                },
                //排序的方法
                doSortMarket: function(markets) {
                    var _this = this;
                    var sortBy = this.sortBy;
                    var tab = this.currentTab;
                    if ((tab != 'user' && sortBy == '') || markets.length == 0) {
                        return markets;
                    }
                    markets.sort(function(x, y) {
                        if (sortBy == 'rateUp') {
                            return x.rate - y.rate;
                        } else if (sortBy == 'rateDown') {
                            return y.rate - x.rate;
                        } else if (sortBy == 'volumeUp') {
                            return x.convertVolume - y.convertVolume;
                        } else if (sortBy == 'volumeDown') {
                            return y.convertVolume - x.convertVolume;
                        } else if (sortBy == 'nameUp') {
                            return y.market.substring(0, 1).charCodeAt() - x.market
                                .substring(0, 1).charCodeAt();
                        } else if (sortBy == 'nameDown') {
                            return x.market.substring(0, 1).charCodeAt() - y.market
                                .substring(0, 1).charCodeAt();
                        } else if (sortBy == 'priceUp') {
                            return parseFloat(_this.getPriceByAssist(x.lastPrice, x.market,
                                'usd')) - parseFloat(_this.getPriceByAssist(y.lastPrice,
                                y.market, 'usd'));
                        } else if (sortBy == 'priceDown') {
                            return parseFloat(_this.getPriceByAssist(y.lastPrice, y.market,
                                'usd')) - parseFloat(_this.getPriceByAssist(x.lastPrice,
                                x.market, 'usd'));
                        } else if (tab == 'user') {
                            return y.sortId - x.sortId;
                        }

                    });

                    return markets;
                },
                Refresh() {
                    this.loading = true
                    this.getUserEntrustList()
                    this.getUserEntrustRecordFromCache()
                },
                selectCoin() {
                    var lan = Methods.getCookie(ENV + 'lan');
                    if (lan == 'cn') {
                        this.selectlan = true
                    } else {
                        this.selectlan = false
                    }
                },
                getTickers() {
                    var _this = this;
                    var arr = []
                    $.ajax({
                        type: "GET",
                        url: DISH_API + "/api/data/v1/tickers",
                        success: function(res) {
                            var dataList = res.datas
                            if (dataList && dataList.length > 0) {
                                for (let i = 0; i < dataList.length; i++) {
                                    var el = dataList[i]

                                    for (let j = 0; j < this.marketConfig.length; j++) {
                                        var item = this.marketConfig[j]
                                        if (el[0] == item.marketId) {
                                            var obj = {
                                                market: item.name,
                                                lastPrice: el[1],
                                                rate: el[5],
                                                volume: el[4],
                                                ishot: item.lockMarket,
                                                _flag: item._flag,
                                                isZeroTrade: Number(item.isZeroTrade),
                                                sortNum: item.order
                                            }
                                            if (item.type == 1) {

                                                obj.type = false

                                            } else {

                                                obj.type = true

                                            }
                                            if (!Number(item.isZeroTrade)) {
                                                arr.push(obj)
                                            }
                                            break
                                        }
                                    }

                                }
                            }

                            var num = function(a, b) {

                                if (b.ishot && a.isHot) {
                                    return a.nextOpenTime - b.nextOpenTime
                                } else if (a.isHot) {
                                    return -1
                                } else if (b.ishot) {
                                    return 1
                                }

                                if (a.sortNum != b.sortNum) {
                                    return b.sortNum - a.sortNum
                                }

                                if (a.type === 2 && b.type === 1) {
                                    return -1
                                } else if (a.type === 1 && b.type === 2) {
                                    return 1
                                } else {
                                    return b.rate - a.rate
                                }
                            }

                            this.tickersList = arr.sort(num)

                            // this.tickersList = mainArr.concat(resultArray)
                            this.getSearchList()

                        }.bind(this),
                        error: function() {}
                    });
                },
                async mountedTriger(isFirst) {
                    var _this = this
                    // 不同币种不同的meta
                    //先获取配置和价格表
                    // _this.getZbHttp()
                    if (!isFirst) {
                        _this.getCoinConfig();
                    }
                    if (ISLOGIN) {
                        _this.getAccountAssets()
                    }

                    await _this.getMarketConfig(function() {
                        clearInterval(_this.tId1)
                        clearInterval(_this.tId2)
                        clearInterval(_this.tId3)
                        clearInterval(_this.tId4)
                        _this.mainLoding = false;
                        _this.marketIsExist()
                        if (_this.currentMarketConfig.isDanger) {
                            swal({
                                title: "风险提示",
                                text: "此币种存在交易风险，请谨慎投资",
                                icon: "warning",
                                buttons: ["我已知晓",
                                    "放弃交易"
                                ],
                                dangerMode: false,
                            }).then(function(willDelete) {

                                if (willDelete) {
                                    // 放弃交易
                                    window.location.href = '/trade/zt_usdt'
                                } else {
                                    //  知晓
                                }
                            });
                        }
                        //排查错误市场
                        /*if(!_this.marketConfig[_this.currentMarket]){
                            // 暂时注释掉
                            // JuaBox.info('Error Market !', function () {
                            //     top.location.href = '/';
                            // })
                            return false;
                        }*/

                        //开盘时间处理 serverTime服务器时间
                        _this.getServerTime(function(serverTime) {
                            _this.isLock = _this.currentMarketConfig.isLock

                            //nextOpenTime 涨跌停下一次开盘时间 openTime 交易对上线时间
                            var nextOpenTime = parseFloat(_this.currentMarketConfig
                                .nextOpenTime);

                            var openTime = parseFloat(_this.currentMarketConfig
                                .openTime);

                            var nowTime = Date.parse(new Date(parseFloat(serverTime)));

                            var totalTime = nextOpenTime - nowTime; //涨跌停下一次开盘时间
                            var nexttotalTime = openTime - nowTime; //交易对上线时间

                            if (nexttotalTime > 0 || totalTime > 0){
                                _this.marketOpenStatus = true; // 开盘时间

                            }
                            if (nexttotalTime > 0) {

                                if (totalTime > 30000) {
                                    _this.marketStartTime = Methods.getDateTime(
                                        nextOpenTime, "YYYY-MM-DD HH:MM:SS");
                                    _this.countOpenTime(totalTime);
                                    if (totalTime <= 30000 && totalTime > 0){
                                        ExxWebSocket.init();
                                        _this.marketStartTime = Methods.getDateTime(
                                            nextOpenTime, "YYYY-MM-DD HH:MM:SS");
                                        _this.countOpenTime(totalTime);
                                    }
                                }
                                if ( nexttotalTime > 30000 ){
                                    _this.marketStartTime = Methods.getDateTime(
                                        openTime, "YYYY-MM-DD HH:MM:SS");
                                    _this.countOpenTime(nexttotalTime);
                                }if (nexttotalTime <= 30000 && nexttotalTime > 0){
                                    _this.marketStartTime = Methods.getDateTime(
                                        openTime, "YYYY-MM-DD HH:MM:SS");
                                    _this.countOpenTime(nexttotalTime);
                                    ExxWebSocket.init();
                                }
                            } else {
                                if (totalTime > 30000) {
                                    _this.marketStartTime = Methods.getDateTime(
                                        nextOpenTime, "YYYY-MM-DD HH:MM:SS");
                                    _this.countOpenTime(totalTime);
                                }else if(totalTime <= 30000 && totalTime> 0)  {
                                    _this.marketStartTime = Methods.getDateTime(
                                        nextOpenTime, "YYYY-MM-DD HH:MM:SS");
                                    _this.countOpenTime(totalTime);
                                    ExxWebSocket.init();
                                }else{
                                    ExxWebSocket.init();
                                }
                            }
                        });

                        _this.getAssistPrice(function() {
                            _this.tId1 = setInterval(_this.getAssistPrice, 90000);
                            // //获取价格表定时器
                            // _this.getAssistPrice(function () {
                            //
                            // });

                            //登录后的数据获取
                            const MarketIdTime =   setInterval(() => {
                                if (_this.currentMarketId != '' || _this.currentMarketId ){
                                    if (_this.isLogin) {
                                        //获取委托记录定时器
                                        _this.getUserEntrustList(function() {
                                            _this.initEntrustScroll();
                                            _this.tId2 = setInterval(_this.getUserEntrustList,
                                                10000);
                                        });
                                        _this.getUserEntrustRecordFromCache(function() {
                                            _this.tId3 = setInterval(_this
                                                    .getUserEntrustRecordFromCache,
                                                10000);
                                        })
                                    }
                                    clearInterval(MarketIdTime)
                                }
                            },100)

                        })
                        _this.tId4 = setInterval(function() {
                            if (_this.isshowData) {
                                _this.getDishListData(_this.currentMarketId)
                            }
                        }, 30000)
                        window.addEventListener('visibilitychange', function() {
                            if (window.document.visibilityState && _this.isshowData) {
                                _this.getDishListData(_this.currentMarketId)
                            }
                        })

                    });
                    this.getChartSettings();
                    this.checkInputPriceMode();
                    this.selectCoin()

                    // setInterval(function () {
                    //     _this.getTickers()
                    // },10000)
                },
                //    查询高深度市场
                getByWebId: function(callback) {
                    var _this = this;
                    Methods.ajax({
                        // url: DOMAIN_TRADE + API_PREFIX + 'getMarketConfig',
                        url: DOMAIN_DEV +
                            "/exchange/config/controller/website/marketcontroller/" +
                            'getByWebId?marketName=' + _this.currentMarket,
                        success: function(res) {
                            _this.marketConfig =  res.datas.concat(_this.marketConfig)
                            if (this.isLogin){
                                _this.Refresh()
                            }
                            callback && callback(res.datas)
                        }
                    });
                },
            },
            created: function() {
                var _this = this
                this.mountedTriger()
                // _this.DOMAIN_DEV = window.location.origin
                if (!ExxWebSocket.openWebSocket) {
                    var timerId = setInterval(function() {
                        if (_this.currentMarketId != '' && _this.isshowData ) {
                            ExxWebSocket.init();
                            _this.getDishListData(_this.currentMarketId)
                            clearInterval(timerId)
                        }
                    }, 1000)

                } else {
                    fn()

                    function fn() {
                        setTimeout(function() {
                            if (!_this.marketOpenStatus) {
                                // var klineParam = {
                                //     dataType: _this.klineData,
                                //     dataSize: 1000, //如需修改，还要改时间显示周期切换那里
                                //     action: "ADD"
                                // };
                                // ExxWebSocket.websocket.send(JSON.stringify(klineParam));

                                //发送委托盘口参数
                                var entrustParam = {
                                    dataType: _this.entrustData,
                                    dataSize: 50,
                                    action: "ADD"
                                };
                                ExxWebSocket.websocket.send(JSON.stringify(entrustParam));

                                //发送交易参数
                                var tradeParam = {
                                    dataType: _this.tradeData,
                                    dataSize: 20,
                                    action: "ADD"
                                };

                                ExxWebSocket.websocket.send(JSON.stringify(tradeParam));
                                var marketParam = {
                                    dataType: _this.trade24Data,
                                    dataSize: 1,
                                    action: "ADD"
                                }
                                ExxWebSocket.websocket.send(JSON.stringify(marketParam));
                                // websocket只初始化一次, 当切换辅助价格显示时，需要重新发送消息获取订阅数据
                                // window.parent.ExxWebSocket.init();
                            } else {
                                fn()
                            }
                        }, 1000)
                    }

                }
            },
            updated: function() {
                this.initEntrustScroll();
            },
            mounted: function() {
            },
            filters: {
                capitalizecny: function(value) {
                    if (!value || value == null || value == 0 || value == NaN) return '--'
                    return Number(value).toFixed(4)
                },
                capitalizeusd: function(value) {
                    if (!value || value == null || value == 0 || value == NaN) return '--'
                    return Number(value).toFixed(4)
                },
            }
        })
    });
</script>


<!--侧边栏-->

    
<!---->
    <!--<script>-->
        <!--var _hmt = _hmt || [];-->
        <!--(function() {-->
            <!--var hm = document.createElement("script");-->
            <!--hm.src = "https://hm.baidu.com/hm.js?6f0b205880a109ff2ad9e75e41427bca";-->
            <!--var s = document.getElementsByTagName("script")[0];-->
            <!--s.parentNode.insertBefore(hm, s);-->
        <!--})();-->
    <!--</script>-->
<!---->
<script>
    // setTimeout(function () {
    //     $(".site-wrapper").bootstrapDropdownOnHover({
    //         mouseOutDelay: 100,
    //         responsiveThreshold: 769
    //     });
    // },100)
</script>

</body>
</html>
<!--全站通用-->
